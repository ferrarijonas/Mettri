// Module: infrastructure.tests

"use strict";var MettriModule_infrastructure_tests=(()=>{var D=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var G=(I,t)=>{for(var r in t)D(I,r,{get:t[r],enumerable:!0})},z=(I,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of q(t))!K.call(I,o)&&o!==r&&D(I,o,{get:()=>t[o],enumerable:!(e=B(t,o))||e.enumerable});return I};var V=I=>z(D({},"__esModule",{value:!0}),I);var J={};G(J,{TestsModule:()=>H,register:()=>Y});var R=class{interceptors;logs=[];constructor(t){this.interceptors=t}async testModule(t){this.logs=[];let r=Date.now();try{if(this.log(`[TEST] Iniciando teste de N.${t}...`),!this.interceptors.isWebpackAvailable())throw new Error("Webpack n\xE3o dispon\xEDvel");try{await this.interceptors.initialize()}catch(i){this.log(`[TEST] Aviso ao inicializar: ${i.message}`)}let e=this.getModule(t);if(e==null)return this.log(`[TEST] N.${t} n\xE3o encontrado`),{status:"not-found",module:null,methods:[],properties:[],logs:[...this.logs],testedAt:new Date};this.log(`[TEST] N.${t} encontrado!`);let o=this.getMethods(e),n=this.getProperties(e);this.log(`[TEST] M\xE9todos encontrados: ${o.length}`),this.log(`[TEST] Propriedades encontradas: ${n.length}`);let s=Date.now()-r;return this.log(`[TEST] N.${t} testado com sucesso em ${s}ms`),{status:"success",module:e,methods:o,properties:n,logs:[...this.logs],testedAt:new Date}}catch(e){return this.log(`[TEST] Erro ao testar N.${t}: ${e.message}`),{status:"error",module:null,methods:[],properties:[],error:e.message||"Erro desconhecido",logs:[...this.logs],testedAt:new Date}}}getModule(t){try{let r=this.interceptors,o={Msg:"Msg",Contact:"Contact",Label:"Label",Chat:"Chat",ChatCollection:"ChatCollection",PresenceCollection:"PresenceCollection",GroupMetadata:"GroupMetadata",User:"User",Conn:"Conn",MsgKey:"MsgKey",SendDelete:"SendDelete",addAndSendMsgToChat:"addAndSendMsgToChat",sendTextMsgToChat:"sendTextMsgToChat",uploadMedia:"uploadMedia",MediaPrep:"MediaPrep",MediaObject:"MediaObject",MediaTypes:"MediaTypes",MediaCollection:"MediaCollection",UploadUtils:"UploadUtils",DownloadManager:"DownloadManager",OpaqueData:"OpaqueData",blockContact:"blockContact",VCard:"VCard",UserConstructor:"UserConstructor",ChatState:"ChatState",Presence:"Presence",createGroup:"createGroup",getParticipants:"getParticipants",WidFactory:"WidFactory",QueryExist:"QueryExist",USyncQuery:"USyncQuery",USyncUser:"USyncUser",getEphemeralFields:"getEphemeralFields",canReplyMsg:"canReplyMsg",genMinimalLinkPreview:"genMinimalLinkPreview",findFirstWebLink:"findFirstWebLink",getSearchContext:"getSearchContext",sendReactionToMsg:"sendReactionToMsg",colorIndexToHex:"colorIndexToHex",StatusUtils:"StatusUtils",Composing:"Composing",ConversationSeen:"ConversationSeen",Playing:"Playing",StatusState:"StatusState",Classes:"Classes",Cmd:"Cmd"}[t];if(!o)return this.log(`[TEST] Getter n\xE3o mapeado para ${t}`),null;try{let n=r[o];return n!==void 0?n:null}catch{return null}}catch(r){return this.log(`[TEST] Erro ao acessar m\xF3dulo ${t}: ${r.message}`),null}}getMethods(t){let r=[];if(!t||typeof t!="object")return r;try{["on","off","get","set","find","filter","add","remove","forEach","map","has","keys","values","newId","createFromData","prepRawMedia","getOrCreateMediaObject","sendTextMsgToChat","addAndSendMsgToChat","createWid","canReplyMsg","getEphemeralFields","vcardFromContactModel","blockContact","uploadMedia","downloadManager","queryExist","USyncQuery","USyncUser","sendPresenceAvailable","sendChatStateComposing","createGroup","getParticipants","genMinimalLinkPreview","findFirstWebLink","getSearchContext","sendReactionToMsg","colorIndexToHex","setMyStatus","markComposing","sendConversationSeen","markPlayed","markStatusRead"].forEach(o=>{typeof t[o]=="function"&&r.push(o)}),t.prototype&&Object.getOwnPropertyNames(t.prototype).forEach(o=>{o!=="constructor"&&typeof t.prototype[o]=="function"&&r.push(`${o} (prototype)`)})}catch{}return r}getProperties(t){let r=[];if(!t||typeof t!="object")return r;try{["_models","_find","length","models","collection","_collection","default"].forEach(o=>{o in t&&r.push(o)});try{Object.getOwnPropertyNames(t).slice(0,20).forEach(n=>{!r.includes(n)&&typeof t[n]!="function"&&r.push(n)})}catch{}}catch{}return r}log(t){this.logs.push(`[${new Date().toISOString()}] ${t}`)}clearLogs(){this.logs=[]}getLogs(){return[...this.logs]}};var W=class I{static STORAGE_KEY="mettri_test_number";async saveTestNumber(t){try{let r=t.trim();typeof chrome<"u"&&chrome.storage&&chrome.storage.local?(await chrome.storage.local.set({[I.STORAGE_KEY]:r}),console.log(`[TEST] N\xFAmero de teste salvo no chrome.storage: ${r}`)):(localStorage.setItem(I.STORAGE_KEY,r),console.log(`[TEST] N\xFAmero de teste salvo no localStorage: ${r}`))}catch(r){console.error("[TEST] Erro ao salvar n\xFAmero de teste:",r);try{localStorage.setItem(I.STORAGE_KEY,t.trim()),console.log(`[TEST] N\xFAmero salvo no localStorage (fallback): ${t}`)}catch{throw new Error(`Erro ao salvar: ${r?.message||"Erro desconhecido"}`)}}}async getTestNumber(){try{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local){let e=(await chrome.storage.local.get(I.STORAGE_KEY))[I.STORAGE_KEY];if(e)return String(e)}let t=localStorage.getItem(I.STORAGE_KEY);return t?String(t):null}catch(t){console.error("[TEST] Erro ao carregar n\xFAmero de teste:",t);try{let r=localStorage.getItem(I.STORAGE_KEY);return r?String(r):null}catch{return null}}}async clearTestNumber(){try{typeof chrome<"u"&&chrome.storage&&chrome.storage.local&&(await chrome.storage.local.remove(I.STORAGE_KEY),console.log("[TEST] N\xFAmero de teste removido do chrome.storage")),localStorage.removeItem(I.STORAGE_KEY),console.log("[TEST] N\xFAmero de teste removido do localStorage")}catch(t){console.error("[TEST] Erro ao remover n\xFAmero de teste:",t);try{localStorage.removeItem(I.STORAGE_KEY)}catch{throw new Error(`Erro ao remover: ${t?.message||"Erro desconhecido"}`)}}}},L=new W;var N={X:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',Minus:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg>',ChevronLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>',ChevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>',ChevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>',Search:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',Send:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>',Play:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>',BarChart3:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>',Users:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',Server:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>',Megaphone:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 11 18-5v12L3 14v-3Z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg>',MessageSquare:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',Contact:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',Tag:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.586 8.586a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828Z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>',Phone:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>',Info:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',Settings:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',HelpCircle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>',RefreshCw:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>',Download:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>',Trash2:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>',MoreVertical:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>',Sun:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>',Moon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>'};function U(I){return N[I]||""}var F=class{container=null;interceptors;tester;moduleStatus={};testNumber=null;lastTestExecution=null;MODULE_DESCRIPTIONS={Msg:"Cole\xE7\xE3o de todas as mensagens do WhatsApp. Permite buscar, escutar eventos e acessar mensagens por ID.",Contact:"Cole\xE7\xE3o de todos os contatos. Permite buscar informa\xE7\xF5es de contatos, nomes e status.",Label:"Cole\xE7\xE3o de etiquetas (labels) usadas para organizar conversas.",Chat:"Cole\xE7\xE3o de conversas/chats. Permite acessar chats ativos e buscar conversas.",ChatCollection:"Alternativa para acessar cole\xE7\xE3o de conversas.",PresenceCollection:"Status online/offline dos contatos em tempo real.",GroupMetadata:"Metadados de grupos (participantes, configura\xE7\xF5es, etc).",User:"Informa\xE7\xF5es do usu\xE1rio atual logado.",Conn:"Conex\xE3o com servidores do WhatsApp.",MsgKey:"Cria IDs \xFAnicos para mensagens.",SendDelete:"Envia ou deleta mensagens.",addAndSendMsgToChat:"Adiciona mensagem ao chat e envia automaticamente.",sendTextMsgToChat:"Envia mensagem de texto para um chat espec\xEDfico.",uploadMedia:"Envia arquivos de m\xEDdia (fotos, v\xEDdeos, documentos).",MediaPrep:"Prepara arquivos de m\xEDdia antes de enviar.",MediaObject:"Representa um arquivo de m\xEDdia no WhatsApp.",MediaTypes:"Tipos de m\xEDdia suportados (imagem, v\xEDdeo, \xE1udio, etc).",MediaCollection:"Cole\xE7\xE3o de todos os arquivos de m\xEDdia.",UploadUtils:"Ferramentas auxiliares para upload de arquivos.",DownloadManager:"Gerencia downloads de arquivos recebidos.",OpaqueData:"Manipula dados opacos (criptografados).",blockContact:"Bloqueia um contato espec\xEDfico.",VCard:"Cart\xE3o de contato (vCard) para compartilhar informa\xE7\xF5es.",UserConstructor:"Constr\xF3i objetos de usu\xE1rio.",ChatState:"Estado do chat (digitando, gravando \xE1udio, etc).",Presence:"Presen\xE7a online/offline de contatos.",createGroup:"Cria um novo grupo no WhatsApp.",getParticipants:"Obt\xE9m lista de participantes de um grupo.",WidFactory:"Cria IDs de WhatsApp (WID) no formato correto.",QueryExist:"Verifica se um contato/chat existe.",USyncQuery:"Query de sincroniza\xE7\xE3o de dados.",USyncUser:"Sincroniza\xE7\xE3o de informa\xE7\xF5es de usu\xE1rio.",getEphemeralFields:"Obt\xE9m campos tempor\xE1rios de mensagens.",canReplyMsg:"Verifica se uma mensagem pode ser respondida.",genMinimalLinkPreview:"Gera preview de links automaticamente.",findFirstWebLink:"Encontra o primeiro link em um texto.",getSearchContext:"Obt\xE9m contexto para buscas.",sendReactionToMsg:"Envia rea\xE7\xE3o (emoji) para uma mensagem.",colorIndexToHex:"Converte \xEDndice de cor para c\xF3digo hexadecimal.",StatusUtils:"Utilit\xE1rios para status do WhatsApp.",Composing:"Indica quando algu\xE9m est\xE1 digitando.",ConversationSeen:"Marca conversa como vista.",Playing:"Indica quando \xE1udio est\xE1 sendo reproduzido.",StatusState:"Estado dos status (stories).",Classes:"Seletores CSS din\xE2micos usados pelo WhatsApp.",Cmd:"Comandos do WhatsApp (marcar lida, arquivar, etc)."};FRIENDLY_NAMES={Msg:"Mensagens",Contact:"Contatos",Label:"Etiquetas",Chat:"Conversas",ChatCollection:"Conversas Alt",PresenceCollection:"Presen\xE7a",GroupMetadata:"Grupos",User:"Usu\xE1rio",Conn:"Conex\xE3o",MsgKey:"Chave de Mensagem",SendDelete:"Enviar/Deletar",addAndSendMsgToChat:"Adicionar e Enviar Mensagem",sendTextMsgToChat:"Enviar Mensagem de Texto",uploadMedia:"Enviar M\xEDdia",MediaPrep:"Prepara\xE7\xE3o de M\xEDdia",MediaObject:"Objeto de M\xEDdia",MediaTypes:"Tipos de M\xEDdia",MediaCollection:"Cole\xE7\xE3o de M\xEDdia",UploadUtils:"Utilit\xE1rios de Upload",DownloadManager:"Gerenciador de Download",OpaqueData:"Dados Opacos",blockContact:"Bloquear Contato",VCard:"Cart\xE3o de Contato",UserConstructor:"Construtor de Usu\xE1rio",ChatState:"Estado do Chat",Presence:"Presen\xE7a",createGroup:"Criar Grupo",getParticipants:"Obter Participantes",WidFactory:"F\xE1brica de WID",QueryExist:"Verificar Exist\xEAncia",USyncQuery:"Query de Sincroniza\xE7\xE3o",USyncUser:"Sincroniza\xE7\xE3o de Usu\xE1rio",getEphemeralFields:"Obter Campos Ef\xEAmeros",canReplyMsg:"Pode Responder Mensagem",genMinimalLinkPreview:"Gerar Preview de Link",findFirstWebLink:"Encontrar Primeiro Link",getSearchContext:"Obter Contexto de Busca",sendReactionToMsg:"Enviar Rea\xE7\xE3o",colorIndexToHex:"Cor para Hexadecimal",StatusUtils:"Utilit\xE1rios de Status",Composing:"Digitando",ConversationSeen:"Conversa Vista",Playing:"Tocando",StatusState:"Estado de Status",Classes:"Classes CSS",Cmd:"Comandos"};MODULE_HIERARCHY=[{level:1,name:"Cole\xE7\xF5es Principais",modules:["Msg","Contact","Label","Chat"]},{level:2,name:"Cole\xE7\xF5es Secund\xE1rias",modules:["ChatCollection","PresenceCollection","GroupMetadata"]},{level:3,name:"Core",modules:["User","Conn"]},{level:4,name:"Mensagens",modules:["MsgKey","SendDelete","addAndSendMsgToChat","sendTextMsgToChat"]},{level:5,name:"M\xEDdia",modules:["uploadMedia","MediaPrep","MediaObject","MediaTypes","MediaCollection","UploadUtils","DownloadManager","OpaqueData"]},{level:6,name:"Contatos",modules:["blockContact","VCard","UserConstructor"]},{level:7,name:"Chat/Estado",modules:["ChatState","Presence","createGroup","getParticipants"]},{level:8,name:"Utilit\xE1rios",modules:["WidFactory","QueryExist","USyncQuery","USyncUser","getEphemeralFields","canReplyMsg"]},{level:9,name:"Links/Preview",modules:["genMinimalLinkPreview","findFirstWebLink","getSearchContext"]},{level:10,name:"Intera\xE7\xF5es",modules:["sendReactionToMsg","colorIndexToHex"]},{level:11,name:"Status",modules:["StatusUtils","Composing","ConversationSeen","Playing","StatusState"]},{level:12,name:"Seletores CSS",modules:["Classes"]},{level:13,name:"Comandos",modules:["Cmd"]}];REQUIRED_MODULES=["User","Conn","Chat","Msg","Contact","MsgKey","sendTextMsgToChat","addAndSendMsgToChat"];constructor(t){this.interceptors=t,this.tester=new R(t)}async render(){await this.loadTestNumber();let t=document.createElement("div");return t.className="flex flex-col gap-4",t.innerHTML=this.getHTML(),this.container=t,this.createToast(),this.setupEventListeners(),document.addEventListener("click",r=>{if(!this.container)return;r.target.closest(".mettri-test-module-info")||this.container.querySelectorAll(".mettri-info-tooltip").forEach(o=>{o.style.display="none"})}),t}createToast(){let t=this.container?.getRootNode(),r=t&&t instanceof ShadowRoot?t:document,e=r instanceof ShadowRoot?r.querySelector("#mettri-test-feedback-toast"):document.getElementById("mettri-test-feedback-toast");if(!e){let o=r instanceof ShadowRoot?r.querySelector("#mettri-panel"):document.getElementById("mettri-panel");o&&(e=document.createElement("div"),e.id="mettri-test-feedback-toast",e.className="mettri-test-feedback-toast",e.style.display="none",e.innerHTML=`
          <div class="mettri-test-feedback-toast-content">
            <button class="mettri-test-feedback-toast-close" id="mettri-test-feedback-close">\xD7</button>
            <div id="mettri-test-feedback-message" class="mettri-test-feedback-message"></div>
          </div>
        `,o.appendChild(e))}}getHTML(){return`
      ${this.renderRuntimeStatus()}

      <div class="flex gap-2">
        <button id="mettri-test-all" class="flex-1 h-8 rounded-xl text-[11px] font-medium glass-subtle glow-hover gap-1.5 flex items-center justify-center">
          <span class="w-3.5 h-3.5 text-primary">${U("Play")}</span>
          <span>Testar Todos</span>
        </button>
        <button id="mettri-test-report" class="flex-1 h-8 rounded-xl text-[11px] font-medium glass-subtle glow-hover gap-1.5 flex items-center justify-center">
          <span class="w-3.5 h-3.5 text-primary">${U("BarChart3")}</span>
          <span>Relat\xF3rio</span>
        </button>
      </div>

      <div id="mettri-test-report-section" style="display: none;">
        ${this.renderReport()}
      </div>

      <div class="glass-subtle rounded-xl p-3 space-y-2">
        <div class="flex items-center gap-2">
          <span class="w-3.5 h-3.5 text-primary">${U("Phone")}</span>
          <span class="text-[11px] font-medium text-foreground">N\xFAmero de Teste</span>
        </div>
        <div class="flex gap-2">
          <input 
            type="text" 
            id="mettri-test-number-input" 
            placeholder="5511999999999" 
            value="${this.testNumber||""}"
            class="flex-1 h-7 text-xs rounded-lg bg-background/50 border-border/30 focus:border-primary/50 px-3"
          />
          <button id="mettri-test-save-number" class="h-7 px-2 text-[10px] text-primary hover:bg-primary/10 rounded-lg">Salvar</button>
        </div>
        ${this.testNumber?`<div class="text-[11px] text-primary opacity-80">Salvo: ${this.testNumber}</div>`:""}
      </div>

      <div class="space-y-2">
        <span class="text-[11px] font-medium text-foreground px-1 block">M\xF3dulos da Sentinela</span>
        <div class="space-y-2" id="mettri-test-modules">
          ${this.renderModuleHierarchy()}
        </div>
      </div>
    `}renderRuntimeStatus(){let t=this.getRuntimeStatus(),r=e=>e===null?"desconhecido":e?"sim":"n\xE3o";return`
      <div class="glass-subtle rounded-xl p-3 space-y-2">
        <div class="flex items-center gap-2">
          <span class="w-3.5 h-3.5 text-primary">${U("Info")}</span>
          <span class="text-[11px] font-medium text-foreground">Status (Sinal Verde)</span>
        </div>

        <div class="text-[11px] text-muted-foreground space-y-1">
          <div><strong>window.Mettri:</strong> ${r(t.hasMettri)} ${t.mettriKeys.length>0?`(${t.mettriKeys.join(", ")})`:""}</div>
          <div><strong>window.require:</strong> ${t.requireType}</div>
          <div><strong>window.__d:</strong> ${r(t.hasD)}</div>
          <div><strong>webpackChunk:</strong> ${t.webpackChunkInfo}</div>
          <div><strong>AppState:</strong> ${t.appState??"desconhecido"}</div>
          <div><strong>WID (detectado):</strong> ${t.userWid??"n\xE3o detectado"}</div>
          <div><strong>Obrigat\xF3rios dispon\xEDveis:</strong> ${t.requiredAvailable}/${t.requiredTotal}</div>
        </div>
      </div>
    `}getRuntimeStatus(){let t=window.Mettri,r=!!t,e=t?Object.keys(t).slice(0,10):[],o=typeof window.require,n=typeof window<"u"&&"__d"in window?typeof window.__d<"u":null,s=window.webpackChunkwhatsapp_web_client,i=Array.isArray(s)?`array(len=${s.length})`:typeof s,a=null,h=window.require;if(typeof h=="function")try{let c=h("WAWebSocketModel")?.Socket?.state;typeof c=="string"&&(a=c)}catch{}let l=this.tryDetectUserWid(),M=this.interceptors,f=this.REQUIRED_MODULES.filter(g=>!!M[g]).length;return{hasMettri:r,mettriKeys:e,requireType:o,hasD:n,webpackChunkInfo:i,appState:a,userWid:l,requiredAvailable:f,requiredTotal:this.REQUIRED_MODULES.length}}tryDetectUserWid(){try{let t=this.interceptors.User,r=null;if(typeof t=="function")try{r=t()}catch{r=null}else t&&typeof t=="object"&&(r=t.getMaybeMePnUser?.()??t.getMaybeMeLidUser?.()??null);if(!r||typeof r!="object")return null;let e=r;if(e.id&&typeof e.id=="object"&&e.id!==null){let o=e.id._serialized;if(typeof o=="string")return o}if(typeof e._serialized=="string")return e._serialized;if(typeof e.wid=="string")return e.wid;if(typeof e.user=="string"){let o=typeof e.server=="string"?e.server:"c.us";return`${e.user}@${o}`}return null}catch{return null}}renderModuleHierarchy(){return this.MODULE_HIERARCHY.map(t=>{let r=t.modules.map(o=>{let n=this.getModuleStatus(o),s=this.getStatusIcon(n),i=this.getStatusClass(n),a=this.getFriendlyName(o),h=this.getModuleDescription(o),l=this.escapeHtml(a),M=this.escapeHtml(o);return`
          <div class="flex items-center gap-2 px-3 py-2 hover:bg-accent/50 transition-colors group ${i}" data-module="${M}">
            <div class="w-4 h-4 flex items-center justify-center flex-shrink-0" data-status-indicator>${s}</div>
            <span class="w-3.5 h-3.5 text-muted-foreground/60 flex items-center justify-center">${U("Info")}</span>
            <span class="flex-1 text-[11px] text-foreground truncate" title="${l}">${l}</span>
            <div class="flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity">
              <button class="h-5 px-1.5 text-[10px] text-primary hover:text-primary hover:bg-primary/10 rounded-md" data-action="test" data-module="${M}">Testar</button>
              <button class="h-5 px-1.5 text-[10px] text-muted-foreground hover:text-foreground hover:bg-accent rounded-md" data-action="details" data-module="${M}">Ver</button>
            </div>
          </div>
        `}).join(""),e=t.level===1;return`
        <div class="glass-subtle rounded-xl overflow-hidden">
          <button class="w-full flex items-center gap-2 px-3 py-2 hover:bg-accent/30 transition-colors" data-level="${t.level}" aria-expanded="${e?"true":"false"}">
            <span class="w-3.5 h-3.5 text-muted-foreground/70 flex items-center justify-center" style="transform: ${e?"rotate(0deg)":"rotate(-90deg)"}">${U("ChevronDown")}</span>
            <span class="text-[11px] font-medium text-foreground">N\xEDvel ${t.level}: ${t.name}</span>
          </button>
          <div class="border-t border-border/20" data-level-modules="${t.level}" style="display: ${e?"block":"none"};">
            ${r}
          </div>
        </div>
      `}).join("")}renderReport(){let t=this.getStats(),r=this.lastTestExecution?this.formatTimeAgo(this.lastTestExecution):"Nunca";return`
      <div class="mettri-test-report glass-subtle rounded-xl p-3">
        <h3 style="font-size: 11px; font-weight: 500; color: var(--mettri-text, #FFFFFF); margin: 0 0 12px 0; line-height: 1.3; letter-spacing: -0.01em;">Relat\xF3rio de Testes</h3>
        <div class="mettri-test-report-stat">
          <strong>Total:</strong> ${t.total} m\xF3dulos
        </div>
        <div class="mettri-test-report-stat">
          <strong>Obrigat\xF3rios OK:</strong> ${t.requiredSuccess}/${t.requiredTotal}
        </div>
        <div class="mettri-test-report-stat">
          <strong>Funcionando:</strong> ${t.success}
        </div>
        <div class="mettri-test-report-stat">
          <strong>N\xE3o funciona:</strong> ${t.error}
        </div>
        <div class="mettri-test-report-stat">
          <strong>N\xE3o testado:</strong> ${t.notTested}
        </div>
        <div class="mettri-test-report-stat">
          <strong>Testando:</strong> ${t.testing}
        </div>
        <div class="mettri-test-report-stat">
          <strong>\xDAltima execu\xE7\xE3o:</strong> ${r}
        </div>
        <div class="mettri-test-report-actions">
          <button id="mettri-test-export-json" class="mettri-test-btn-small">Exportar JSON</button>
          <button id="mettri-test-copy-logs" class="mettri-test-btn-small">Copiar Logs</button>
        </div>
      </div>
    `}setupEventListeners(){if(!this.container)return;let t=this.container.querySelector("#mettri-test-save-number");t?.addEventListener("click",async()=>{let i=this.container?.querySelector("#mettri-test-number-input");if(i?.value){let a=t.textContent;t.disabled=!0,t.textContent="Salvando...";try{await this.saveTestNumber(i.value),this.showFeedback("N\xFAmero salvo com sucesso!","success")}catch(h){console.error("[TEST] Erro ao salvar n\xFAmero:",h);let l=h?.message||"Erro desconhecido ao salvar";this.showFeedback(`Erro: ${l}`,"error")}finally{t.disabled=!1,t.textContent=a||"Salvar"}}else this.showFeedback("\u26A0\uFE0F Digite um n\xFAmero v\xE1lido","warning")}),this.container.querySelector("#mettri-test-clear-number")?.addEventListener("click",async()=>{try{await this.clearTestNumber(),this.showFeedback("N\xFAmero removido","success")}catch{this.showFeedback("Erro ao remover n\xFAmero","error")}}),this.container.addEventListener("click",i=>{let a=i.target;if(a.hasAttribute("data-action")&&a.getAttribute("data-action")==="test"){let h=a.getAttribute("data-module");h&&(i.preventDefault(),i.stopPropagation(),this.testModule(h))}}),this.container.addEventListener("click",i=>{let a=i.target,h=a.getAttribute("data-action"),l=a.getAttribute("data-module");if(a.classList.contains("mettri-test-module-info")||a.closest(".mettri-test-module-info")){i.preventDefault(),i.stopPropagation();let M=a.closest(".mettri-test-module-info");if(M){let f=M.querySelector(".mettri-info-tooltip");if(f){let g=f.style.display==="block";this.container?.querySelectorAll(".mettri-info-tooltip").forEach(p=>{p.style.display="none"}),f.style.display=g?"none":"block"}}return}a.closest(".mettri-test-module-info")||this.container?.querySelectorAll(".mettri-info-tooltip").forEach(M=>{M.style.display="none"}),h==="details"&&l&&(i.preventDefault(),i.stopPropagation(),this.showModuleDetails(l))}),this.container.querySelector("#mettri-test-all")?.addEventListener("click",()=>{this.testAllModules()}),this.container.querySelector("#mettri-test-report")?.addEventListener("click",()=>{this.toggleReport()}),this.container.addEventListener("click",i=>{let h=i.target.closest("[data-level]");if(h&&h.hasAttribute("data-level")){i.preventDefault(),i.stopPropagation();let l=h.getAttribute("data-level");if(l){let M=this.container?.querySelector(`[data-level-modules="${l}"]`),f=h.querySelector("svg");M&&(M.style.display!=="none"?(M.style.display="none",h.setAttribute("aria-expanded","false"),f&&(f.style.transform="rotate(-90deg)")):(M.style.display="block",h.setAttribute("aria-expanded","true"),f&&(f.style.transform="rotate(0deg)")))}}}),this.container.querySelector("#mettri-test-export-json")?.addEventListener("click",()=>{this.exportJSON()}),this.container.querySelector("#mettri-test-copy-logs")?.addEventListener("click",()=>{this.copyLogs()})}async loadTestNumber(){this.testNumber=await L.getTestNumber()}async saveTestNumber(t){try{let r=t.trim();if(!r||r.length<10)throw new Error("N\xFAmero inv\xE1lido. Digite pelo menos 10 d\xEDgitos.");await L.saveTestNumber(r),this.testNumber=r,this.updateTestNumberDisplay()}catch(r){throw console.error("[TEST] Erro ao salvar n\xFAmero:",r),r}}async clearTestNumber(){await L.clearTestNumber(),this.testNumber=null,this.updateTestNumberDisplay()}updateTestNumberDisplay(){if(!this.container)return;let t=this.container.querySelector("#mettri-test-number-input");t&&(t.value=this.testNumber||"");let r=this.container.querySelector(".mettri-test-number-saved");if(this.testNumber)if(r)r.textContent=`Salvo: ${this.testNumber}`;else{let e=this.container.querySelector(".mettri-test-number-config"),o=document.createElement("div");o.className="mettri-test-number-saved",o.textContent=`Salvo: ${this.testNumber}`,e?.parentNode?.insertBefore(o,e?.nextSibling)}else r?.remove()}async testModule(t){if(this.container){console.log(`[TEST] Iniciando teste de ${t}...`),this.updateModuleStatus(t,{status:"testing"}),this.updateModuleDisplay(t);try{let r=await this.tester.testModule(t);this.moduleStatus[t]=r,this.lastTestExecution=new Date,this.updateModuleDisplay(t);let e="";if(r.status==="success"&&r.module&&(e=await this.performFunctionalTest(t,r.module)),r.status==="success"){let o=`${this.getFriendlyName(t)} testado com sucesso!`,n=e?`${o}
${e}`:o;this.showFeedback(n,"success")}else r.status==="not-found"?this.showFeedback(`${this.getFriendlyName(t)} n\xE3o encontrado`,"error"):this.showFeedback(`Erro ao testar ${this.getFriendlyName(t)}: ${r.error||"Erro desconhecido"}`,"error");console.log(`[TEST] Resultado de ${t}:`,r.status)}catch(r){console.error(`[TEST] Erro ao testar ${t}:`,r),this.moduleStatus[t]={status:"error",module:null,methods:[],properties:[],error:r.message,logs:[],testedAt:new Date},this.updateModuleDisplay(t),this.showFeedback(`Erro ao testar ${this.getFriendlyName(t)}: ${r.message}`,"error")}}}async testAllModules(){if(!this.container)return;let t=this.container.querySelector("#mettri-test-all");if(t){t.disabled=!0;let n=t.querySelector("span");n&&(n.textContent="Testando...")}let r=this.MODULE_HIERARCHY.flatMap(n=>n.modules),e=[...this.REQUIRED_MODULES,...r.filter(n=>!this.REQUIRED_MODULES.includes(n))],o=0;for(let n of e)if(await this.testModule(n),o++,t){let s=t.querySelector("span");s&&(s.textContent=`Testando... (${o}/${e.length})`)}if(this.lastTestExecution=new Date,this.updateReport(),t){t.disabled=!1;let n=t.querySelector("span");n&&(n.textContent="Testar Todos")}}showModuleDetails(t){let r=this.moduleStatus[t],e=this.getFriendlyName(t);if(!r){alert(`${e} (N.${t})

M\xF3dulo ainda n\xE3o foi testado. Clique em "Testar" primeiro.`);return}let o=`
${e} (N.${t})

Status: ${this.getStatusText(r.status)}
Testado em: ${r.testedAt.toLocaleString()}

M\xE9todos encontrados (${r.methods.length}):
${r.methods.length>0?r.methods.join(", "):"Nenhum"}

Propriedades encontradas (${r.properties.length}):
${r.properties.length>0?r.properties.join(", "):"Nenhuma"}

${r.error?`Erro: ${r.error}
`:""}`;r.logs&&r.logs.length>0?o+=`

Logs (${r.logs.length}):
${r.logs.join(`
`)}`:o+=`

Logs: Nenhum log dispon\xEDvel.`,alert(o.trim())}updateModuleDisplay(t){if(!this.container)return;let r=this.container.querySelector(`[data-module="${t}"]`);if(!r)return;let e=this.getModuleStatus(t),o=this.getStatusIcon(e),n=this.getStatusClass(e),s=r.querySelector("[data-status-indicator]");s&&(s.innerHTML=o),r.className=`mettri-test-module ${n}`}updateModuleStatus(t,r){this.moduleStatus[t]=r}getModuleStatus(t){return this.moduleStatus[t]||null}getStatusIcon(t){return t?t.status==="testing"?'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--mettri-warning-color, #FFB938);"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>':t.status==="success"?'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color: var(--mettri-success-color, #00A884);"><polyline points="20 6 9 17 4 12"/></svg>':t.status==="error"||t.status==="not-found"?'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--mettri-error-color, #EA0038);"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>'}getStatusClass(t){return t?t.status==="testing"?"status-testing":t.status==="success"?"status-success":t.status==="error"||t.status==="not-found"?"status-error":"status-not-tested":"status-not-tested"}getStatusText(t){return{success:"Funcionando",error:"Erro","not-found":"N\xE3o encontrado",testing:"Testando"}[t]||"\u26AA N\xE3o testado"}getStats(){let t=this.MODULE_HIERARCHY.flatMap(a=>a.modules),r=0,e=0,o=0,n=0;t.forEach(a=>{let h=this.moduleStatus[a];h?h.status==="success"?r++:h.status==="testing"?n++:e++:o++});let s=this.REQUIRED_MODULES.length,i=0;return this.REQUIRED_MODULES.forEach(a=>{this.moduleStatus[a]?.status==="success"&&i++}),{total:t.length,requiredTotal:s,requiredSuccess:i,success:r,error:e,notTested:o,testing:n}}toggleReport(){if(!this.container)return;let t=this.container.querySelector("#mettri-test-report-section");t&&(t.getAttribute("style")?.includes("display: none")?(this.updateReport(),t.setAttribute("style","display: block;")):t.setAttribute("style","display: none;"))}updateReport(){if(!this.container)return;let t=this.container.querySelector("#mettri-test-report-section");t&&(t.innerHTML=this.renderReport(),this.setupReportEventListeners())}setupReportEventListeners(){if(!this.container)return;this.container.querySelector("#mettri-test-export-json")?.addEventListener("click",()=>{this.exportJSON()}),this.container.querySelector("#mettri-test-copy-logs")?.addEventListener("click",()=>{this.copyLogs()})}exportJSON(){let t=this.MODULE_HIERARCHY.flatMap(i=>i.modules),r={testNumber:this.testNumber,lastExecution:this.lastTestExecution?.toISOString(),stats:this.getStats(),modules:t.map(i=>{let a=this.moduleStatus[i];return{name:i,status:a?.status||"not-tested",methods:a?.methods||[],properties:a?.properties||[],error:a?.error,testedAt:a?.testedAt?.toISOString()}})},e=JSON.stringify(r,null,2),o=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=`mettri-test-report-${new Date().toISOString().split("T")[0]}.json`,s.click(),URL.revokeObjectURL(n)}async copyLogs(){let t=this.MODULE_HIERARCHY.flatMap(e=>e.modules),r=[];if(t.forEach(e=>{let o=this.moduleStatus[e];o&&o.logs.length>0&&(r.push(`
=== N.${e} ===`),r.push(...o.logs))}),r.length===0){alert("Nenhum log dispon\xEDvel. Execute testes primeiro.");return}try{await navigator.clipboard.writeText(r.join(`
`)),alert("Logs copiados para a \xE1rea de transfer\xEAncia!")}catch{alert("Erro ao copiar logs. Tente selecionar e copiar manualmente.")}}getFriendlyName(t){return this.FRIENDLY_NAMES[t]||t}getModuleDescription(t){return this.MODULE_DESCRIPTIONS[t]||"M\xF3dulo da Sentinela do WhatsApp."}showFeedback(t,r="success"){this.createToast();let e=document.getElementById("mettri-test-feedback-toast"),o=document.getElementById("mettri-test-feedback-message"),n=document.getElementById("mettri-test-feedback-close");if(e&&o){o.innerHTML=t.split(`
`).map(i=>{let a=document.createElement("div");return a.textContent=i,a.outerHTML}).join(""),e.classList.remove("mettri-test-feedback-toast-success","mettri-test-feedback-toast-error","mettri-test-feedback-toast-warning"),e.classList.add(`mettri-test-feedback-toast-${r}`),e.style.display="flex";let s=()=>{e.style.display="none"};if(n){let i=n.cloneNode(!0);n.parentNode?.replaceChild(i,n),i.addEventListener("click",s)}setTimeout(()=>{e.style.display==="flex"&&(e.style.display="none")},1e4)}}async performFunctionalTest(t,r){try{if(t==="Msg"&&typeof r.get=="function"){console.log("[TEST] Executando teste funcional de Mensagens..."),this.showExecutionIndicator(t,"Buscando mensagens...");try{let e="";if(this.testNumber){let o=`${this.testNumber}@c.us`;console.log(`[TEST] Buscando mensagens do n\xFAmero de teste: ${o}`);try{let n=r.get(o);if(n){let s=Array.isArray(n)?n.length:1;e=`\u{1F4E8} Encontradas ${s} mensagem(ns) do n\xFAmero ${this.testNumber}`,console.log("[TEST] Mensagens encontradas:",s)}}catch(n){console.log("[TEST] Erro ao buscar mensagens do n\xFAmero:",n.message)}}if(r._models&&Array.isArray(r._models)){let o=r._models.length,n=`\u{1F4CA} Total: ${o} mensagem(ns) na cole\xE7\xE3o`;if(e=e?`${e}
${n}`:n,console.log("[TEST] Total de mensagens na cole\xE7\xE3o:",o),r._models.length>0){let s=r._models[0],i=s.body?s.body.substring(0,50):"Sem conte\xFAdo";e+=`
\u{1F4AC} Exemplo: "${i}${i.length>=50?"...":""}"`}}return typeof r.on=="function"&&(e+=`
\u{1F442} Pode escutar eventos de novas mensagens`),this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),console.log("[TEST] Erro ao buscar mensagens:",e.message),`\u26A0\uFE0F M\xF3dulo encontrado mas erro ao buscar dados: ${e.message}`}}if(t==="Contact"&&typeof r.get=="function"){this.showExecutionIndicator(t,"Buscando contatos...");try{let e="";if(this.testNumber){let o=`${this.testNumber}@c.us`,n=r.get(o);n&&(e=`\u{1F464} Contato encontrado: ${n.name||n.pushname||"Sem nome"}`)}if(r._models&&Array.isArray(r._models)){let o=r._models.length;e=e?`${e}
\u{1F4CA} Total: ${o} contato(s)`:`\u{1F4CA} Total: ${o} contato(s)`}return this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Label"&&typeof r.get=="function"){this.showExecutionIndicator(t,"Buscando etiquetas...");try{let e="";if(r._models&&Array.isArray(r._models)){let o=r._models.length;if(e=`\u{1F3F7}\uFE0F Total: ${o} etiqueta(s) encontrada(s)`,o>0){let n=r._models.slice(0,10).map(s=>s.name||s.id||"Sem nome").filter(s=>s&&s!=="Sem nome");n.length>0&&(e+=`
\u{1F4CB} Nomes: ${n.join(", ")}`,o>10&&(e+=`
... e mais ${o-10} etiqueta(s)`))}}else try{let o=r.all?r.all():null;if(o&&Array.isArray(o)&&o.length>0){e=`\u{1F3F7}\uFE0F Total: ${o.length} etiqueta(s) encontrada(s)`;let s=o.slice(0,10).map(i=>i.name||i.id||"Sem nome").filter(i=>i&&i!=="Sem nome");s.length>0&&(e+=`
\u{1F4CB} Nomes: ${s.join(", ")}`)}}catch{}return this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Chat"&&typeof r.get=="function"){this.showExecutionIndicator(t,"Buscando conversas...");try{let e="";if(r._models&&Array.isArray(r._models)){if(e=`\u{1F4AC} Total: ${r._models.length} conversa(s) na cole\xE7\xE3o`,this.testNumber){let n=`${this.testNumber}@c.us`;try{let s=r.get(n);if(s){let i=s.name||s.formattedTitle||s.pushname||"Sem nome",a=s.unreadCount||0;e+=`
\u{1F4F1} Conversa encontrada: "${i}"`,a>0&&(e+=`
\u{1F514} ${a} mensagem(ns) n\xE3o lida(s)`)}else e+=`
\u26A0\uFE0F Conversa do n\xFAmero ${this.testNumber} n\xE3o encontrada`}catch(s){console.log("[TEST] Erro ao buscar conversa:",s.message)}}if(r._models.length>0){let s=r._models.slice(0,3).map(i=>i.name||i.formattedTitle||i.pushname||"Sem nome").filter(i=>i&&i!=="Sem nome");s.length>0&&(e+=`
\u{1F4CB} Exemplos: ${s.join(", ")}`)}}return this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="ChatCollection"){this.showExecutionIndicator(t,"Buscando cole\xE7\xE3o de conversas...");try{let e="",o=this.interceptors.ChatCollection,n=this.interceptors.Chat,s=[];if(o){if(o._models&&Array.isArray(o._models)&&o._models.length>0)s=o._models;else if(typeof o.get=="function")try{n&&n._models&&(s=n._models)}catch{}}if(s.length===0&&n&&n._models&&Array.isArray(n._models)&&(s=n._models),s.length>0){e=`\u{1F4AC} Total: ${s.length} conversa(s) encontrada(s)`;let h=s.slice(0,5).map(l=>{let M=l.name||l.formattedTitle||l.pushname||l.id?.split("@")[0]||"Sem nome",f=l.unreadCount||0;return f>0?`${M} (${f} n\xE3o lidas)`:M}).filter(l=>l);h.length>0&&(e+=`

\u{1F4CB} Primeiras conversas:
${h.slice(0,5).map((l,M)=>`   ${M+1}. ${l}`).join(`
`)}`,s.length>5&&(e+=`
   ... e mais ${s.length-5} conversa(s)`))}else e=`\u2705 M\xF3dulo ChatCollection encontrado
\u26A0\uFE0F Nenhuma conversa encontrada no momento`;return this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="PresenceCollection"){this.showExecutionIndicator(t,"Escutando eventos de presen\xE7a...");try{let e="",o=this.interceptors.PresenceCollection,n=this.interceptors.Chat;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo PresenceCollection n\xE3o encontrado";if(typeof o.on!="function")return this.hideExecutionIndicator(t),"\u274C PresenceCollection n\xE3o tem m\xE9todo .on()";if(!n||typeof n.find!="function")return this.hideExecutionIndicator(t),"\u274C Chat.find() n\xE3o dispon\xEDvel";let s={online:new Map,offline:new Map};console.log("[TEST] PresenceCollection estrutura (eventos):",{hasOn:typeof o.on=="function",hasChatFind:typeof n.find=="function",presenceCollectionType:typeof o});let i=async(p,c)=>{try{if(p.isUser!==1)return;let T=p.id?._serialized;if(!T||typeof T!="string")return;try{let m=await n.find(T);if(!m)return;let u=m.__x_formattedTitle||m.formattedTitle||m.name||T.split("@")[0]||"Contato",S=c===1;S?s.online.set(T,{name:u,timestamp:Date.now()}):s.offline.set(T,{name:u,timestamp:Date.now()}),console.log(`[TEST] Evento de presen\xE7a: ${u} - ${S?"Online":"Offline"}`)}catch(m){console.warn("[TEST] Erro ao buscar chat no evento de presen\xE7a:",m)}}catch(T){console.warn("[TEST] Erro no eventHandler de presen\xE7a:",T)}};o.on("change:isOnline",i),console.log("[TEST] Listener de eventos change:isOnline configurado");let a=this.interceptors.Presence;if(a&&typeof a.subscribePresence=="function"&&n)try{if(n._models&&Array.isArray(n._models)){let p=0,c=n._models;for(let T of c.slice(0,100))try{let m="";if(typeof T.id=="string"?m=T.id:T.id?._serialized&&typeof T.id._serialized=="string"?m=T.id._serialized:T.id?.user&&typeof T.id.user=="string"&&(m=`${T.id.user}@${T.id.server||"c.us"}`),m&&typeof m=="string"&&m.includes("@c.us")&&!m.includes("@g.us")&&!m.includes("@lid"))try{a.subscribePresence(T.id||m),p++}catch{}}catch{}console.log(`[TEST] Presen\xE7a subscrevida para ${p} contatos (for\xE7ando eventos)`),await new Promise(T=>setTimeout(T,1e3))}}catch(p){console.warn("[TEST] Erro ao subscrever presen\xE7a:",p)}console.log("[TEST] Aguardando eventos de presen\xE7a (5 segundos)..."),await new Promise(p=>setTimeout(p,5e3));let h=s.online.size,l=s.offline.size,M=h+l;if(M<10&&typeof o.get=="function"&&n?._models){console.log("[TEST] Poucos eventos recebidos, tentando buscar estado atual...");try{let p=n._models.slice(0,50);for(let c of p)try{let T="";if(typeof c.id=="string"?T=c.id:c.id?._serialized&&typeof c.id._serialized=="string"?T=c.id._serialized:c.id?.user&&typeof c.id.user=="string"&&(T=`${c.id.user}@${c.id.server||"c.us"}`),!T||typeof T=="string"&&(T.includes("@g.us")||T.includes("@lid")))continue;let m=o.get(T);if(m&&m!==null&&m!==void 0){let u=c.__x_formattedTitle||c.formattedTitle||c.name||T.split("@")[0]||"Contato",S=m.isOnline===!0||m.type==="available"||m.presence==="available"||m.lastSeen&&typeof m.lastSeen=="number"&&Date.now()-m.lastSeen<3e5;!s.online.has(T)&&!s.offline.has(T)&&(S?s.online.set(T,{name:u,timestamp:Date.now()}):s.offline.set(T,{name:u,timestamp:Date.now()}))}}catch{}console.log(`[TEST] Busca proativa adicionou ${s.online.size+s.offline.size-M} contatos`)}catch(p){console.warn("[TEST] Erro na busca proativa de presen\xE7a:",p)}}h=s.online.size,l=s.offline.size,M=h+l;let f=Array.from(s.online.values()).slice(0,10).map(p=>p.name),g=Array.from(s.offline.values()).slice(0,5).map(p=>p.name);try{typeof o.off=="function"?o.off("change:isOnline",i):typeof o.removeListener=="function"&&o.removeListener("change:isOnline",i),console.log("[TEST] Listener de presen\xE7a removido")}catch(p){console.warn("[TEST] Erro ao remover listener:",p)}return M>0?(e=`\u{1F4CA} Total de contatos verificados: ${M}`,e+=`
\u{1F7E2} Online: ${h} contato(s)`,e+=`
\u26AB Offline: ${l} contato(s)`,f.length>0?(e+=`

\u{1F7E2} Online agora:
${f.map((p,c)=>`   ${c+1}. ${p}`).join(`
`)}`,h>f.length&&(e+=`
   ... e mais ${h-f.length} online`)):e+=`

\u26A0\uFE0F Nenhum contato online no momento`,g.length>0&&(e+=`

\u26AB Offline:
${g.map((p,c)=>`   ${c+1}. ${p}`).join(`
`)}`,l>g.length&&(e+=`
   ... e mais ${l-g.length} offline`))):e=`\u2705 M\xF3dulo de presen\xE7a encontrado
\u26A0\uFE0F Nenhum evento de presen\xE7a recebido nos \xFAltimos 5 segundos

\u{1F4A1} Dica: Eventos s\xE3o reativos - aparecem quando h\xE1 mudan\xE7as de status`,this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="GroupMetadata"){this.showExecutionIndicator(t,"Buscando metadados de grupos...");try{let e="",o=this.interceptors.GroupMetadata;if(o){let n=this.interceptors.Chat,s=[];if(console.log("[TEST] Chat module estrutura:",{hasModels:!!n?._models,modelsCount:n?._models?.length||0,hasGet:typeof n?.get=="function",sampleChatIds:n?._models?.slice(0,5).map(i=>({id:i.id,idSerialized:i.id?._serialized,name:i.name||i.formattedTitle,isGroup:i.isGroup,type:i.type,hasParticipants:!!i.participants,hasGroupMetadata:!!i.groupMetadata}))||[]}),n&&n._models&&Array.isArray(n._models)){let i=n._models;if(s=i.filter(a=>{try{let h=a.id||a._id||"",l=a.id?._serialized||a._serialized||"",M=l||h;return!M||typeof M!="string"?!1:a.isGroup===!0||a.type==="group"||a.kind==="group"||a.isGroupChat===!0||M.endsWith("@g.us")||M.includes("@")&&M.split("@")[1]==="g.us"||h.includes("g.us")||l.includes("g.us")}catch{return!1}}),s.length===0&&(s=i.filter(a=>{try{let h=a.id||a._id||"",l=a.id?._serialized||a._serialized||"",M=l||h;if(!M||typeof M!="string")return!1;let f=a.participants||a.groupMetadata?.participants,g=f&&(Array.isArray(f)?f.length>0:typeof f=="object"?Object.keys(f).length>0:!1),p=a.groupMetadata!==void 0&&a.groupMetadata!==null,c=M.includes("g.us")||h.includes("g.us")||l.includes("g.us"),T=a.groupDesc!==void 0||a.groupSubject!==void 0||a.groupInviteLink!==void 0||a.groupRestrict!==void 0||a.groupDescId!==void 0||a.groupInvite!==void 0;return c||g&&p||c&&T}catch{return!1}})),s.length===0&&(s=i.filter(a=>{try{let h=a.id||a._id||"",M=a.id?._serialized||a._serialized||""||h;return M&&typeof M=="string"&&M.includes("g.us")}catch{return!1}})),s.length===0)try{let a=Array.from(document.querySelectorAll('[data-testid="cell-frame-container"], [role="listitem"]')),h=[];for(let l of a){let M=l.textContent||"",f=l.getAttribute("title")||"",g=l.querySelector('[data-icon="group"], [data-icon="default-group"]'),p=l.querySelectorAll('[data-testid="avatar"], img[alt*="group"]').length>1;if(g||p){let c=f||M.split(`
`)[0]||"";if(c&&!h.includes(c)){h.push(c);let T=i.find(m=>{let u=m.name||m.formattedTitle||m.subject||"";return u&&(u.includes(c)||c.includes(u))});T&&!s.includes(T)&&s.push(T)}}}}catch{}}if(s.length===0&&o.default)try{n&&n._models&&(s=n._models.filter(a=>{try{let h=a.id||a._id||"";return h&&typeof h=="string"&&h.includes("@")}catch{return!1}}).filter(a=>{let h=a.id||"";return a.participants&&(Array.isArray(a.participants)?a.participants.length>0:typeof a.participants=="object"?Object.keys(a.participants).length>0:!1)||h.includes("g.us")||a.groupMetadata!==void 0&&a.groupMetadata!==null}))}catch{}if(s.length>0){e=`\u{1F465} Total: ${s.length} grupo(s) encontrado(s)

`;let i=s.slice(0,5);i.forEach((a,h)=>{let l=[],M=a.name||a.formattedTitle||a.subject||a.id?.split("@")[0]||"Sem nome";if(l.push(`\u{1F4CB} ${M}`),a.id&&l.push(`ID: ${a.id}`),a.participants){let f=Array.isArray(a.participants)?a.participants.length:0;l.push(`\u{1F465} ${f} participante(s)`)}else if(a.groupMetadata){let f=a.groupMetadata;f.participants&&Array.isArray(f.participants)&&l.push(`\u{1F465} ${f.participants.length} participante(s)`)}if(a.description){let f=a.description.length>30?a.description.substring(0,30)+"...":a.description;l.push(`\u{1F4DD} "${f}"`)}if(a.creation){let f=new Date(a.creation*1e3);l.push(`\u{1F4C5} Criado em: ${f.toLocaleDateString()}`)}if(a.groupMetadata?.owner?l.push(`\u{1F451} Dono: ${a.groupMetadata.owner}`):a.owner&&l.push(`\u{1F451} Dono: ${a.owner}`),a.restrict!==void 0&&l.push(`\u{1F512} Restrito: ${a.restrict?"Sim":"N\xE3o"}`),a.ephemeralDuration&&l.push(`\u23F1\uFE0F Tempor\xE1rias: ${a.ephemeralDuration}s`),e+=l.join(" | ")+`
`,a.participants&&Array.isArray(a.participants)&&a.participants.length>0){let f=a.participants.slice(0,3).map(g=>g.id?.split("@")[0]||g.name||"Participante").filter(g=>g);f.length>0&&(e+=`   \u{1F464} Participantes: ${f.join(", ")}`,a.participants.length>3&&(e+=` (+${a.participants.length-3})`),e+=`
`)}h<i.length-1&&(e+=`
`)}),s.length>5&&(e+=`
... e mais ${s.length-5} grupo(s)`)}else if(o.default){let i=o.default,h=["getGroupMetadataFromGroupInvite","getGroupInfoFromInvite","getGroupMetadata"].filter(l=>typeof i[l]=="function");h.length>0?(e=`\u2705 M\xE9todos de grupos dispon\xEDveis:
\u{1F4E6} ${h.join(", ")}

`,e+="\u26A0\uFE0F Nenhum grupo encontrado nas conversas ativas"):e=`\u2705 M\xF3dulo GroupMetadata encontrado
\u26A0\uFE0F Nenhum grupo encontrado`}else e=`\u2705 M\xF3dulo GroupMetadata encontrado
\u26A0\uFE0F Nenhum grupo encontrado`}else e="\u274C M\xF3dulo GroupMetadata n\xE3o encontrado";return this.hideExecutionIndicator(t),e.trim()}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="User"){this.showExecutionIndicator(t,"Buscando informa\xE7\xF5es do usu\xE1rio...");try{let e="",o=null;try{let n=this.interceptors.User;if(typeof n=="function")try{if(o=n(),!o){let s=this.interceptors;s.getMaybeMeLidUser&&typeof s.getMaybeMeLidUser=="function"&&(o=s.getMaybeMeLidUser())}}catch(s){console.log("[TEST] Erro ao chamar userGetter:",s)}if(!o&&n&&typeof n=="object"){let s=["getMaybeMePnUser","getMaybeMeLidUser","getMePnUserOrThrow","getMeLidUserOrThrow","getMeDisplayNameOrThrow","getMe","getMeUser","getCurrentUser"];for(let i of s)try{if(typeof n[i]=="function"){let a=n[i]();if(a&&typeof a=="object"&&a!==null){o=a;break}}}catch{}}}catch(n){console.log("[TEST] Erro ao acessar User:",n)}if(!o)try{let n=window.N;if(n){if(n.User&&typeof n.User=="function")o=n.User();else if(n.User&&typeof n.User=="object"){let s=["getMaybeMePnUser","getMaybeMeLidUser","getMePnUserOrThrow"];for(let i of s)try{if(typeof n.User[i]=="function"){let a=n.User[i]();if(a&&a!==null){o=a;break}}}catch{}}}}catch{}if(!o)try{let n=this.interceptors.Contact;if(n&&n._models){let s=n._models.find(i=>i.isMe===!0||i.isMyContact===!0||i.isMyNumber===!0||i.id&&i.id.includes("@c.us")&&i.isContactSyncCompleted===1);s&&(o=s)}}catch{}if(o&&typeof o=="object"){let n=[],s=o.wid||o.id||o._serialized||"";s&&n.push(`\u{1F4F1} ID: ${s}`);let i=o.name||o.pushname||o.notifyName||o.formattedName||o.displayName||o.shortName||o.fullName||"";if(!i&&s)try{let h=this.interceptors.Contact;if(h&&typeof h.get=="function"){let l=h.get(s);l&&(i=l.name||l.pushname||l.notifyName||l.formattedName||l.displayName||l.shortName||"")}}catch{}if(!i)try{let h=this.interceptors;h.getMeDisplayNameOrThrow&&typeof h.getMeDisplayNameOrThrow=="function"&&(i=h.getMeDisplayNameOrThrow())}catch{}i&&n.push(`\u{1F464} Nome: ${i}`);let a=o.phoneNumber||o.number||(s?s.split("@")[0]:"");if(a&&n.push(`\u{1F4DE} Telefone: ${a}`),o.isBusiness!==void 0&&n.push(`\u{1F4BC} Business: ${o.isBusiness?"Sim":"N\xE3o"}`),o.isEnterprise!==void 0&&n.push(`\u{1F3E2} Enterprise: ${o.isEnterprise?"Sim":"N\xE3o"}`),o.verifiedName!==void 0&&n.push(`\u2705 Verificado: ${o.verifiedName||"N\xE3o"}`),n.length>0)e=n.join(`
`);else try{e=`\u2705 Usu\xE1rio encontrado
\u{1F4CB} Propriedades dispon\xEDveis: ${Object.keys(o).slice(0,15).join(", ")}`}catch{e="\u2705 Usu\xE1rio encontrado (sem dados acess\xEDveis)"}}else e=`\u2705 M\xF3dulo User encontrado
\u26A0\uFE0F Dados do usu\xE1rio n\xE3o acess\xEDveis`;return this.hideExecutionIndicator(t),e||"\u2705 M\xF3dulo funcionando corretamente!"}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="sendTextMsgToChat"){this.showExecutionIndicator(t,"Enviando mensagem de texto...");try{let e="";if(!this.testNumber)return this.hideExecutionIndicator(t),"\u26A0\uFE0F Configure um n\xFAmero de teste primeiro";let o=this.interceptors.sendTextMsgToChat;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o sendTextMsgToChat n\xE3o encontrada";console.log("[TEST] ========== NORMALIZA\xC7\xC3O DO N\xDAMERO (sendTextMsg) ==========");let n=null,s=this.interceptors.User;if(s)try{let g=null;typeof s=="function"?g=s():typeof s.getMaybeMePnUser=="function"?g=s.getMaybeMePnUser():typeof s.getMaybeMeLidUser=="function"&&(g=s.getMaybeMeLidUser()),g&&(n=g.id?._serialized||g._serialized||(g.user?`${g.user}@${g.server||"c.us"}`:null),console.log("[TEST] \u2705 N\xFAmero do usu\xE1rio atual obtido (sendTextMsg):",n))}catch(g){console.warn("[TEST] \u26A0\uFE0F Erro ao obter n\xFAmero do usu\xE1rio atual (sendTextMsg):",g.message)}let i=`${this.testNumber}@c.us`,a=`55${this.testNumber}@c.us`,h=null;if(n){let g=n.match(/^(\d{2})(\d+)/);if(g){let p=g[1];this.testNumber.startsWith(p)||(h=`${p}${this.testNumber}@c.us`,console.log("[TEST] \u2705 Formato 3 criado com c\xF3digo do pa\xEDs do usu\xE1rio (sendTextMsg):",h))}}let l=[i,a,h].filter(Boolean);console.log("[TEST] \u{1F4CB} Formatos de WID para tentar (sendTextMsg):",l);let M=n&&l.some(g=>{let p=g.replace("@c.us",""),c=n.replace("@c.us","").replace("@lid","");return p===c||p.endsWith(c)||c.endsWith(p)});M&&console.log("[TEST] \u2705 Detectado: Enviando mensagem para si mesmo! (sendTextMsg)");let f=`Teste Mettri Texto - ${new Date().toLocaleTimeString()}`;try{console.log("[TEST] ========== IN\xCDCIO OBTER CHAT (sendTextMsg) =========="),console.log("[TEST] \u{1F4CB} Par\xE2metros:",{testNumber:this.testNumber,testWidsToTry:l,currentUserWid:n,isSendingToSelf:M}),console.log("[TEST] [OBTER CHAT] Tentando abrir chat via Cmd.openChatAt() (sendTextMsg)...");let g=this.interceptors.Cmd;if(g&&typeof g.openChatAt=="function"){let u=this.interceptors.Chat;if(u&&typeof u.get=="function")for(let S of l)try{let E=u.get(S);if(E){console.log("[TEST] [OBTER CHAT] Chat b\xE1sico obtido para abrir com formato (sendTextMsg):",S),g.openChatAt(E),console.log("[TEST] [OBTER CHAT] \u2705 Chat aberto via Cmd.openChatAt() (sendTextMsg)"),await new Promise(C=>setTimeout(C,500));break}}catch(E){console.warn("[TEST] [OBTER CHAT] Erro ao tentar abrir chat com formato (sendTextMsg)",S,":",E.message)}}let p=this.interceptors.Chat,c=null;if(!p)throw new Error("M\xF3dulo Chat n\xE3o encontrado");if(M&&typeof p.getActive=="function")try{let u=p.getActive();if(u&&u.id){let S=u.id._serialized||(typeof u.id=="string"?u.id:u.id.toString());l.some(C=>{let O=C.replace("@c.us",""),x=S.replace("@c.us","").replace("@lid","");return O===x||O.endsWith(x)||x.endsWith(O)})&&(c=u,console.log("[TEST] [OBTER CHAT] \u2705 Chat ativo corresponde (sendTextMsg)!"))}}catch(u){console.error("[TEST] [OBTER CHAT] ERRO ao usar Chat.getActive() (sendTextMsg):",u.message)}if(!c&&typeof p.get=="function")for(let u of l)try{let S=p.get(u);if(S){c=S,console.log("[TEST] [OBTER CHAT] \u2705 Chat.get() encontrou (sendTextMsg) com formato:",u);break}}catch(S){console.warn("[TEST] [OBTER CHAT] Erro ao tentar Chat.get() (sendTextMsg) com formato",u,":",S.message)}if(!c&&typeof p.find=="function"){let u=this.interceptors.WidFactory;for(let S of l)try{let E=S;if(u)try{typeof u=="function"?E=u(S):typeof u.createWid=="function"&&(E=u.createWid(S)),(!E||typeof E=="string"&&E===S)&&(E=S)}catch{E=S}let C=await Promise.resolve(p.find(E)).catch(()=>null);if(C){c=C,console.log("[TEST] [OBTER CHAT] \u2705 Chat.find() encontrou (sendTextMsg) com formato:",S);break}}catch(E){console.warn("[TEST] [OBTER CHAT] Erro ao tentar Chat.find() (sendTextMsg) com formato",S,":",E.message)}}if(!c){console.warn("[TEST] [OBTER CHAT] \u26A0\uFE0F Chat n\xE3o encontrado via get() nem find() (sendTextMsg)"),console.log("[TEST] [OBTER CHAT] Tentando estrat\xE9gia alternativa: abrir chat e aguardar...");let u=this.interceptors.WidFactory;if(u&&g&&typeof g.openChatAt=="function")for(let S of l)try{let E=null;if(typeof u=="function"?E=u(S):typeof u.createWid=="function"&&(E=u.createWid(S)),E&&E.user)try{let C={id:E};if(g.openChatAt(C),console.log("[TEST] [OBTER CHAT] Chat aberto via Cmd.openChatAt() com WID objeto (sendTextMsg):",S),await new Promise(O=>setTimeout(O,2e3)),c=p.get(S),!c&&typeof p.find=="function"&&(c=await Promise.resolve(p.find(E)).catch(()=>null)),c){console.log("[TEST] [OBTER CHAT] \u2705 Chat encontrado ap\xF3s abrir e aguardar (sendTextMsg)!");break}}catch(C){console.error("[TEST] [OBTER CHAT] ERRO ao abrir chat (sendTextMsg):",C.message)}}catch(E){console.error("[TEST] [OBTER CHAT] ERRO ao criar WID (sendTextMsg):",E.message)}if(!c){let S=`Chat n\xE3o encontrado para ${this.testNumber}. O chat precisa existir no WhatsApp (ter pelo menos uma mensagem trocada) ou estar na lista de conversas. Tente:
1. Abrir a conversa manualmente no WhatsApp primeiro
2. Enviar uma mensagem manualmente para criar o chat
3. Verificar se o n\xFAmero est\xE1 correto (formato: 3499277591 sem espa\xE7os ou caracteres especiais)`;throw console.error("[TEST] [OBTER CHAT] \u274C",S),new Error(S)}}if(c){if(!(c.id&&(typeof c.id.isGroup=="function"||typeof c.id.isLid=="function")&&c.id.user))throw console.error("[TEST] [OBTER CHAT] \u274C Chat n\xE3o tem propriedades necess\xE1rias (sendTextMsg):",{hasId:!!c.id,idType:typeof c.id,idUser:c.id?.user,idIsGroup:typeof c.id?.isGroup,idIsLid:typeof c.id?.isLid}),new Error("Chat obtido n\xE3o tem estrutura v\xE1lida. O chat precisa ser um objeto completo do WhatsApp, n\xE3o um objeto m\xEDnimo. Tente abrir a conversa manualmente no WhatsApp primeiro.");console.log("[TEST] [OBTER CHAT] \u2705 Chat validado com propriedades necess\xE1rias (sendTextMsg)")}let T=this.interceptors.addAndSendMsgToChat,m=null;if(!T||typeof T!="function")try{if(c&&c.id)m=await Promise.resolve(o(c,f));else{let u=l[0]||`${this.testNumber}@c.us`;m=await Promise.resolve(o(u,f))}}catch(u){throw new Error(`sendTextMsgToChat n\xE3o dispon\xEDvel e addAndSendMsgToChat tamb\xE9m n\xE3o: ${u.message}`)}else{let u=this.interceptors.User,S=null;if(u)try{typeof u=="function"?S=u():typeof u.getMaybeMePnUser=="function"?S=u.getMaybeMePnUser():typeof u.getMaybeMeLidUser=="function"&&(S=u.getMaybeMeLidUser())}catch(w){console.log("[TEST] Erro ao obter usu\xE1rio atual (sendTextMsg):",w)}if(!S)throw new Error("N\xE3o foi poss\xEDvel obter usu\xE1rio atual");let E=this.interceptors.MsgKey;if(!E||typeof E.newId!="function")throw new Error("MsgKey.newId() n\xE3o dispon\xEDvel");let C=await Promise.resolve(E.newId());console.log("[TEST] [PASSO 3] Criando objeto MsgKey completo (new N.MsgKey({...}))..."),console.log("[TEST] [PASSO 3] Verificando se chat.id \xE9 grupo...");let O=c.id&&typeof c.id.isGroup=="function"?c.id.isGroup():!1;console.log("[TEST] [PASSO 3] \xC9 grupo?",O);let x=null;try{let w={from:S,to:c.id,id:C,participant:O?S:void 0,selfDir:"out"};console.log("[TEST] [PASSO 3] Dados do MsgKey:",{from:w.from?"Existe":"NULL",to:w.to?w.to.user||w.to._serialized||"Objeto WID":"NULL",id:w.id,participant:w.participant?"Existe":"undefined",selfDir:w.selfDir});let $=null;if(typeof E=="function"&&E.prototype)$=E,console.log("[TEST] [PASSO 3] MsgKey \xE9 classe diretamente");else if(E?.default&&typeof E.default=="function"&&E.default.prototype)$=E.default,console.log("[TEST] [PASSO 3] MsgKey est\xE1 em .default");else if(E?.constructor&&typeof E.constructor=="function"&&E.constructor!==Object)$=E.constructor,console.log("[TEST] [PASSO 3] MsgKey tem constructor");else if(window.N?.MsgKey){let k=window.N.MsgKey;typeof k=="function"&&k.prototype?($=k,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em window.N.MsgKey (igual refer\xEAncia)")):k?.default&&typeof k.default=="function"&&($=k.default,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em window.N.MsgKey.default"))}if(!$&&this.interceptors.N?.MsgKey){let k=this.interceptors.N.MsgKey;typeof k=="function"&&k.prototype&&($=k,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em interceptors.N.MsgKey"))}if($&&typeof $=="function")try{x=new $(w),console.log("[TEST] [PASSO 3] \u2705 MsgKey instanciado como classe (new MsgKey({...})):",{msgKeyObj:x?"Criado":"NULL",hasSerialized:!!x?._serialized,msgKeyObjType:typeof x,msgKeyObjKeys:x?Object.keys(x).slice(0,10):[]})}catch(k){console.error("[TEST] [PASSO 3] ERRO ao instanciar MsgKey como classe:",k.message,k.stack),console.warn("[TEST] [PASSO 3] \u26A0\uFE0F Usando objeto simples como fallback"),x=w}else console.warn("[TEST] [PASSO 3] \u26A0\uFE0F MsgKey n\xE3o \xE9 classe construtora, usando objeto simples:",{msgKeyModuleType:typeof E,hasDefault:!!E?.default,defaultType:typeof E?.default,hasConstructor:!!E?.constructor}),x=w}catch(w){console.error("[TEST] [PASSO 3] ERRO ao criar MsgKey:",w.message,w.stack),x={from:S,to:c.id,id:C,selfDir:"out"}}console.log("[TEST] [PASSO 3] \u2705 MsgKey criado:",{msgKeyObj:x?"Existe":"NULL",msgKeyId:x?.id,msgKeyFrom:x?.from?"Existe":"NULL",msgKeyTo:x?.to?x.to.user||x.to._serialized||"Objeto":"NULL",hasSerialized:!!x?._serialized});let A=this.interceptors.getEphemeralFields,P={};if(A&&typeof A=="function")try{P=await Promise.resolve(A(c))||{}}catch(w){console.log("[TEST] Erro ao obter campos ef\xEAmeros (sendTextMsg):",w)}console.log("[TEST] [PASSO 5] Criando objeto de mensagem completo (y = {...})...");let d={id:x,ack:0,body:f,from:S,to:c.id,local:!0,self:"out",t:Math.floor(Date.now()/1e3),isNewMsg:!0,type:"chat",...P};d.type=d.type||d.__x_type||"chat",console.log("[TEST] [PASSO 5] \u2705 Objeto de mensagem criado:",{id:d.id?"Existe":"NULL",ack:d.ack,body:d.body?`"${d.body.substring(0,50)}..."`:"NULL",from:d.from?"Existe":"NULL",to:d.to?d.to.user||d.to._serialized||"Objeto WID":"NULL",local:d.local,self:d.self,t:d.t,isNewMsg:d.isNewMsg,type:d.type}),console.log("[TEST] [PASSO 6] Enviando mensagem (await N.addAndSendMsgToChat(e, y))..."),console.log("[TEST] [PASSO 6] Par\xE2metros:",{chat:c?"Existe":"NULL",chatId:c?.id,messageObjId:d.id,messageObjBody:d.body});let y=await Promise.resolve(T(c,d));console.log("[TEST] [PASSO 6] \u2705 addAndSendMsgToChat retornou:",{result:y?"Existe":"NULL",isArray:Array.isArray(y),resultLength:Array.isArray(y)?y.length:"N/A"});let v=null,b=null;Array.isArray(y)?(v=y[0],b=y[1]):v=y,m=await Promise.resolve(v),b&&await Promise.resolve(b),console.log("[TEST] [PASSO 6] \u2705 sendResult final:",{sendResult:m?"Existe":"NULL",sendResultId:m?.id,sendResultIdSerialized:m?.id?._serialized})}if(console.log("[TEST] [PASSO 7] Aguardando 500ms para mensagem aparecer..."),await new Promise(u=>setTimeout(u,500)),console.log("[TEST] [PASSO 8] Buscando mensagem criada (N.Msg.get(_._serialized))..."),m!=null){let u=null;if(m.id?._serialized?u=m.id._serialized:m._serialized?u=m._serialized:m.id&&(u=String(m.id)),console.log("[TEST] [PASSO 8] MsgKey._serialized:",u),u){let S=this.interceptors.Msg;if(S&&typeof S.get=="function")try{let E=S.get(u);console.log("[TEST] [PASSO 8] \u2705 Mensagem encontrada na cole\xE7\xE3o Msg:",{found:!!E,msgId:u.substring(0,50)}),E?e=`\u2705 Mensagem de texto enviada com sucesso!
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"
\u{1F4E8} ID: ${u.substring(0,50)}...`:e=`\u2705 Fun\xE7\xE3o executada (mensagem pode estar sendo processada)
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}catch(E){console.warn("[TEST] [PASSO 8] \u26A0\uFE0F Erro ao buscar mensagem:",E.message),e=`\u2705 Fun\xE7\xE3o executada
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}else e=`\u2705 Fun\xE7\xE3o executada
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}else e=`\u2705 Fun\xE7\xE3o executada
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}else e=`\u2705 Fun\xE7\xE3o executada (sem retorno)
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`;console.log("[TEST] ========== FIM PREPARA\xC7\xC3O DE MENSAGEM (sendTextMsg) ==========")}catch(g){let p=g?.message||"Erro desconhecido",c=g?.stack||"";p.includes("isLid")||c.includes("isLid")?e=`\u274C Erro: ID do chat n\xE3o \xE9 objeto WID v\xE1lido
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

\u{1F4A1} O chat.id precisa ser um objeto WID (com m\xE9todos como isLid), n\xE3o uma string.
Tente abrir a conversa no WhatsApp primeiro para garantir que o chat est\xE1 carregado.`:p.includes("toLogString")||c.includes("toLogString")?e=`\u274C Erro interno do WhatsApp: objeto n\xE3o inicializado
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

\u{1F4A1} O chat pode n\xE3o estar totalmente carregado. Tente abrir a conversa no WhatsApp primeiro.`:e=`\u274C Erro ao enviar mensagem: ${p}
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"`}return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="addAndSendMsgToChat"){this.showExecutionIndicator(t,"Enviando mensagem de teste...");try{let e="";if(!this.testNumber)return this.hideExecutionIndicator(t),"\u26A0\uFE0F Configure um n\xFAmero de teste primeiro";let o=this.interceptors.addAndSendMsgToChat;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o addAndSendMsgToChat n\xE3o encontrada";console.log("[TEST] ========== NORMALIZA\xC7\xC3O DO N\xDAMERO ==========");let n=null,s=this.interceptors.User;if(s)try{let g=null;typeof s=="function"?g=s():typeof s.getMaybeMePnUser=="function"?g=s.getMaybeMePnUser():typeof s.getMaybeMeLidUser=="function"&&(g=s.getMaybeMeLidUser()),g&&(n=g.id?._serialized||g._serialized||(g.user?`${g.user}@${g.server||"c.us"}`:null),console.log("[TEST] \u2705 N\xFAmero do usu\xE1rio atual obtido:",n))}catch(g){console.warn("[TEST] \u26A0\uFE0F Erro ao obter n\xFAmero do usu\xE1rio atual:",g.message)}let i=`${this.testNumber}@c.us`,a=`55${this.testNumber}@c.us`,h=null;if(n){let g=n.match(/^(\d{2})(\d+)/);if(g){let p=g[1];this.testNumber.startsWith(p)||(h=`${p}${this.testNumber}@c.us`,console.log("[TEST] \u2705 Formato 3 criado com c\xF3digo do pa\xEDs do usu\xE1rio:",h))}}let l=[i,a,h].filter(Boolean);console.log("[TEST] \u{1F4CB} Formatos de WID para tentar:",l);let M=n&&l.some(g=>{let p=g.replace("@c.us",""),c=n.replace("@c.us","").replace("@lid","");return p===c||p.endsWith(c)||c.endsWith(p)});M&&console.log("[TEST] \u2705 Detectado: Enviando mensagem para si mesmo!");let f=`Teste Mettri - ${new Date().toLocaleTimeString()}`;try{console.log("[TEST] ========== IN\xCDCIO OBTER CHAT =========="),console.log("[TEST] \u{1F4CB} Par\xE2metros:",{testNumber:this.testNumber,testWidsToTry:l,currentUserWid:n,isSendingToSelf:M}),console.log("[TEST] [OBTER CHAT] Tentando abrir chat via Cmd.openChatAt() (refer\xEAncia linha 1513)...");let g=this.interceptors.Cmd;if(g&&typeof g.openChatAt=="function"){let d=this.interceptors.Chat;if(d&&typeof d.get=="function")for(let y of l)try{let v=d.get(y);if(v){console.log("[TEST] [OBTER CHAT] Chat b\xE1sico obtido para abrir com formato:",y),g.openChatAt(v),console.log("[TEST] [OBTER CHAT] \u2705 Chat aberto via Cmd.openChatAt() com formato:",y),await new Promise(b=>setTimeout(b,500)),console.log("[TEST] [OBTER CHAT] \u2705 Aguardou 500ms para chat carregar");break}}catch(v){console.warn("[TEST] [OBTER CHAT] Erro ao tentar abrir chat com formato",y,":",v.message)}}let p=this.interceptors.Chat,c=null;if(!p)throw console.error("[TEST] [OBTER CHAT] \u274C M\xF3dulo Chat n\xE3o encontrado!"),new Error("M\xF3dulo Chat n\xE3o encontrado");if(console.log("[TEST] [OBTER CHAT] Chat module encontrado:",{hasGet:typeof p.get=="function",hasGetActive:typeof p.getActive=="function",hasFind:typeof p.find=="function",hasModels:!!p._models,modelsCount:p._models?.length||0}),console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1] Verificando se \xE9 envio para si mesmo..."),M&&typeof p.getActive=="function")try{let d=p.getActive();if(d&&d.id){let y=d.id._serialized||(typeof d.id=="string"?d.id:d.id.toString());console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1] Chat ativo ID:",y),l.some(b=>{let w=b.replace("@c.us",""),$=y.replace("@c.us","").replace("@lid","");return w===$||w.endsWith($)||$.endsWith(w)})?(c=d,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1] \u2705 Chat ativo corresponde ao n\xFAmero de teste!")):console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1] \u26A0\uFE0F Chat ativo n\xE3o corresponde:",{activeId:y,wantedIds:l})}}catch(d){console.error("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1] ERRO ao usar Chat.getActive():",d.message)}if(!c&&typeof p.getActive=="function")try{let d=p.getActive();if(d&&d.id){let y=d.id._serialized||(typeof d.id=="string"?d.id:d.id.toString());console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1b] Chat ativo ID:",y),l.some(b=>{let w=b.replace("@c.us",""),$=y.replace("@c.us","").replace("@lid","");return w===$||w.endsWith($)||$.endsWith(w)})&&(c=d,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1b] \u2705 Chat ativo corresponde!"))}}catch(d){console.error("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 1b] ERRO:",d.message)}if(console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] Tentando Chat.get() com m\xFAltiplos formatos..."),!c&&typeof p.get=="function"){for(let d of l)try{let y=p.get(d);if(y){if(c=y,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] \u2705 Chat.get() encontrou com formato:",d),c&&c.id&&typeof c.id=="string"){let v=this.interceptors.WidFactory;if(v)try{let b=null;typeof v=="function"?b=v(c.id):typeof v.createWid=="function"&&(b=v.createWid(c.id)),b&&b.user&&(c.id=b,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] Chat.id convertido de string para WID objeto"))}catch(b){console.warn("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] Erro ao converter chat.id para WID:",b)}}break}}catch(y){console.warn("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] Erro ao tentar Chat.get() com formato",d,":",y.message)}c||console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 2] \u274C Chat.get() n\xE3o encontrou com nenhum formato")}if(console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] Tentando Chat.find() com m\xFAltiplos formatos..."),!c&&typeof p.find=="function"){let d=this.interceptors.WidFactory;for(let y of l)try{let v=y;if(d)try{typeof d=="function"?v=d(y):typeof d.createWid=="function"&&(v=d.createWid(y)),(!v||typeof v=="string"&&v===y)&&(v=y)}catch(w){v=y,console.log("[TEST] Erro ao criar WID para Chat.find(), usando string:",w)}let b=await Promise.resolve(p.find(v)).catch(()=>null);if(b){if(c=b,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] \u2705 Chat.find() encontrou com formato:",y),c&&c.id)if(typeof c.id=="string"){if(d)try{let w=null;typeof d=="function"?w=d(c.id):typeof d.createWid=="function"&&(w=d.createWid(c.id)),w&&w.user&&(c.id=w,console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] Chat.id convertido de string para WID objeto"))}catch(w){console.warn("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] Erro ao converter chat.id para WID:",w)}}else c.id.user&&console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] Chat.id j\xE1 \xE9 objeto WID v\xE1lido");break}}catch(v){console.warn("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] Erro ao tentar Chat.find() com formato",y,":",v.message)}c||console.log("[TEST] [OBTER CHAT] [ESTRAT\xC9GIA 3] \u274C Chat.find() n\xE3o encontrou com nenhum formato")}if(!c){console.warn("[TEST] [OBTER CHAT] \u26A0\uFE0F Chat n\xE3o encontrado via get() nem find()"),console.log("[TEST] [OBTER CHAT] Tentando estrat\xE9gia alternativa: abrir chat e aguardar...");let d=this.interceptors.WidFactory;if(d&&g&&typeof g.openChatAt=="function")try{let y=null;if(typeof d=="function"?y=d(i):typeof d.createWid=="function"&&(y=d.createWid(i)),y&&y.user)try{let v={id:y};g.openChatAt(v),console.log("[TEST] [OBTER CHAT] Chat aberto via Cmd.openChatAt() com WID objeto"),await new Promise(b=>setTimeout(b,2e3)),console.log("[TEST] [OBTER CHAT] \u2705 Aguardou 2s ap\xF3s abrir chat");for(let b of l)if(c=p.get(b),c)break;!c&&typeof p.find=="function"&&(c=await Promise.resolve(p.find(y)).catch(()=>null)),c&&console.log("[TEST] [OBTER CHAT] \u2705 Chat encontrado ap\xF3s abrir e aguardar!")}catch(v){console.error("[TEST] [OBTER CHAT] ERRO ao abrir chat com WID objeto:",v.message)}}catch(y){console.error("[TEST] [OBTER CHAT] ERRO ao criar WID para estrat\xE9gia alternativa:",y.message)}if(!c){let y=`Chat n\xE3o encontrado para ${this.testNumber}. O chat precisa existir no WhatsApp (ter pelo menos uma mensagem trocada) ou estar na lista de conversas. Tente:
1. Abrir a conversa manualmente no WhatsApp primeiro
2. Enviar uma mensagem manualmente para criar o chat
3. Verificar se o n\xFAmero est\xE1 correto (formato: 3499277591 sem espa\xE7os ou caracteres especiais)`;throw console.error("[TEST] [OBTER CHAT] \u274C",y),new Error(y)}}if(c){if(!(c.id&&(typeof c.id.isGroup=="function"||typeof c.id.isLid=="function")&&c.id.user))throw console.error("[TEST] [OBTER CHAT] \u274C Chat n\xE3o tem propriedades necess\xE1rias:",{hasId:!!c.id,idType:typeof c.id,idUser:c.id?.user,idIsGroup:typeof c.id?.isGroup,idIsLid:typeof c.id?.isLid}),new Error("Chat obtido n\xE3o tem estrutura v\xE1lida. O chat precisa ser um objeto completo do WhatsApp, n\xE3o um objeto m\xEDnimo. Tente abrir a conversa manualmente no WhatsApp primeiro.");console.log("[TEST] [OBTER CHAT] \u2705 Chat validado com propriedades necess\xE1rias")}if(console.log("[TEST] ========== IN\xCDCIO PREPARA\xC7\xC3O DE MENSAGEM (fun\xE7\xE3o Tt) =========="),console.log("[TEST] \u{1F4CB} CONTEXTO INICIAL:",{testNumber:this.testNumber,testWidsToTry:l,testMessage:f,chat:c?"Existe":"NULL",chatId:c?.id,chatIdType:typeof c?.id,chatIdUser:c?.id?.user,chatIdSerialized:c?.id?._serialized,chatIdIsGroup:c?.id?typeof c.id.isGroup=="function"?c.id.isGroup():"isGroup n\xE3o \xE9 fun\xE7\xE3o":"N/A",chatIdIsLid:c?.id?typeof c.id.isLid=="function"?"isLid \xE9 fun\xE7\xE3o":"isLid n\xE3o \xE9 fun\xE7\xE3o":"N/A"}),!c||!c.id)throw new Error("Chat ou chat.id n\xE3o dispon\xEDvel");if(typeof c.id=="string")throw console.error("[TEST] \u274C ERRO CR\xCDTICO: chat.id \xE9 STRING, n\xE3o objeto WID!",{chatId:c.id,expected:"Objeto WID com m\xE9todos (isLid, isGroup, etc)"}),new Error("chat.id \xE9 string, precisa ser objeto WID. Tente abrir a conversa no WhatsApp primeiro.");!c.id.user&&!c.id._serialized&&console.warn("[TEST] \u26A0\uFE0F AVISO: chat.id n\xE3o tem user nem _serialized:",{chatId:c.id,chatIdKeys:Object.keys(c.id).slice(0,10)}),console.log("[TEST] \u2705 Chat validado:",{chatIdType:typeof c.id,hasUser:!!c.id.user,hasSerialized:!!c.id._serialized,hasIsGroup:typeof c.id.isGroup=="function",hasIsLid:typeof c.id.isLid=="function"}),console.log("[TEST] [PASSO 1] Obtendo usu\xE1rio atual (xt = N.User?.getMaybeMePnUser() || getMaybeMeLidUser())...");let T=this.interceptors.User,m=null;if(T){console.log("[TEST] [PASSO 1] User module encontrado:",typeof T);try{typeof T=="function"?(m=T(),console.log("[TEST] [PASSO 1] Usu\xE1rio obtido via User() como fun\xE7\xE3o:",m?"Sucesso":"NULL")):typeof T.getMaybeMePnUser=="function"?(m=T.getMaybeMePnUser(),console.log("[TEST] [PASSO 1] Usu\xE1rio obtido via getMaybeMePnUser():",m?"Sucesso":"NULL")):typeof T.getMaybeMeLidUser=="function"?(m=T.getMaybeMeLidUser(),console.log("[TEST] [PASSO 1] Usu\xE1rio obtido via getMaybeMeLidUser():",m?"Sucesso":"NULL")):console.log("[TEST] [PASSO 1] User module n\xE3o tem m\xE9todos esperados, m\xE9todos dispon\xEDveis:",Object.keys(T).slice(0,10))}catch(d){console.error("[TEST] [PASSO 1] ERRO ao obter usu\xE1rio atual:",d.message,d.stack)}}else console.error("[TEST] [PASSO 1] User module N\xC3O encontrado!");if(!m){let d="N\xE3o foi poss\xEDvel obter usu\xE1rio atual (User.getMaybeMePnUser ou getMaybeMeLidUser)";throw console.error("[TEST] [PASSO 1] FALHA:",d),new Error(d)}console.log("[TEST] [PASSO 1] \u2705 Usu\xE1rio atual obtido:",{hasUser:!!m,userId:m?.id||m?._serialized||m?.user||"N/A",userType:typeof m}),console.log("[TEST] [PASSO 2] Criando novo ID de mensagem (g = await N.MsgKey.newId())...");let u=this.interceptors.MsgKey;if(!u||typeof u.newId!="function"){let d="MsgKey.newId() n\xE3o dispon\xEDvel";throw console.error("[TEST] [PASSO 2] FALHA:",d,{msgKeyModule:u?"Existe":"NULL",hasNewId:u?typeof u.newId:"N/A"}),new Error(d)}let S=await Promise.resolve(u.newId());console.log("[TEST] [PASSO 2] \u2705 Novo ID criado:",{newMsgId:S,newMsgIdType:typeof S}),console.log("[TEST] [PASSO 3] Criando objeto MsgKey completo (new N.MsgKey({...}))..."),console.log("[TEST] [PASSO 3] Verificando se chat.id \xE9 grupo...");let E=c.id&&typeof c.id.isGroup=="function"?c.id.isGroup():!1;console.log("[TEST] [PASSO 3] \xC9 grupo?",E);let C=null;try{let d={from:m,to:c.id,id:S,participant:E?m:void 0,selfDir:"out"};console.log("[TEST] [PASSO 3] Dados do MsgKey:",{from:d.from?"Existe":"NULL",to:d.to?d.to.user||d.to._serialized||"Objeto WID":"NULL",id:d.id,participant:d.participant?"Existe":"undefined",selfDir:d.selfDir});let y=null;if(typeof u=="function"&&u.prototype)y=u,console.log("[TEST] [PASSO 3] MsgKey \xE9 classe diretamente");else if(u?.default&&typeof u.default=="function"&&u.default.prototype)y=u.default,console.log("[TEST] [PASSO 3] MsgKey est\xE1 em .default");else if(u?.constructor&&typeof u.constructor=="function"&&u.constructor!==Object)y=u.constructor,console.log("[TEST] [PASSO 3] MsgKey tem constructor");else if(window.N?.MsgKey){let v=window.N.MsgKey;typeof v=="function"&&v.prototype?(y=v,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em window.N.MsgKey (igual refer\xEAncia)")):v?.default&&typeof v.default=="function"&&(y=v.default,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em window.N.MsgKey.default"))}if(!y&&this.interceptors.N?.MsgKey){let v=this.interceptors.N.MsgKey;typeof v=="function"&&v.prototype&&(y=v,console.log("[TEST] [PASSO 3] \u2705 MsgKey encontrado em interceptors.N.MsgKey"))}if(y&&typeof y=="function")try{C=new y(d),console.log("[TEST] [PASSO 3] \u2705 MsgKey instanciado como classe (new MsgKey({...})):",{msgKeyObj:C?"Criado":"NULL",hasSerialized:!!C?._serialized,msgKeyObjType:typeof C,msgKeyObjKeys:C?Object.keys(C).slice(0,10):[]})}catch(v){console.error("[TEST] [PASSO 3] ERRO ao instanciar MsgKey como classe:",v.message,v.stack),console.warn("[TEST] [PASSO 3] \u26A0\uFE0F Usando objeto simples como fallback"),C=d}else console.warn("[TEST] [PASSO 3] \u26A0\uFE0F MsgKey n\xE3o \xE9 classe construtora, usando objeto simples:",{msgKeyModuleType:typeof u,hasDefault:!!u?.default,defaultType:typeof u?.default,hasConstructor:!!u?.constructor}),C=d}catch(d){console.error("[TEST] [PASSO 3] ERRO ao criar MsgKey:",d.message,d.stack),C={from:m,to:c.id,id:S,selfDir:"out"}}console.log("[TEST] [PASSO 3] \u2705 MsgKey criado:",{msgKeyObj:C?"Existe":"NULL",msgKeyId:C?.id,msgKeyFrom:C?.from?"Existe":"NULL",msgKeyTo:C?.to?C.to.user||C.to._serialized||"Objeto":"NULL"}),console.log("[TEST] [PASSO 4] Obtendo campos ef\xEAmeros (g = N.getEphemeralFields(e))...");let O=this.interceptors.getEphemeralFields,x={};if(O&&typeof O=="function")try{x=await Promise.resolve(O(c))||{},console.log("[TEST] [PASSO 4] \u2705 Campos ef\xEAmeros obtidos:",{hasFields:Object.keys(x).length>0,fieldsCount:Object.keys(x).length,fields:Object.keys(x).slice(0,5)})}catch(d){console.warn("[TEST] [PASSO 4] \u26A0\uFE0F Erro ao obter campos ef\xEAmeros:",d.message),x={}}else console.warn("[TEST] [PASSO 4] \u26A0\uFE0F getEphemeralFields n\xE3o dispon\xEDvel, usando objeto vazio");console.log("[TEST] [PASSO 5] Criando objeto de mensagem completo (y = {...})...");let A={id:C,ack:0,body:f,from:m,to:c.id,local:!0,self:"out",t:Math.floor(Date.now()/1e3),isNewMsg:!0,type:"chat",...x};A.type=A.type||A.__x_type||"chat",console.log("[TEST] [PASSO 5] \u2705 Objeto de mensagem criado:",{id:A.id?"Existe":"NULL",ack:A.ack,body:A.body?`"${A.body.substring(0,50)}..."`:"NULL",from:A.from?"Existe":"NULL",to:A.to?A.to.user||A.to._serialized||"Objeto WID":"NULL",local:A.local,self:A.self,t:A.t,isNewMsg:A.isNewMsg,type:A.type,ephemeralFieldsCount:Object.keys(x).length}),console.log("[TEST] [PASSO 6] Enviando mensagem (await N.addAndSendMsgToChat(e, y))..."),console.log("[TEST] [PASSO 6] Par\xE2metros:",{chat:c?"Existe":"NULL",chatId:c?.id,messageObjId:A.id,messageObjBody:A.body,messageObjTo:A.to});let P=null;try{console.log("[TEST] [PASSO 6] Chamando addAndSendMsgToChat(chat, messageObj)...");let d=await Promise.resolve(o(c,A));console.log("[TEST] [PASSO 6] \u2705 addAndSendMsgToChat retornou:",{result:d?"Existe":"NULL",isArray:Array.isArray(d),resultLength:Array.isArray(d)?d.length:"N/A",resultType:typeof d});let y=null,v=null;if(Array.isArray(d)?(y=d[0],v=d[1],console.log("[TEST] [PASSO 6] \u2705 Resultado \xE9 array, aguardando [0] e [1] (se existir)")):(y=d,console.log("[TEST] [PASSO 6] \u2705 Resultado n\xE3o \xE9 array, aguardando diretamente")),P=await Promise.resolve(y),v&&await Promise.resolve(v),console.log("[TEST] [PASSO 6] \u2705 sendResult final:",{sendResult:P?"Existe":"NULL",sendResultId:P?.id,sendResultIdSerialized:P?.id?._serialized,sendResultType:typeof P}),P&&P.id){await new Promise(w=>setTimeout(w,500));let b=this.interceptors.Msg;if(b&&typeof b.get=="function")try{let w=P.id._serialized||P.id;b.get(w)?e=`\u2705 Mensagem enviada com sucesso!
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"
\u{1F4E8} ID: ${w.substring(0,50)}...`:e=`\u2705 Fun\xE7\xE3o executada (mensagem pode estar sendo processada)
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}catch{e=`\u2705 Fun\xE7\xE3o executada
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}else e=`\u2705 Fun\xE7\xE3o executada
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}else e=`\u2705 Fun\xE7\xE3o executada (sem retorno de ID)
\u{1F4F1} Para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

Verifique se a mensagem apareceu no WhatsApp`}catch(d){let y=d?.message||"Erro desconhecido",v=d?.stack||"";y.includes("isLid")||v.includes("isLid")?e=`\u274C Erro: ID do chat n\xE3o \xE9 objeto WID v\xE1lido
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

\u{1F4A1} O chat.id precisa ser um objeto WID (com m\xE9todos como isLid), n\xE3o uma string.
Tente abrir a conversa no WhatsApp primeiro para garantir que o chat est\xE1 carregado.`:y.includes("toLogString")||v.includes("toLogString")?e=`\u274C Erro interno do WhatsApp: objeto n\xE3o inicializado
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"

\u{1F4A1} O chat pode n\xE3o estar totalmente carregado. Tente abrir a conversa no WhatsApp primeiro.`:e=`\u274C Erro ao enviar mensagem: ${y}
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"`}}catch(g){e=`\u274C Erro ao preparar envio: ${g?.message||"Erro desconhecido"}
\u{1F4F1} Tentou enviar para: ${this.testNumber}
\u{1F4AC} Mensagem: "${f}"`}return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Cmd"){this.showExecutionIndicator(t,"Testando comandos...");try{let e="",o=this.interceptors.Cmd;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo Cmd n\xE3o encontrado";let n=[];if(["markChatUnread","archiveChat","openChatAt","closeChat","chatInfoDrawer","pinChat","unpinChat","muteChat","unmuteChat"].forEach(i=>{typeof o[i]=="function"&&n.push(i)}),n.length>0){if(e=`\u2705 M\xF3dulo Cmd encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${n.join(", ")}`,this.testNumber){let i=`${this.testNumber}@c.us`;e+=`

\u{1F4A1} Exemplo: Cmd.openChatAt(Chat.get("${i}"))`}}else e=`\u2705 M\xF3dulo Cmd encontrado
\u26A0\uFE0F Nenhum m\xE9todo identificado`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Conn"){this.showExecutionIndicator(t,"Verificando conex\xE3o...");try{let e="",o=this.interceptors.Conn;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo Conn n\xE3o encontrado";let n=[];o.pushname&&n.push(`\u{1F464} Pushname: ${o.pushname}`),o.isOnline!==void 0&&n.push(`\u{1F7E2} Online: ${o.isOnline?"Sim":"N\xE3o"}`),o.isConnected!==void 0&&n.push(`\u{1F50C} Conectado: ${o.isConnected?"Sim":"N\xE3o"}`);let i=["connect","disconnect","reconnect","getState"].filter(a=>typeof o[a]=="function");return n.length>0||i.length>0?(e="\u2705 M\xF3dulo Conn encontrado",n.length>0&&(e+=`
${n.join(`
`)}`),i.length>0&&(e+=`
\u{1F4CB} M\xE9todos: ${i.join(", ")}`)):e=`\u2705 M\xF3dulo Conn encontrado
\u26A0\uFE0F Informa\xE7\xF5es de conex\xE3o n\xE3o acess\xEDveis`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="ChatState"){this.showExecutionIndicator(t,"Testando estado do chat...");try{let e="",o=this.interceptors.ChatState;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo ChatState n\xE3o encontrado";let s=["sendChatStateComposing","sendChatStateRecording","sendChatStatePaused","clearChatState"].filter(i=>typeof o[i]=="function");if(s.length>0){if(e=`\u2705 M\xF3dulo ChatState encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`,this.testNumber){let i=`${this.testNumber}@c.us`;e+=`

\u{1F4A1} Exemplo: ChatState.sendChatStateComposing(WidFactory.createWid("${i}"))`}}else e=`\u2705 M\xF3dulo ChatState encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Presence"){this.showExecutionIndicator(t,"Testando presen\xE7a...");try{let e="",o=this.interceptors.Presence;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo Presence n\xE3o encontrado";let s=["sendPresenceAvailable","sendPresenceUnavailable","subscribePresence","unsubscribePresence"].filter(i=>typeof o[i]=="function");return s.length>0?(e=`\u2705 M\xF3dulo Presence encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`,this.testNumber&&(e+=`

\u{1F4A1} Exemplo: Presence.subscribePresence("${this.testNumber}@c.us")`)):e=`\u2705 M\xF3dulo Presence encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="createGroup"){this.showExecutionIndicator(t,"Verificando cria\xE7\xE3o de grupos...");try{let e="",o=this.interceptors.createGroup;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o createGroup n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o createGroup encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para criar grupos`,e+=`

\u{1F4A1} Uso: createGroup({ subject: "Nome do Grupo", participants: ["5511999999999@c.us"] })`,e+=`
\u26A0\uFE0F N\xE3o ser\xE1 executado automaticamente (requer confirma\xE7\xE3o)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="getParticipants"){this.showExecutionIndicator(t,"Buscando participantes...");try{let e="",o=this.interceptors.getParticipants;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o getParticipants n\xE3o encontrada";let n=this.interceptors.Chat;if(n&&n._models){let s=n._models.filter(i=>{let a=i.id?._serialized||i.id||"";return a&&typeof a=="string"&&a.includes("@g.us")}).slice(0,3);if(s.length>0){e=`\u2705 Fun\xE7\xE3o getParticipants encontrada
\u{1F465} Testando com ${s.length} grupo(s)...

`;for(let i of s)try{let a=i.id?._serialized||i.id||"";if(a){let h=await Promise.resolve(o(a)).catch(()=>null);if(h&&Array.isArray(h)){let l=i.name||i.subject||a.split("@")[0];e+=`\u{1F4CB} ${l}: ${h.length} participante(s)
`}}}catch{}}else e=`\u2705 Fun\xE7\xE3o getParticipants encontrada
\u26A0\uFE0F Nenhum grupo encontrado para testar`}else e=`\u2705 Fun\xE7\xE3o getParticipants encontrada
\u26A0\uFE0F Chat module n\xE3o dispon\xEDvel para testar`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="MsgKey"){this.showExecutionIndicator(t,"Testando cria\xE7\xE3o de IDs...");try{let e="",o=this.interceptors.MsgKey;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo MsgKey n\xE3o encontrado";if(typeof o.newId=="function")try{let n=this.testNumber?`${this.testNumber}@c.us`:"5511999999999@c.us",s=o.newId(n);s?e=`\u2705 M\xF3dulo MsgKey encontrado
\u{1F511} M\xE9todo newId() dispon\xEDvel

\u{1F4CB} ID gerado: ${JSON.stringify(s).substring(0,100)}${JSON.stringify(s).length>100?"...":""}`:e=`\u2705 M\xF3dulo MsgKey encontrado
\u{1F511} M\xE9todo newId() dispon\xEDvel
\u26A0\uFE0F Retornou null/undefined`}catch(n){e=`\u2705 M\xF3dulo MsgKey encontrado
\u{1F511} M\xE9todo newId() dispon\xEDvel
\u26A0\uFE0F Erro ao testar: ${n.message}`}else e=`\u2705 M\xF3dulo MsgKey encontrado
\u26A0\uFE0F M\xE9todo newId() n\xE3o encontrado`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="WidFactory"){this.showExecutionIndicator(t,"Testando cria\xE7\xE3o de WIDs...");try{let e="",o=this.interceptors.WidFactory;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo WidFactory n\xE3o encontrado";if(typeof o=="function")try{let n=this.testNumber||"5511999999999",s=o(n);s?e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} Fun\xE7\xE3o createWid() dispon\xEDvel

\u{1F4CB} WID gerado: ${JSON.stringify(s).substring(0,100)}${JSON.stringify(s).length>100?"...":""}`:e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} Fun\xE7\xE3o createWid() dispon\xEDvel
\u26A0\uFE0F Retornou null/undefined`}catch(n){e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} Fun\xE7\xE3o createWid() dispon\xEDvel
\u26A0\uFE0F Erro ao testar: ${n.message}`}else if(typeof o.createWid=="function")try{let n=this.testNumber||"5511999999999",s=o.createWid(n);s?e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} M\xE9todo createWid() dispon\xEDvel

\u{1F4CB} WID gerado: ${JSON.stringify(s).substring(0,100)}${JSON.stringify(s).length>100?"...":""}`:e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} M\xE9todo createWid() dispon\xEDvel
\u26A0\uFE0F Retornou null/undefined`}catch(n){e=`\u2705 M\xF3dulo WidFactory encontrado
\u{1F511} M\xE9todo createWid() dispon\xEDvel
\u26A0\uFE0F Erro ao testar: ${n.message}`}else e=`\u2705 M\xF3dulo WidFactory encontrado
\u26A0\uFE0F M\xE9todo createWid() n\xE3o encontrado`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="QueryExist"){this.showExecutionIndicator(t,"Testando verifica\xE7\xE3o de exist\xEAncia...");try{let e="",o=this.interceptors.QueryExist;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o QueryExist n\xE3o encontrada";if(this.testNumber)try{let n=`${this.testNumber}@c.us`,s=await Promise.resolve(o(n)).catch(()=>null);s!=null?e=`\u2705 Fun\xE7\xE3o QueryExist encontrada
\u{1F4F1} N\xFAmero ${this.testNumber}: ${s?"Existe":"N\xE3o existe"}`:e=`\u2705 Fun\xE7\xE3o QueryExist encontrada
\u{1F4F1} Testado com: ${this.testNumber}
\u26A0\uFE0F Retorno n\xE3o dispon\xEDvel`}catch(n){e=`\u2705 Fun\xE7\xE3o QueryExist encontrada
\u26A0\uFE0F Erro ao testar: ${n.message}`}else e=`\u2705 Fun\xE7\xE3o QueryExist encontrada
\u{1F4A1} Configure um n\xFAmero de teste para verificar exist\xEAncia`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="canReplyMsg"){this.showExecutionIndicator(t,"Testando verifica\xE7\xE3o de resposta...");try{let e="",o=this.interceptors.canReplyMsg;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o canReplyMsg n\xE3o encontrada";let n=this.interceptors.Msg;if(n&&n._models&&n._models.length>0)try{let s=n._models[0],i=await Promise.resolve(o(s)).catch(()=>null);i!=null?e=`\u2705 Fun\xE7\xE3o canReplyMsg encontrada
\u{1F4AC} Pode responder: ${i?"Sim":"N\xE3o"}`:e=`\u2705 Fun\xE7\xE3o canReplyMsg encontrada
\u26A0\uFE0F Retorno n\xE3o dispon\xEDvel`}catch(s){e=`\u2705 Fun\xE7\xE3o canReplyMsg encontrada
\u26A0\uFE0F Erro ao testar: ${s.message}`}else e=`\u2705 Fun\xE7\xE3o canReplyMsg encontrada
\u{1F4A1} Fun\xE7\xE3o dispon\xEDvel para verificar se mensagem pode ser respondida`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="blockContact"){this.showExecutionIndicator(t,"Verificando bloqueio de contatos...");try{let e="",o=this.interceptors.blockContact;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o blockContact n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o blockContact encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para bloquear contatos`,e+=`

\u26A0\uFE0F N\xE3o ser\xE1 executado automaticamente (a\xE7\xE3o destrutiva)`,this.testNumber&&(e+=`
\u{1F4A1} Exemplo: blockContact("${this.testNumber}@c.us")`),this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="VCard"){this.showExecutionIndicator(t,"Testando cart\xE3o de contato...");try{let e="",o=this.interceptors.VCard;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o VCard n\xE3o encontrada";if(this.testNumber)try{let n=this.interceptors.Contact,s=`${this.testNumber}@c.us`;if(n&&typeof n.get=="function"){let i=n.get(s);if(i){let a=await Promise.resolve(o(i)).catch(()=>null);a?(e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u{1F4C7} vCard criado para: ${this.testNumber}`,a.vcard&&(e+=`
\u{1F4CB} vCard: ${String(a.vcard).substring(0,100)}${String(a.vcard).length>100?"...":""}`)):e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u26A0\uFE0F N\xE3o foi poss\xEDvel criar vCard para ${this.testNumber}`}else e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u26A0\uFE0F Contato ${this.testNumber} n\xE3o encontrado`}else e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u26A0\uFE0F Contact module n\xE3o dispon\xEDvel para testar`}catch(n){e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u26A0\uFE0F Erro ao testar: ${n.message}`}else e=`\u2705 Fun\xE7\xE3o VCard encontrada
\u{1F4A1} Configure um n\xFAmero de teste para criar vCard`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="SendDelete"){this.showExecutionIndicator(t,"Verificando envio/dele\xE7\xE3o...");try{let e="",o=this.interceptors.SendDelete;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo SendDelete n\xE3o encontrado";let s=["send","delete","sendDelete"].filter(i=>typeof o[i]=="function");return s.length>0?(e=`\u2705 M\xF3dulo SendDelete encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`,e+=`

\u26A0\uFE0F N\xE3o ser\xE1 executado automaticamente (a\xE7\xE3o destrutiva)`):e=`\u2705 M\xF3dulo SendDelete encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="uploadMedia"){this.showExecutionIndicator(t,"Verificando upload de m\xEDdia...");try{let e="",o=this.interceptors.uploadMedia;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o uploadMedia n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o uploadMedia encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para enviar m\xEDdia`,e+=`

\u26A0\uFE0F N\xE3o ser\xE1 executado automaticamente (requer arquivo)`,e+=`
\u{1F4A1} Uso: uploadMedia(chatId, file, options)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="MediaPrep"){this.showExecutionIndicator(t,"Verificando prepara\xE7\xE3o de m\xEDdia...");try{let e="",o=this.interceptors.MediaPrep;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o MediaPrep n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o MediaPrep encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para preparar m\xEDdia antes de enviar`,e+=`
\u{1F4A1} Uso: MediaPrep(file, options)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="MediaObject"){this.showExecutionIndicator(t,"Verificando objeto de m\xEDdia...");try{let e="",o=this.interceptors.MediaObject;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o MediaObject n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o MediaObject encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para criar/obter objetos de m\xEDdia`,e+=`
\u{1F4A1} Uso: MediaObject(mediaId) ou MediaObject.create(data)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="MediaTypes"){this.showExecutionIndicator(t,"Verificando tipos de m\xEDdia...");try{let e="",o=this.interceptors.MediaTypes;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o MediaTypes n\xE3o encontrada";let n=this.interceptors.Msg;if(n&&n._models&&n._models.length>0)try{let s=n._models[0],i=await Promise.resolve(o(s)).catch(()=>null);i!=null?e=`\u2705 Fun\xE7\xE3o MediaTypes encontrada
\u{1F4CB} Tipo de m\xEDdia: ${i}`:e=`\u2705 Fun\xE7\xE3o MediaTypes encontrada
\u26A0\uFE0F Retorno n\xE3o dispon\xEDvel`}catch(s){e=`\u2705 Fun\xE7\xE3o MediaTypes encontrada
\u26A0\uFE0F Erro ao testar: ${s.message}`}else e=`\u2705 Fun\xE7\xE3o MediaTypes encontrada
\u{1F4A1} Fun\xE7\xE3o dispon\xEDvel para converter mensagem em tipo de m\xEDdia`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="MediaCollection"){this.showExecutionIndicator(t,"Buscando cole\xE7\xE3o de m\xEDdia...");try{let e="",o=this.interceptors.MediaCollection;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo MediaCollection n\xE3o encontrado";let s=["get","add","remove","processAttachments"].filter(i=>typeof o[i]=="function");return s.length>0?(e=`\u2705 M\xF3dulo MediaCollection encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`,o._models&&Array.isArray(o._models)&&(e+=`
\u{1F4CA} Total: ${o._models.length} item(ns) na cole\xE7\xE3o`)):e=`\u2705 M\xF3dulo MediaCollection encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="UploadUtils"){this.showExecutionIndicator(t,"Verificando utilit\xE1rios de upload...");try{let e="",o=this.interceptors.UploadUtils;return o?(typeof o.encryptAndUpload=="function"?(e=`\u2705 M\xF3dulo UploadUtils encontrado
\u{1F510} M\xE9todo encryptAndUpload() dispon\xEDvel`,e+=`
\u{1F4A1} Fun\xE7\xE3o para criptografar e fazer upload de arquivos`):e=`\u2705 M\xF3dulo UploadUtils encontrado
\u26A0\uFE0F M\xE9todo encryptAndUpload() n\xE3o encontrado`,this.hideExecutionIndicator(t),e):(this.hideExecutionIndicator(t),"\u274C M\xF3dulo UploadUtils n\xE3o encontrado")}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="DownloadManager"){this.showExecutionIndicator(t,"Verificando gerenciador de download...");try{let e="",o=this.interceptors.DownloadManager;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo DownloadManager n\xE3o encontrado";let s=["download","downloadMedia","getDownloadUrl"].filter(i=>typeof o[i]=="function");return s.length>0?e=`\u2705 M\xF3dulo DownloadManager encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`:e=`\u2705 M\xF3dulo DownloadManager encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="OpaqueData"){this.showExecutionIndicator(t,"Verificando dados opacos...");try{let e="",o=this.interceptors.OpaqueData;return o?(typeof o.createFromData=="function"?(e=`\u2705 M\xF3dulo OpaqueData encontrado
\u{1F510} M\xE9todo createFromData() dispon\xEDvel`,e+=`
\u{1F4A1} Fun\xE7\xE3o para criar dados opacos (criptografados)`):e=`\u2705 M\xF3dulo OpaqueData encontrado
\u26A0\uFE0F M\xE9todo createFromData() n\xE3o encontrado`,this.hideExecutionIndicator(t),e):(this.hideExecutionIndicator(t),"\u274C M\xF3dulo OpaqueData n\xE3o encontrado")}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="UserConstructor"){this.showExecutionIndicator(t,"Verificando construtor de usu\xE1rio...");try{let e="",o=this.interceptors.UserConstructor;return o?(typeof o=="function"?(e=`\u2705 M\xF3dulo UserConstructor encontrado
\u{1F3D7}\uFE0F Construtor de usu\xE1rio dispon\xEDvel`,e+=`
\u{1F4A1} Uso: new UserConstructor(data)`):e=`\u2705 M\xF3dulo UserConstructor encontrado
\u26A0\uFE0F N\xE3o \xE9 uma fun\xE7\xE3o construtora`,this.hideExecutionIndicator(t),e):(this.hideExecutionIndicator(t),"\u274C M\xF3dulo UserConstructor n\xE3o encontrado")}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="USyncQuery"){this.showExecutionIndicator(t,"Verificando query de sincroniza\xE7\xE3o...");try{let e="",o=this.interceptors.USyncQuery;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo USyncQuery n\xE3o encontrado";let s=["query","sync","get"].filter(i=>typeof o[i]=="function");return s.length>0?e=`\u2705 M\xF3dulo USyncQuery encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`:e=`\u2705 M\xF3dulo USyncQuery encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="USyncUser"){this.showExecutionIndicator(t,"Verificando sincroniza\xE7\xE3o de usu\xE1rio...");try{let e="",o=this.interceptors.USyncUser;if(!o)return this.hideExecutionIndicator(t),"\u274C M\xF3dulo USyncUser n\xE3o encontrado";let s=["sync","get","update"].filter(i=>typeof o[i]=="function");return s.length>0?e=`\u2705 M\xF3dulo USyncUser encontrado
\u{1F4CB} M\xE9todos dispon\xEDveis: ${s.join(", ")}`:e=`\u2705 M\xF3dulo USyncUser encontrado
\u26A0\uFE0F M\xE9todos n\xE3o identificados`,this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="getEphemeralFields"){this.showExecutionIndicator(t,"Verificando campos ef\xEAmeros...");try{let e="",o=this.interceptors.getEphemeralFields;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o getEphemeralFields n\xE3o encontrada";let n=this.interceptors.Msg;if(n&&n._models&&n._models.length>0)try{let s=n._models[0],i=await Promise.resolve(o(s)).catch(()=>null);i!=null?e=`\u2705 Fun\xE7\xE3o getEphemeralFields encontrada
\u{1F4CB} Campos ef\xEAmeros: ${Object.keys(i).length} campo(s)`:e=`\u2705 Fun\xE7\xE3o getEphemeralFields encontrada
\u26A0\uFE0F Retorno n\xE3o dispon\xEDvel`}catch(s){e=`\u2705 Fun\xE7\xE3o getEphemeralFields encontrada
\u26A0\uFE0F Erro ao testar: ${s.message}`}else e=`\u2705 Fun\xE7\xE3o getEphemeralFields encontrada
\u{1F4A1} Fun\xE7\xE3o dispon\xEDvel para obter campos tempor\xE1rios de mensagens`;return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="genMinimalLinkPreview"){this.showExecutionIndicator(t,"Verificando preview de link...");try{let e="",o=this.interceptors.genMinimalLinkPreview;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o genMinimalLinkPreview n\xE3o encontrada";try{let n="https://example.com",s=await Promise.resolve(o(n)).catch(()=>null);s?(e=`\u2705 Fun\xE7\xE3o genMinimalLinkPreview encontrada
\u{1F517} Preview gerado para: ${n}`,s.title&&(e+=`
\u{1F4CB} T\xEDtulo: ${s.title}`)):e=`\u2705 Fun\xE7\xE3o genMinimalLinkPreview encontrada
\u26A0\uFE0F N\xE3o foi poss\xEDvel gerar preview`}catch(n){e=`\u2705 Fun\xE7\xE3o genMinimalLinkPreview encontrada
\u26A0\uFE0F Erro ao testar: ${n.message}`}return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="findFirstWebLink"){this.showExecutionIndicator(t,"Verificando busca de links...");try{let e="",o=this.interceptors.findFirstWebLink;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o findFirstWebLink n\xE3o encontrada";try{let s=await Promise.resolve(o("Visite https://example.com para mais informa\xE7\xF5es")).catch(()=>null);s?e=`\u2705 Fun\xE7\xE3o findFirstWebLink encontrada
\u{1F517} Link encontrado: ${s}`:e=`\u2705 Fun\xE7\xE3o findFirstWebLink encontrada
\u26A0\uFE0F N\xE3o foi poss\xEDvel encontrar link no texto de teste`}catch(n){e=`\u2705 Fun\xE7\xE3o findFirstWebLink encontrada
\u26A0\uFE0F Erro ao testar: ${n.message}`}return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="getSearchContext"){this.showExecutionIndicator(t,"Verificando contexto de busca...");try{let e="",o=this.interceptors.getSearchContext;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o getSearchContext n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o getSearchContext encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para obter contexto de buscas`,e+=`
\u{1F4A1} Uso: getSearchContext(query, options)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="sendReactionToMsg"){this.showExecutionIndicator(t,"Verificando envio de rea\xE7\xE3o...");try{let e="",o=this.interceptors.sendReactionToMsg;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o sendReactionToMsg n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o sendReactionToMsg encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para enviar rea\xE7\xF5es (emoji)`,e+=`

\u26A0\uFE0F N\xE3o ser\xE1 executado automaticamente`,e+=`
\u{1F4A1} Uso: sendReactionToMsg(messageId, emoji)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="colorIndexToHex"){this.showExecutionIndicator(t,"Testando convers\xE3o de cor...");try{let e="",o=this.interceptors.colorIndexToHex;if(!o||typeof o!="function")return this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o colorIndexToHex n\xE3o encontrada";try{let n=[0,1,2,5,10],s=[];for(let i of n)try{let a=await Promise.resolve(o(i)).catch(()=>null);a&&s.push(`\xCDndice ${i}: ${a}`)}catch{}s.length>0?e=`\u2705 Fun\xE7\xE3o colorIndexToHex encontrada
\u{1F3A8} Convers\xF5es de teste:
${s.map(i=>`   ${i}`).join(`
`)}`:e=`\u2705 Fun\xE7\xE3o colorIndexToHex encontrada
\u26A0\uFE0F N\xE3o foi poss\xEDvel testar convers\xF5es`}catch(n){e=`\u2705 Fun\xE7\xE3o colorIndexToHex encontrada
\u26A0\uFE0F Erro ao testar: ${n.message}`}return this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="StatusUtils"){this.showExecutionIndicator(t,"Verificando utilit\xE1rios de status...");try{let e="",o=this.interceptors.StatusUtils;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C M\xF3dulo StatusUtils n\xE3o encontrado"):(e=`\u2705 M\xF3dulo StatusUtils encontrado
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para definir status`,e+=`
\u{1F4A1} Uso: StatusUtils(text) ou StatusUtils.setMyStatus(text)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Composing"){this.showExecutionIndicator(t,"Verificando estado de digita\xE7\xE3o...");try{let e="",o=this.interceptors.Composing;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o Composing n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o Composing encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para marcar como digitando`,e+=`
\u{1F4A1} Uso: Composing(chatId) ou Composing.markComposing(chatId)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="ConversationSeen"){this.showExecutionIndicator(t,"Verificando marca\xE7\xE3o de vista...");try{let e="",o=this.interceptors.ConversationSeen;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o ConversationSeen n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o ConversationSeen encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para marcar conversa como vista`,e+=`
\u{1F4A1} Uso: ConversationSeen(chatId) ou ConversationSeen.sendConversationSeen(chatId)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Playing"){this.showExecutionIndicator(t,"Verificando estado de reprodu\xE7\xE3o...");try{let e="",o=this.interceptors.Playing;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o Playing n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o Playing encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para marcar \xE1udio como tocado`,e+=`
\u{1F4A1} Uso: Playing(messageId) ou Playing.markPlayed(messageId)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="StatusState"){this.showExecutionIndicator(t,"Verificando estado de status...");try{let e="",o=this.interceptors.StatusState;return!o||typeof o!="function"?(this.hideExecutionIndicator(t),"\u274C Fun\xE7\xE3o StatusState n\xE3o encontrada"):(e=`\u2705 Fun\xE7\xE3o StatusState encontrada
\u{1F4CB} Fun\xE7\xE3o dispon\xEDvel para marcar status como lido`,e+=`
\u{1F4A1} Uso: StatusState(statusId) ou StatusState.markStatusRead(statusId)`,this.hideExecutionIndicator(t),e)}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}if(t==="Classes"){this.showExecutionIndicator(t,"Verificando classes CSS...");try{let e="",o=this.interceptors.Classes;if(!o||typeof o!="object")return this.hideExecutionIndicator(t),"\u274C M\xF3dulo Classes n\xE3o encontrado";let n=Object.keys(o);return n.length>0?(e=`\u2705 M\xF3dulo Classes encontrado
\u{1F4CB} Classes CSS dispon\xEDveis: ${n.slice(0,10).join(", ")}`,n.length>10&&(e+=`
... e mais ${n.length-10} classe(s)`)):(e=`\u2705 M\xF3dulo Classes encontrado
\u26A0\uFE0F Nenhuma classe CSS identificada`,e+=`
\u{1F4A1} Classes s\xE3o seletores CSS din\xE2micos do WhatsApp`),this.hideExecutionIndicator(t),e}catch(e){return this.hideExecutionIndicator(t),`\u26A0\uFE0F Erro: ${e.message}`}}return""}catch(e){return console.log("[TEST] Erro no teste funcional:",e.message),""}}showExecutionIndicator(t,r){if(!this.container)return;let e=this.container.querySelector(`[data-module="${t}"]`);if(e){e.classList.add("executing");let o=e.querySelector(".mettri-test-execution-indicator");o||(o=document.createElement("div"),o.className="mettri-test-execution-indicator",e.appendChild(o)),o.textContent=r,o.setAttribute("style","display: block;")}}hideExecutionIndicator(t){if(!this.container)return;let r=this.container.querySelector(`[data-module="${t}"]`);if(r){r.classList.remove("executing");let e=r.querySelector(".mettri-test-execution-indicator");e&&e.setAttribute("style","display: none;")}}escapeHtml(t){let r=document.createElement("div");return r.textContent=t,r.innerHTML}formatTimeAgo(t){let e=new Date().getTime()-t.getTime(),o=Math.floor(e/6e4);if(o<1)return"agora";if(o<60)return`h\xE1 ${o} minuto${o>1?"s":""}`;let n=Math.floor(o/60);if(n<24)return`h\xE1 ${n} hora${n>1?"s":""}`;let s=Math.floor(n/24);return`h\xE1 ${s} dia${s>1?"s":""}`}};var j=class{initialized=!1;async initialize(){if(!this.initialized)return new Promise(t=>{let r=Date.now(),e=()=>{let o=window.Mettri,n=!!o&&(o.__ready===!0||!!o.Chat||!!o.Msg),s=Date.now()-r>6e4;n||s?(this.initialized=!0,t()):setTimeout(e,100)};e()})}isWebpackAvailable(){return window.Mettri?.isWebpackAvailable()??!1}get Msg(){return window.Mettri?.Msg}get Chat(){return window.Mettri?.Chat}get Contact(){return window.Mettri?.Contact}get Label(){return window.Mettri?.Label}get ChatCollection(){return window.Mettri?.ChatCollection}get ConversationMsgs(){return window.Mettri?.ConversationMsgs}get PresenceCollection(){return window.Mettri?.PresenceCollection}get GroupMetadata(){return window.Mettri?.GroupMetadata}get User(){return window.Mettri?.User}get Conn(){return window.Mettri?.Conn}get MsgKey(){return window.Mettri?.MsgKey}get SendDelete(){return window.Mettri?.SendDelete}get addAndSendMsgToChat(){return window.Mettri?.addAndSendMsgToChat}get sendTextMsgToChat(){return window.Mettri?.sendTextMsgToChat}get getEphemeralFields(){return window.Mettri?.getEphemeralFields}get canReplyMsg(){return window.Mettri?.canReplyMsg}get Cmd(){return window.Mettri?.Cmd}get ChatState(){return window.Mettri?.ChatState}get Presence(){return window.Mettri?.Presence}get createGroup(){return window.Mettri?.createGroup}get getParticipants(){return window.Mettri?.getParticipants}get blockContact(){return window.Mettri?.blockContact}get VCard(){return window.Mettri?.VCard}get QueryExist(){return window.Mettri?.QueryExist}get uploadMedia(){return window.Mettri?.uploadMedia}get MediaPrep(){return window.Mettri?.MediaPrep}get MediaObject(){return window.Mettri?.MediaObject}get MediaTypes(){return window.Mettri?.MediaTypes}get MediaCollection(){return window.Mettri?.MediaCollection}get UploadUtils(){return window.Mettri?.UploadUtils}get DownloadManager(){return window.Mettri?.DownloadManager}get OpaqueData(){return window.Mettri?.OpaqueData}get UserConstructor(){return window.Mettri?.UserConstructor}get USyncQuery(){return window.Mettri?.USyncQuery}get USyncUser(){return window.Mettri?.USyncUser}get genMinimalLinkPreview(){return window.Mettri?.genMinimalLinkPreview}get findFirstWebLink(){return window.Mettri?.findFirstWebLink}get getSearchContext(){return window.Mettri?.getSearchContext}get sendReactionToMsg(){return window.Mettri?.sendReactionToMsg}get colorIndexToHex(){return window.Mettri?.colorIndexToHex}get StatusUtils(){return window.Mettri?.StatusUtils}get Composing(){return window.Mettri?.Composing}get ConversationSeen(){return window.Mettri?.ConversationSeen}get Playing(){return window.Mettri?.Playing}get StatusState(){return window.Mettri?.StatusState}get Classes(){return window.Mettri?.Classes}get WidFactory(){return window.Mettri?.WidFactory}async testModule(t){try{return this[t]?"success":"error"}catch{return"error"}}handleResponse(t){}},_=new j;var Q=async(I,t)=>{await _.initialize();let r=new F(_);return{async render(){let e=await r.render();I.appendChild(e)},destroy(){}}},H={id:"infrastructure.tests",name:"Testes",parent:"infrastructure",icon:"\u{1F9EA}",dependencies:[],panelFactory:Q,lazy:!0};function Y(I){I.register(H)}return V(J);})();

// Auto-register module if register function is available in global scope
(function() {
  try {
    // Try to find register function from parent scope (passed as parameter)
    if (typeof register === 'function') {
      // Find module definition (could be named differently per module)
      var moduleDef = null;
      var moduleNames = ['ReactivationModule', 'RetomarModule', 'EnviarModule', 'HistoryModule', 'DirectoryModule', 'DashboardModule', 'TestsModule', 'MarketingModule', 'AtendimentoModule', 'ClientesModule', 'InfrastructureModule', 'EnviarRetomarModule', 'EnviarResponderModule', 'EnviarDivulgarModule'];
      for (var i = 0; i < moduleNames.length; i++) {
        if (typeof window[moduleNames[i]] !== 'undefined') {
          moduleDef = window[moduleNames[i]];
          break;
        }
      }
      // Also check global variable
      if (!moduleDef && typeof MettriModule_infrastructure_tests !== 'undefined') {
        if (MettriModule_infrastructure_tests.module) {
          moduleDef = MettriModule_infrastructure_tests.module;
        } else if (MettriModule_infrastructure_tests.id) {
          moduleDef = MettriModule_infrastructure_tests;
        }
      }
      if (moduleDef && moduleDef.id) {
        register(moduleDef);
      }
    }
    // Export to global for fallback access
    if (typeof window !== 'undefined') {
      window.MettriModule_infrastructure_tests = typeof MettriModule_infrastructure_tests !== 'undefined' ? MettriModule_infrastructure_tests : null;
    }
  } catch (e) {
    console.warn('[ModuleLoader] Error auto-registering module:', e);
  }
})();

