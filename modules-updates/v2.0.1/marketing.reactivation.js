// Module: marketing.reactivation

"use strict";var MettriModule_marketing_reactivation=(()=>{var Ve=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Nt=Object.prototype.hasOwnProperty;var nt=(n,e)=>{for(var t in e)Ve(n,t,{get:e[t],enumerable:!0})},Rt=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Dt(e))!Nt.call(n,r)&&r!==t&&Ve(n,r,{get:()=>e[r],enumerable:!(s=At(e,r))||s.enumerable});return n};var Pt=n=>Rt(Ve({},"__esModule",{value:!0}),n);var cr={};nt(cr,{ReactivationModule:()=>St,register:()=>or});var p={};nt(p,{BRAND:()=>os,DIRTY:()=>te,EMPTY_PATH:()=>Bt,INVALID:()=>y,NEVER:()=>Vs,OK:()=>A,ParseStatus:()=>L,Schema:()=>x,ZodAny:()=>X,ZodArray:()=>G,ZodBigInt:()=>re,ZodBoolean:()=>ne,ZodBranded:()=>Se,ZodCatch:()=>fe,ZodDate:()=>ie,ZodDefault:()=>me,ZodDiscriminatedUnion:()=>Oe,ZodEffects:()=>j,ZodEnum:()=>pe,ZodError:()=>R,ZodFirstPartyTypeKind:()=>v,ZodFunction:()=>Be,ZodIntersection:()=>de,ZodIssueCode:()=>u,ZodLazy:()=>le,ZodLiteral:()=>ue,ZodMap:()=>Me,ZodNaN:()=>Ee,ZodNativeEnum:()=>he,ZodNever:()=>U,ZodNull:()=>oe,ZodNullable:()=>V,ZodNumber:()=>se,ZodObject:()=>P,ZodOptional:()=>$,ZodParsedType:()=>f,ZodPipeline:()=>Le,ZodPromise:()=>ee,ZodReadonly:()=>ge,ZodRecord:()=>je,ZodSchema:()=>x,ZodSet:()=>ke,ZodString:()=>J,ZodSymbol:()=>_e,ZodTransformer:()=>j,ZodTuple:()=>q,ZodType:()=>x,ZodUndefined:()=>ae,ZodUnion:()=>ce,ZodUnknown:()=>K,ZodVoid:()=>Ce,addIssueToContext:()=>h,any:()=>gs,array:()=>xs,bigint:()=>us,boolean:()=>ft,coerce:()=>qs,custom:()=>pt,date:()=>ps,datetimeRegex:()=>lt,defaultErrorMap:()=>W,discriminatedUnion:()=>Ms,effect:()=>$s,enum:()=>Ns,function:()=>Ls,getErrorMap:()=>be,getParsedType:()=>H,instanceof:()=>ds,intersection:()=>ks,isAborted:()=>Pe,isAsync:()=>xe,isDirty:()=>$e,isValid:()=>Q,late:()=>cs,lazy:()=>As,literal:()=>Ds,makeIssue:()=>Ie,map:()=>Is,nan:()=>ls,nativeEnum:()=>Rs,never:()=>vs,null:()=>fs,nullable:()=>js,number:()=>mt,object:()=>ws,objectUtil:()=>We,oboolean:()=>Hs,onumber:()=>zs,optional:()=>Os,ostring:()=>Fs,pipeline:()=>Us,preprocess:()=>Bs,promise:()=>Ps,quotelessJson:()=>$t,record:()=>Ts,set:()=>Ss,setErrorMap:()=>jt,strictObject:()=>_s,string:()=>ht,symbol:()=>hs,transformer:()=>$s,tuple:()=>Es,undefined:()=>ms,union:()=>Cs,unknown:()=>ys,util:()=>_,void:()=>bs});var _;(function(n){n.assertEqual=r=>{};function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{let i={};for(let o of r)i[o]=o;return i},n.getValidEnumValues=r=>{let i=n.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),o={};for(let a of i)o[a]=r[a];return n.objectValues(o)},n.objectValues=r=>n.objectKeys(r).map(function(i){return r[i]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{let i=[];for(let o in r)Object.prototype.hasOwnProperty.call(r,o)&&i.push(o);return i},n.find=(r,i)=>{for(let o of r)if(i(o))return o},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function s(r,i=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}n.joinValues=s,n.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(_||(_={}));var We;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(We||(We={}));var f=_.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),H=n=>{switch(typeof n){case"undefined":return f.undefined;case"string":return f.string;case"number":return Number.isNaN(n)?f.nan:f.number;case"boolean":return f.boolean;case"function":return f.function;case"bigint":return f.bigint;case"symbol":return f.symbol;case"object":return Array.isArray(n)?f.array:n===null?f.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?f.promise:typeof Map<"u"&&n instanceof Map?f.map:typeof Set<"u"&&n instanceof Set?f.set:typeof Date<"u"&&n instanceof Date?f.date:f.object;default:return f.unknown}};var u=_.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),$t=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),R=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},r=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,c=0;for(;c<o.path.length;){let d=o.path[c];c===o.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(t(o))):a[d]=a[d]||{_errors:[]},a=a[d],c++}}};return r(this),s}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let r of this.issues)if(r.path.length>0){let i=r.path[0];t[i]=t[i]||[],t[i].push(e(r))}else s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};R.create=n=>new R(n);var Ot=(n,e)=>{let t;switch(n.code){case u.invalid_type:n.received===f.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case u.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,_.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:t=`Unrecognized key(s) in object: ${_.joinValues(n.keys,", ")}`;break;case u.invalid_union:t="Invalid input";break;case u.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${_.joinValues(n.options)}`;break;case u.invalid_enum_value:t=`Invalid enum value. Expected ${_.joinValues(n.options)}, received '${n.received}'`;break;case u.invalid_arguments:t="Invalid function arguments";break;case u.invalid_return_type:t="Invalid function return type";break;case u.invalid_date:t="Invalid date";break;case u.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:_.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case u.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case u.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case u.custom:t="Invalid input";break;case u.invalid_intersection_types:t="Intersection results could not be merged";break;case u.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case u.not_finite:t="Number must be finite";break;default:t=e.defaultError,_.assertNever(n)}return{message:t}},W=Ot;var it=W;function jt(n){it=n}function be(){return it}var Ie=n=>{let{data:e,path:t,errorMaps:s,issueData:r}=n,i=[...t,...r.path||[]],o={...r,path:i};if(r.message!==void 0)return{...r,path:i,message:r.message};let a="",c=s.filter(d=>!!d).slice().reverse();for(let d of c)a=d(o,{data:e,defaultError:a}).message;return{...r,path:i,message:a}},Bt=[];function h(n,e){let t=be(),s=Ie({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===W?void 0:W].filter(r=>!!r)});n.common.issues.push(s)}var L=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let r of t){if(r.status==="aborted")return y;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let r of t){let i=await r.key,o=await r.value;s.push({key:i,value:o})}return n.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let r of t){let{key:i,value:o}=r;if(i.status==="aborted"||o.status==="aborted")return y;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}},y=Object.freeze({status:"aborted"}),te=n=>({status:"dirty",value:n}),A=n=>({status:"valid",value:n}),Pe=n=>n.status==="aborted",$e=n=>n.status==="dirty",Q=n=>n.status==="valid",xe=n=>typeof Promise<"u"&&n instanceof Promise;var g;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(g||(g={}));var O=class{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},at=(n,e)=>{if(Q(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new R(n.common.issues);return this._error=t,this._error}}};function b(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:r}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,a)=>{let{message:c}=n;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??s??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:r}}var x=class{get description(){return this._def.description}_getType(e){return H(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:H(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new L,ctx:{common:e.parent.common,data:e.data,parsedType:H(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(xe(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)},r=this._parseSync({data:e,path:s.path,parent:s});return at(s,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return Q(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>Q(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)},r=this._parse({data:e,path:s.path,parent:s}),i=await(xe(r)?r:Promise.resolve(r));return at(s,i)}refine(e,t){let s=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,i)=>{let o=e(r),a=()=>i.addIssue({code:u.custom,...s(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((s,r)=>e(s)?!0:(r.addIssue(typeof t=="function"?t(s,r):t),!1))}_refinement(e){return new j({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return $.create(this,this._def)}nullable(){return V.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return G.create(this)}promise(){return ee.create(this,this._def)}or(e){return ce.create([this,e],this._def)}and(e){return de.create(this,e,this._def)}transform(e){return new j({...b(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new me({...b(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new Se({typeName:v.ZodBranded,type:this,...b(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new fe({...b(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Le.create(this,e)}readonly(){return ge.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Ut=/^c[^\s-]{8,}$/i,Ft=/^[0-9a-z]+$/,zt=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ht=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,qt=/^[a-z0-9_-]{21}$/i,Vt=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Wt=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Zt=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Kt="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ze,Gt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Yt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Qt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Jt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Xt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,es=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ct="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ts=new RegExp(`^${ct}$`);function dt(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function ss(n){return new RegExp(`^${dt(n)}$`)}function lt(n){let e=`${ct}T${dt(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function rs(n,e){return!!((e==="v4"||!e)&&Gt.test(n)||(e==="v6"||!e)&&Qt.test(n))}function ns(n,e){if(!Vt.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(s));return!(typeof r!="object"||r===null||"typ"in r&&r?.typ!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function is(n,e){return!!((e==="v4"||!e)&&Yt.test(n)||(e==="v6"||!e)&&Jt.test(n))}var J=class n extends x{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==f.string){let i=this._getOrReturnCtx(e);return h(i,{code:u.invalid_type,expected:f.string,received:i.parsedType}),y}let s=new L,r;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),h(r,{code:u.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),h(r,{code:u.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(r=this._getOrReturnCtx(e,r),o?h(r,{code:u.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&h(r,{code:u.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Zt.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"email",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Ze||(Ze=new RegExp(Kt,"u")),Ze.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"emoji",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Ht.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"uuid",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")qt.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"nanoid",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Ut.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"cuid",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Ft.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"cuid2",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")zt.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"ulid",code:u.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),h(r,{validation:"url",code:u.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"regex",code:u.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?lt(i).test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?ts.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?ss(i).test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:u.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Wt.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"duration",code:u.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?rs(e.data,i.version)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"ip",code:u.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?ns(e.data,i.alg)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"jwt",code:u.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?is(e.data,i.version)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"cidr",code:u.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Xt.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"base64",code:u.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?es.test(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{validation:"base64url",code:u.invalid_string,message:i.message}),s.dirty()):_.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(r=>e.test(r),{validation:t,code:u.invalid_string,...g.errToObj(s)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...g.errToObj(e)})}url(e){return this._addCheck({kind:"url",...g.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...g.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...g.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...g.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...g.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...g.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...g.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...g.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...g.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...g.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...g.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...g.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...g.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...g.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...g.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...g.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...g.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...g.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...g.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...g.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...g.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...g.errToObj(t)})}nonempty(e){return this.min(1,g.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};J.create=n=>new J({checks:[],typeName:v.ZodString,coerce:n?.coerce??!1,...b(n)});function as(n,e){let t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=t>s?t:s,i=Number.parseInt(n.toFixed(r).replace(".","")),o=Number.parseInt(e.toFixed(r).replace(".",""));return i%o/10**r}var se=class n extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==f.number){let i=this._getOrReturnCtx(e);return h(i,{code:u.invalid_type,expected:f.number,received:i.parsedType}),y}let s,r=new L;for(let i of this._def.checks)i.kind==="int"?_.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:u.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?as(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:u.not_finite,message:i.message}),r.dirty()):_.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,g.toString(t))}gt(e,t){return this.setLimit("min",e,!1,g.toString(t))}lte(e,t){return this.setLimit("max",e,!0,g.toString(t))}lt(e,t){return this.setLimit("max",e,!1,g.toString(t))}setLimit(e,t,s,r){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:g.toString(r)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:g.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:g.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:g.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:g.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:g.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:g.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:g.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:g.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:g.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&_.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};se.create=n=>new se({checks:[],typeName:v.ZodNumber,coerce:n?.coerce||!1,...b(n)});var re=class n extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==f.bigint)return this._getInvalidInput(e);let s,r=new L;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),h(s,{code:u.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):_.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return h(t,{code:u.invalid_type,expected:f.bigint,received:t.parsedType}),y}gte(e,t){return this.setLimit("min",e,!0,g.toString(t))}gt(e,t){return this.setLimit("min",e,!1,g.toString(t))}lte(e,t){return this.setLimit("max",e,!0,g.toString(t))}lt(e,t){return this.setLimit("max",e,!1,g.toString(t))}setLimit(e,t,s,r){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:g.toString(r)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:g.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:g.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:g.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:g.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:g.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};re.create=n=>new re({checks:[],typeName:v.ZodBigInt,coerce:n?.coerce??!1,...b(n)});var ne=class extends x{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==f.boolean){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.boolean,received:s.parsedType}),y}return A(e.data)}};ne.create=n=>new ne({typeName:v.ZodBoolean,coerce:n?.coerce||!1,...b(n)});var ie=class n extends x{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==f.date){let i=this._getOrReturnCtx(e);return h(i,{code:u.invalid_type,expected:f.date,received:i.parsedType}),y}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return h(i,{code:u.invalid_date}),y}let s=new L,r;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),h(r,{code:u.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),h(r,{code:u.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):_.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:g.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:g.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};ie.create=n=>new ie({checks:[],coerce:n?.coerce||!1,typeName:v.ZodDate,...b(n)});var _e=class extends x{_parse(e){if(this._getType(e)!==f.symbol){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.symbol,received:s.parsedType}),y}return A(e.data)}};_e.create=n=>new _e({typeName:v.ZodSymbol,...b(n)});var ae=class extends x{_parse(e){if(this._getType(e)!==f.undefined){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.undefined,received:s.parsedType}),y}return A(e.data)}};ae.create=n=>new ae({typeName:v.ZodUndefined,...b(n)});var oe=class extends x{_parse(e){if(this._getType(e)!==f.null){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.null,received:s.parsedType}),y}return A(e.data)}};oe.create=n=>new oe({typeName:v.ZodNull,...b(n)});var X=class extends x{constructor(){super(...arguments),this._any=!0}_parse(e){return A(e.data)}};X.create=n=>new X({typeName:v.ZodAny,...b(n)});var K=class extends x{constructor(){super(...arguments),this._unknown=!0}_parse(e){return A(e.data)}};K.create=n=>new K({typeName:v.ZodUnknown,...b(n)});var U=class extends x{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:u.invalid_type,expected:f.never,received:t.parsedType}),y}};U.create=n=>new U({typeName:v.ZodNever,...b(n)});var Ce=class extends x{_parse(e){if(this._getType(e)!==f.undefined){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.void,received:s.parsedType}),y}return A(e.data)}};Ce.create=n=>new Ce({typeName:v.ZodVoid,...b(n)});var G=class n extends x{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==f.array)return h(t,{code:u.invalid_type,expected:f.array,received:t.parsedType}),y;if(r.exactLength!==null){let o=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(o||a)&&(h(t,{code:o?u.too_big:u.too_small,minimum:a?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(h(t,{code:u.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(h(t,{code:u.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>r.type._parseAsync(new O(t,o,t.path,a)))).then(o=>L.mergeArray(s,o));let i=[...t.data].map((o,a)=>r.type._parseSync(new O(t,o,t.path,a)));return L.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new n({...this._def,minLength:{value:e,message:g.toString(t)}})}max(e,t){return new n({...this._def,maxLength:{value:e,message:g.toString(t)}})}length(e,t){return new n({...this._def,exactLength:{value:e,message:g.toString(t)}})}nonempty(e){return this.min(1,e)}};G.create=(n,e)=>new G({type:n,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...b(e)});function we(n){if(n instanceof P){let e={};for(let t in n.shape){let s=n.shape[t];e[t]=$.create(we(s))}return new P({...n._def,shape:()=>e})}else return n instanceof G?new G({...n._def,type:we(n.element)}):n instanceof $?$.create(we(n.unwrap())):n instanceof V?V.create(we(n.unwrap())):n instanceof q?q.create(n.items.map(e=>we(e))):n}var P=class n extends x{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=_.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==f.object){let d=this._getOrReturnCtx(e);return h(d,{code:u.invalid_type,expected:f.object,received:d.parsedType}),y}let{status:s,ctx:r}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof U&&this._def.unknownKeys==="strip"))for(let d in r.data)o.includes(d)||a.push(d);let c=[];for(let d of o){let l=i[d],m=r.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new O(r,m,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof U){let d=this._def.unknownKeys;if(d==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:r.data[l]}});else if(d==="strict")a.length>0&&(h(r,{code:u.unrecognized_keys,keys:a}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let l of a){let m=r.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new O(r,m,r.path,l)),alwaysSet:l in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let d=[];for(let l of c){let m=await l.key,w=await l.value;d.push({key:m,value:w,alwaysSet:l.alwaysSet})}return d}).then(d=>L.mergeObjectSync(s,d)):L.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return g.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let r=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:g.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let t={};for(let s of _.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new n({...this._def,shape:()=>t})}omit(e){let t={};for(let s of _.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new n({...this._def,shape:()=>t})}deepPartial(){return we(this)}partial(e){let t={};for(let s of _.objectKeys(this.shape)){let r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}return new n({...this._def,shape:()=>t})}required(e){let t={};for(let s of _.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof $;)i=i._def.innerType;t[s]=i}return new n({...this._def,shape:()=>t})}keyof(){return ut(_.objectKeys(this.shape))}};P.create=(n,e)=>new P({shape:()=>n,unknownKeys:"strip",catchall:U.create(),typeName:v.ZodObject,...b(e)});P.strictCreate=(n,e)=>new P({shape:()=>n,unknownKeys:"strict",catchall:U.create(),typeName:v.ZodObject,...b(e)});P.lazycreate=(n,e)=>new P({shape:n,unknownKeys:"strip",catchall:U.create(),typeName:v.ZodObject,...b(e)});var ce=class extends x{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function r(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new R(a.ctx.common.issues));return h(t,{code:u.invalid_union,unionErrors:o}),y}if(t.common.async)return Promise.all(s.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(r);{let i,o=[];for(let c of s){let d={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:d});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(c=>new R(c));return h(t,{code:u.invalid_union,unionErrors:a}),y}}get options(){return this._def.options}};ce.create=(n,e)=>new ce({options:n,typeName:v.ZodUnion,...b(e)});var Z=n=>n instanceof le?Z(n.schema):n instanceof j?Z(n.innerType()):n instanceof ue?[n.value]:n instanceof pe?n.options:n instanceof he?_.objectValues(n.enum):n instanceof me?Z(n._def.innerType):n instanceof ae?[void 0]:n instanceof oe?[null]:n instanceof $?[void 0,...Z(n.unwrap())]:n instanceof V?[null,...Z(n.unwrap())]:n instanceof Se||n instanceof ge?Z(n.unwrap()):n instanceof fe?Z(n._def.innerType):[],Oe=class n extends x{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.object)return h(t,{code:u.invalid_type,expected:f.object,received:t.parsedType}),y;let s=this.discriminator,r=t.data[s],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:u.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let r=new Map;for(let i of t){let o=Z(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(r.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);r.set(a,i)}}return new n({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...b(s)})}};function Ke(n,e){let t=H(n),s=H(e);if(n===e)return{valid:!0,data:n};if(t===f.object&&s===f.object){let r=_.objectKeys(e),i=_.objectKeys(n).filter(a=>r.indexOf(a)!==-1),o={...n,...e};for(let a of i){let c=Ke(n[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===f.array&&s===f.array){if(n.length!==e.length)return{valid:!1};let r=[];for(let i=0;i<n.length;i++){let o=n[i],a=e[i],c=Ke(o,a);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===f.date&&s===f.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var de=class extends x{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),r=(i,o)=>{if(Pe(i)||Pe(o))return y;let a=Ke(i.value,o.value);return a.valid?(($e(i)||$e(o))&&t.dirty(),{status:t.value,value:a.data}):(h(s,{code:u.invalid_intersection_types}),y)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>r(i,o)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};de.create=(n,e,t)=>new de({left:n,right:e,typeName:v.ZodIntersection,...b(t)});var q=class n extends x{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==f.array)return h(s,{code:u.invalid_type,expected:f.array,received:s.parsedType}),y;if(s.data.length<this._def.items.length)return h(s,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&s.data.length>this._def.items.length&&(h(s,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((o,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new O(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>L.mergeArray(t,o)):L.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};q.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new q({items:n,typeName:v.ZodTuple,rest:null,...b(e)})};var je=class n extends x{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==f.object)return h(s,{code:u.invalid_type,expected:f.object,received:s.parsedType}),y;let r=[],i=this._def.keyType,o=this._def.valueType;for(let a in s.data)r.push({key:i._parse(new O(s,a,s.path,a)),value:o._parse(new O(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?L.mergeObjectAsync(t,r):L.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof x?new n({keyType:e,valueType:t,typeName:v.ZodRecord,...b(s)}):new n({keyType:J.create(),valueType:e,typeName:v.ZodRecord,...b(t)})}},Me=class extends x{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==f.map)return h(s,{code:u.invalid_type,expected:f.map,received:s.parsedType}),y;let r=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([a,c],d)=>({key:r._parse(new O(s,a,s.path,[d,"key"])),value:i._parse(new O(s,c,s.path,[d,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of o){let d=await c.key,l=await c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(d.value,l.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let c of o){let d=c.key,l=c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(d.value,l.value)}return{status:t.value,value:a}}}};Me.create=(n,e,t)=>new Me({valueType:e,keyType:n,typeName:v.ZodMap,...b(t)});var ke=class n extends x{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==f.set)return h(s,{code:u.invalid_type,expected:f.set,received:s.parsedType}),y;let r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(h(s,{code:u.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(h(s,{code:u.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let i=this._def.valueType;function o(c){let d=new Set;for(let l of c){if(l.status==="aborted")return y;l.status==="dirty"&&t.dirty(),d.add(l.value)}return{status:t.value,value:d}}let a=[...s.data.values()].map((c,d)=>i._parse(new O(s,c,s.path,d)));return s.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new n({...this._def,minSize:{value:e,message:g.toString(t)}})}max(e,t){return new n({...this._def,maxSize:{value:e,message:g.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ke.create=(n,e)=>new ke({valueType:n,minSize:null,maxSize:null,typeName:v.ZodSet,...b(e)});var Be=class n extends x{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.function)return h(t,{code:u.invalid_type,expected:f.function,received:t.parsedType}),y;function s(a,c){return Ie({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,be(),W].filter(d=>!!d),issueData:{code:u.invalid_arguments,argumentsError:c}})}function r(a,c){return Ie({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,be(),W].filter(d=>!!d),issueData:{code:u.invalid_return_type,returnTypeError:c}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof ee){let a=this;return A(async function(...c){let d=new R([]),l=await a._def.args.parseAsync(c,i).catch(k=>{throw d.addIssue(s(c,k)),d}),m=await Reflect.apply(o,this,l);return await a._def.returns._def.type.parseAsync(m,i).catch(k=>{throw d.addIssue(r(m,k)),d})})}else{let a=this;return A(function(...c){let d=a._def.args.safeParse(c,i);if(!d.success)throw new R([s(c,d.error)]);let l=Reflect.apply(o,this,d.data),m=a._def.returns.safeParse(l,i);if(!m.success)throw new R([r(l,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:q.create(e).rest(K.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new n({args:e||q.create([]).rest(K.create()),returns:t||K.create(),typeName:v.ZodFunction,...b(s)})}},le=class extends x{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};le.create=(n,e)=>new le({getter:n,typeName:v.ZodLazy,...b(e)});var ue=class extends x{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:u.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:e.data}}get value(){return this._def.value}};ue.create=(n,e)=>new ue({value:n,typeName:v.ZodLiteral,...b(e)});function ut(n,e){return new pe({values:n,typeName:v.ZodEnum,...b(e)})}var pe=class n extends x{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return h(t,{expected:_.joinValues(s),received:t.parsedType,code:u.invalid_type}),y}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return h(t,{received:t.data,code:u.invalid_enum_value,options:s}),y}return A(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,{...this._def,...t})}exclude(e,t=this._def){return n.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};pe.create=ut;var he=class extends x{_parse(e){let t=_.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==f.string&&s.parsedType!==f.number){let r=_.objectValues(t);return h(s,{expected:_.joinValues(r),received:s.parsedType,code:u.invalid_type}),y}if(this._cache||(this._cache=new Set(_.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let r=_.objectValues(t);return h(s,{received:s.data,code:u.invalid_enum_value,options:r}),y}return A(e.data)}get enum(){return this._def.values}};he.create=(n,e)=>new he({values:n,typeName:v.ZodNativeEnum,...b(e)});var ee=class extends x{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.promise&&t.common.async===!1)return h(t,{code:u.invalid_type,expected:f.promise,received:t.parsedType}),y;let s=t.parsedType===f.promise?t.data:Promise.resolve(t.data);return A(s.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}};ee.create=(n,e)=>new ee({type:n,typeName:v.ZodPromise,...b(e)});var j=class extends x{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:o=>{h(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),r.type==="preprocess"){let o=r.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return y;let c=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return c.status==="aborted"?y:c.status==="dirty"?te(c.value):t.value==="dirty"?te(c.value):c});{if(t.value==="aborted")return y;let a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?y:a.status==="dirty"?te(a.value):t.value==="dirty"?te(a.value):a}}if(r.type==="refinement"){let o=a=>{let c=r.refinement(a,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?y:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?y:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(r.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Q(o))return y;let a=r.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>Q(o)?Promise.resolve(r.transform(o.value,i)).then(a=>({status:t.value,value:a})):y);_.assertNever(r)}};j.create=(n,e,t)=>new j({schema:n,typeName:v.ZodEffects,effect:e,...b(t)});j.createWithPreprocess=(n,e,t)=>new j({schema:e,effect:{type:"preprocess",transform:n},typeName:v.ZodEffects,...b(t)});var $=class extends x{_parse(e){return this._getType(e)===f.undefined?A(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};$.create=(n,e)=>new $({innerType:n,typeName:v.ZodOptional,...b(e)});var V=class extends x{_parse(e){return this._getType(e)===f.null?A(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};V.create=(n,e)=>new V({innerType:n,typeName:v.ZodNullable,...b(e)});var me=class extends x{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===f.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};me.create=(n,e)=>new me({innerType:n,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});var fe=class extends x{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return xe(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new R(s.common.issues)},input:s.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new R(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};fe.create=(n,e)=>new fe({innerType:n,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});var Ee=class extends x{_parse(e){if(this._getType(e)!==f.nan){let s=this._getOrReturnCtx(e);return h(s,{code:u.invalid_type,expected:f.nan,received:s.parsedType}),y}return{status:"valid",value:e.data}}};Ee.create=n=>new Ee({typeName:v.ZodNaN,...b(n)});var os=Symbol("zod_brand"),Se=class extends x{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},Le=class n extends x{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?y:i.status==="dirty"?(t.dirty(),te(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?y:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,t){return new n({in:e,out:t,typeName:v.ZodPipeline})}},ge=class extends x{_parse(e){let t=this._def.innerType._parse(e),s=r=>(Q(r)&&(r.value=Object.freeze(r.value)),r);return xe(t)?t.then(r=>s(r)):s(t)}unwrap(){return this._def.innerType}};ge.create=(n,e)=>new ge({innerType:n,typeName:v.ZodReadonly,...b(e)});function ot(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function pt(n,e={},t){return n?X.create().superRefine((s,r)=>{let i=n(s);if(i instanceof Promise)return i.then(o=>{if(!o){let a=ot(e,s),c=a.fatal??t??!0;r.addIssue({code:"custom",...a,fatal:c})}});if(!i){let o=ot(e,s),a=o.fatal??t??!0;r.addIssue({code:"custom",...o,fatal:a})}}):X.create()}var cs={object:P.lazycreate},v;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(v||(v={}));var ds=(n,e={message:`Input not instance of ${n.name}`})=>pt(t=>t instanceof n,e),ht=J.create,mt=se.create,ls=Ee.create,us=re.create,ft=ne.create,ps=ie.create,hs=_e.create,ms=ae.create,fs=oe.create,gs=X.create,ys=K.create,vs=U.create,bs=Ce.create,xs=G.create,ws=P.create,_s=P.strictCreate,Cs=ce.create,Ms=Oe.create,ks=de.create,Es=q.create,Ts=je.create,Is=Me.create,Ss=ke.create,Ls=Be.create,As=le.create,Ds=ue.create,Ns=pe.create,Rs=he.create,Ps=ee.create,$s=j.create,Os=$.create,js=V.create,Bs=j.createWithPreprocess,Us=Le.create,Fs=()=>ht().optional(),zs=()=>mt().optional(),Hs=()=>ft().optional(),qs={string:n=>J.create({...n,coerce:!0}),number:n=>se.create({...n,coerce:!0}),boolean:n=>ne.create({...n,coerce:!0}),bigint:n=>re.create({...n,coerce:!0}),date:n=>ie.create({...n,coerce:!0})};var Vs=y;var gt=p.object({id:p.string().min(1,"ID da mensagem n\xE3o pode ser vazio"),chatId:p.string().min(1,"ID do chat n\xE3o pode ser vazio"),chatName:p.string().min(1,"Nome do chat n\xE3o pode ser vazio"),sender:p.string().min(1,"Remetente n\xE3o pode ser vazio"),text:p.string(),timestamp:p.date(),isOutgoing:p.boolean(),type:p.enum(["text","image","audio","video","document","sticker"],{errorMap:()=>({message:"Tipo de mensagem inv\xE1lido"})})}),Ws=p.object({id:p.string().min(1,"ID do seletor n\xE3o pode ser vazio"),description:p.string().min(1,"Descri\xE7\xE3o do seletor n\xE3o pode ser vazia"),selectors:p.array(p.string().min(1,"Seletor CSS n\xE3o pode ser vazio")).min(1,"Deve haver pelo menos um seletor na cadeia de fallback"),lastVerified:p.date().optional(),status:p.enum(["working","broken","unknown"],{errorMap:()=>({message:"Status do seletor inv\xE1lido"})})}),jr=p.object({version:p.string().min(1,"Vers\xE3o n\xE3o pode ser vazia"),updatedAt:p.string().datetime({message:"updatedAt deve ser uma data ISO 8601 v\xE1lida"}),selectors:p.record(Ws,{errorMap:()=>({message:"Seletores devem ser um objeto v\xE1lido"})})}),yt=p.object({id:p.string().min(1,"ID da mensagem n\xE3o pode ser vazio"),chatId:p.string().min(1,"ID do chat n\xE3o pode ser vazio"),chatName:p.string().min(1,"Nome do chat n\xE3o pode ser vazio"),sender:p.string().min(1,"Remetente n\xE3o pode ser vazio"),text:p.string(),timestamp:p.string().datetime({message:"Timestamp deve ser uma data ISO 8601 v\xE1lida"}),isOutgoing:p.boolean(),type:p.enum(["text","image","audio","video","document","sticker"],{errorMap:()=>({message:"Tipo de mensagem inv\xE1lido"})})});function vt(n){return{...n,timestamp:n.timestamp.toISOString()}}function Ae(n){return{...n,timestamp:new Date(n.timestamp)}}var Br=p.object({id:p.string().min(1,"ID da sess\xE3o n\xE3o pode ser vazio"),startedAt:p.string().datetime({message:"startedAt deve ser uma data ISO 8601 v\xE1lida"}),trigger:p.enum(["manual","auto","scheduled"],{errorMap:()=>({message:"Trigger inv\xE1lido"})}),status:p.enum(["active","validating","completed","failed"],{errorMap:()=>({message:"Status da sess\xE3o inv\xE1lido"})}),progress:p.number().min(0).max(100,"Progresso deve estar entre 0 e 100"),targets:p.array(p.object({selectorId:p.string().min(1,"ID do seletor n\xE3o pode ser vazio"),element:p.any().nullable(),coordinates:p.object({x:p.number(),y:p.number()}).optional(),attempts:p.number().int().min(0,"Tentativas deve ser um n\xFAmero inteiro n\xE3o negativo"),status:p.enum(["pending","validating","success","failed"],{errorMap:()=>({message:"Status do target inv\xE1lido"})})})),results:p.array(p.object({selectorId:p.string().min(1,"ID do seletor n\xE3o pode ser vazio"),newSelector:p.string().min(1,"Novo seletor n\xE3o pode ser vazio"),validated:p.boolean(),validatedAt:p.string().datetime({message:"validatedAt deve ser uma data ISO 8601 v\xE1lida"}).optional()}))}),Ur=p.object({sessionId:p.string().min(1,"ID da sess\xE3o n\xE3o pode ser vazio"),selectorId:p.string().min(1,"ID do seletor n\xE3o pode ser vazio"),oldSelector:p.string().min(1,"Seletor antigo n\xE3o pode ser vazio"),newSelector:p.string().min(1,"Novo seletor n\xE3o pode ser vazio"),validated:p.boolean(),validatedAt:p.string().datetime({message:"validatedAt deve ser uma data ISO 8601 v\xE1lida"}),updatedRemote:p.boolean(),updatedAt:p.string().datetime({message:"updatedAt deve ser uma data ISO 8601 v\xE1lida"}).optional()});var bt="mettri-db",Zs=1,T="messages",Ks=90,Gs=1e4,Ys=2e3,Ge=class{db=null;initPromise=null;currentUserWid=null;pruneTimer=null;pruneInFlight=null;constructor(){this.initPromise=this.init()}sanitizeWidForDB(e){return e.replace(/[@.]/g,"_").replace(/[^a-zA-Z0-9_]/g,"")}getDBName(){if(this.currentUserWid){let e=this.sanitizeWidForDB(this.currentUserWid);return`${bt}-${e}`}return bt}async setUserWid(e){this.currentUserWid!==e&&(this.db&&(this.db.close(),this.db=null),this.currentUserWid=e,this.initPromise=null,await this.init(),console.log(`[MessageDB] Banco aberto para usu\xE1rio: ${e} (${this.getDBName()})`),this.schedulePrune())}getCurrentUserWid(){return this.currentUserWid}async init(){if(!(this.db&&this.db.name===this.getDBName()))return new Promise((e,t)=>{let s=this.getDBName(),r=indexedDB.open(s,Zs);r.onerror=()=>{console.error("Mettri: Failed to open database"),t(r.error)},r.onsuccess=()=>{this.db=r.result,console.log("Mettri: Database opened successfully"),e()},r.onupgradeneeded=i=>{let o=i.target.result;if(!o.objectStoreNames.contains(T)){let a=o.createObjectStore(T,{keyPath:"id"});a.createIndex("chatId","chatId",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("chatId_timestamp",["chatId","timestamp"],{unique:!1})}}})}async ensureReady(){if(this.initPromise&&await this.initPromise,!this.db)throw new Error("Database not initialized");return this.db}validateMessage(e){try{return gt.parse(e)}catch(t){throw t instanceof p.ZodError?(console.error("Mettri: Falha ao validar mensagem:",t.errors),new Error(`Falha ao validar mensagem: ${t.message}`)):t}}validateDBEntry(e){try{return yt.parse(e)}catch(t){throw t instanceof p.ZodError?(console.error("Mettri: Dados corrompidos no IndexedDB:",t.errors),new Error(`Falha ao validar mensagem do banco: ${t.message}`)):t}}async saveMessage(e){let t=this.validateMessage(e),s=vt(t),r=this.validateDBEntry(s),i=await this.ensureReady();return new Promise((o,a)=>{let l=i.transaction([T],"readwrite").objectStore(T).put(r);l.onerror=()=>a(l.error),l.onsuccess=()=>{this.schedulePrune(),o()}})}schedulePrune(){this.pruneTimer!=null&&clearTimeout(this.pruneTimer),this.pruneTimer=setTimeout(()=>{this.pruneTimer=null,this.pruneIfNeeded().catch(e=>{console.warn("[MessageDB] Falha na rotina de reten\xE7\xE3o:",e)})},Ys)}async pruneIfNeeded(){if(this.pruneInFlight)return this.pruneInFlight;this.pruneInFlight=(async()=>{await this.ensureReady();let e=new Date(Date.now()-Ks*24*60*60*1e3);await this.deleteOlderThan(e.toISOString()),await this.enforceMaxMessages(Gs)})();try{await this.pruneInFlight}finally{this.pruneInFlight=null}}async deleteOlderThan(e){let t=await this.ensureReady();return new Promise((s,r)=>{let a=t.transaction([T],"readwrite").objectStore(T).index("timestamp"),c=IDBKeyRange.upperBound(e,!0),d=a.openCursor(c,"next"),l=0;d.onerror=()=>r(d.error),d.onsuccess=()=>{let m=d.result;if(!m){s(l);return}let w=m.delete();w.onerror=()=>{m.continue()},w.onsuccess=()=>{l++,m.continue()}}})}async enforceMaxMessages(e){let t=await this.getMessageCount();if(t<=e)return 0;let s=await this.ensureReady(),r=t-e;return new Promise((i,o)=>{let l=s.transaction([T],"readwrite").objectStore(T).index("timestamp").openCursor(null,"next"),m=0;l.onerror=()=>o(l.error),l.onsuccess=()=>{let w=l.result;if(!w||m>=r){i(m);return}let k=w.delete();k.onerror=()=>{w.continue()},k.onsuccess=()=>{m++,w.continue()}}})}async getMessages(e,t=100){let s=await this.ensureReady();return new Promise((r,i)=>{let a=s.transaction([T],"readonly").objectStore(T),c;e?c=a.index("chatId").getAll(e,t):c=a.getAll(null,t),c.onerror=()=>i(c.error),c.onsuccess=()=>{let d=c.result.map(l=>{try{let m=this.validateDBEntry(l);return Ae(m)}catch(m){return console.error("Mettri: Erro ao processar mensagem do banco:",m),null}}).filter(l=>l!==null);d.sort((l,m)=>m.timestamp.getTime()-l.timestamp.getTime()),r(d)}})}async getMessagesByDateRange(e,t,s){let r=await this.ensureReady();return new Promise((i,o)=>{let d=r.transaction([T],"readonly").objectStore(T).index("timestamp"),l=IDBKeyRange.bound(e.toISOString(),t.toISOString()),m=d.getAll(l);m.onerror=()=>o(m.error),m.onsuccess=()=>{let w=m.result.map(k=>{try{let S=this.validateDBEntry(k);return Ae(S)}catch(S){return console.error("Mettri: Erro ao processar mensagem do banco:",S),null}}).filter(k=>k!==null);s&&(w=w.filter(k=>k.chatId===s)),i(w)}})}async deleteMessage(e){let t=await this.ensureReady();return new Promise((s,r)=>{let a=t.transaction([T],"readwrite").objectStore(T).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>s()})}async clearAllMessages(){let e=await this.ensureReady();return new Promise((t,s)=>{let o=e.transaction([T],"readwrite").objectStore(T).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async getMessageCount(){let e=await this.ensureReady();return new Promise((t,s)=>{let o=e.transaction([T],"readonly").objectStore(T).count();o.onerror=()=>s(o.error),o.onsuccess=()=>t(o.result)})}async exportMessages(){return this.getMessages(void 0,1e4)}async groupMessagesByContact(){let e=await this.ensureReady(),t=new Map;return new Promise((s,r)=>{let c=e.transaction([T],"readonly").objectStore(T).index("timestamp").openCursor(null,"prev");c.onerror=()=>r(c.error),c.onsuccess=()=>{let d=c.result;if(!d){s(t);return}let l=d.value;try{let m=this.validateDBEntry(l),w=Ae(m),k=t.get(w.chatId);k?k.messageCount++:t.set(w.chatId,{chatId:w.chatId,chatName:w.chatName,messageCount:1,lastMessage:w,lastMessageTime:w.timestamp})}catch(m){console.error("Mettri: Erro ao processar mensagem no agrupamento:",m)}d.continue()}})}async getLastIncomingByContact(){let e=await this.ensureReady(),t=new Map;return new Promise((s,r)=>{let c=e.transaction([T],"readonly").objectStore(T).index("timestamp").openCursor(null,"prev");c.onerror=()=>r(c.error),c.onsuccess=()=>{let d=c.result;if(!d){s(t);return}let l=d.value;try{let m=this.validateDBEntry(l),w=Ae(m);if(w.isOutgoing===!0){d.continue();return}if(!w.chatId||!w.chatId.endsWith("@c.us")){d.continue();return}t.has(w.chatId)||t.set(w.chatId,{chatId:w.chatId,chatName:w.chatName,lastIncomingAt:w.timestamp})}catch(m){console.error("[MessageDB] Erro ao calcular lastIncoming por contato:",m)}d.continue()}})}async getContactMessages(e,t=1e3){return this.getMessages(e,t)}},xt=new Ge;var wt="mettri-clients-db",Qs=2,D="clients",De=p.object({clientKey:p.string().min(1,"clientKey n\xE3o pode ser vazio"),phoneDigits:p.string().optional(),aliasesDigits:p.array(p.string()).optional(),whatsAppChatId:p.string().optional(),fullName:p.string().optional(),firstName:p.string().optional(),lastName:p.string().optional(),nickname:p.string().optional(),addressFreeform:p.string().optional(),address:p.string().optional(),phones:p.array(p.object({raw:p.string().min(1),digits:p.string().optional(),e164:p.string().optional(),label:p.string().optional()})).optional(),emails:p.array(p.string()).optional(),sourceMeta:p.object({filename:p.string().optional(),importedAtIso:p.string().datetime().optional(),profileId:p.string().optional()}).optional(),confidence:p.record(p.number().min(0).max(1)).optional(),nameSource:p.enum(["manual","import","whatsapp"]).optional(),whatsAppCandidateName:p.string().optional(),updatedAtIso:p.string().datetime({message:"updatedAtIso deve ser ISO 8601"})}).passthrough();function Js(n){return n.replace(/[@.]/g,"_").replace(/[^a-zA-Z0-9_]/g,"")}function F(n){return String(n||"").replace(/\D+/g,"")}function _t(n){let e=F(n),t=new Set;e&&t.add(e),(o=>{let a=F(o);if(a){if(t.add(a),a.startsWith("55")&&a.length>=12&&a.length<=13){let c="55",d=a.slice(2,4),l=a.slice(4);t.add(`${d}${l}`),l.length===9&&l.startsWith("9")&&(t.add(`${c}${d}${l.slice(1)}`),t.add(`${d}${l.slice(1)}`)),l.length===8&&(t.add(`${c}${d}9${l}`),t.add(`${d}9${l}`));return}if(!a.startsWith("55")&&(a.length===10||a.length===11)){let c=a.slice(0,2),d=a.slice(2);t.add(`55${a}`),d.length===9&&d.startsWith("9")&&(t.add(`${c}${d.slice(1)}`),t.add(`55${c}${d.slice(1)}`)),d.length===8&&(t.add(`${c}9${d}`),t.add(`55${c}9${d}`))}}})(e);let r=Array.from(t),i=r.sort((o,a)=>a.length-o.length)[0]||e||`draft-${Date.now()}`;return{phoneDigits:e,aliasesDigits:r,clientKey:i}}var Ye=class{db=null;initPromise=null;currentUserWid=null;constructor(){this.initPromise=this.init()}getDBName(){return this.currentUserWid?`${wt}-${Js(this.currentUserWid)}`:wt}async setUserWid(e){this.currentUserWid!==e&&(this.db&&(this.db.close(),this.db=null),this.currentUserWid=e,this.initPromise=null,await this.init(),console.log(`[ClientDB] Banco aberto para usu\xE1rio: ${e} (${this.getDBName()})`))}getCurrentUserWid(){return this.currentUserWid}async init(){if(!(this.db&&this.db.name===this.getDBName()))return this.initPromise=this.initPromise??new Promise((e,t)=>{let s=indexedDB.open(this.getDBName(),Qs);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{let i=r.target.result,o;i.objectStoreNames.contains(D)?o=s.transaction.objectStore(D):o=i.createObjectStore(D,{keyPath:"clientKey"}),o.indexNames.contains("phoneDigits")||o.createIndex("phoneDigits","phoneDigits",{unique:!1}),o.indexNames.contains("updatedAtIso")||o.createIndex("updatedAtIso","updatedAtIso",{unique:!1}),o.indexNames.contains("whatsAppChatId")||o.createIndex("whatsAppChatId","whatsAppChatId",{unique:!1})}}),await this.initPromise}async ensureReady(){if(this.initPromise&&await this.initPromise,!this.db)throw new Error("ClientDB: Database not initialized");return this.db}validate(e){return De.parse(e)}async upsert(e){let t=this.validate(e),s=await this.ensureReady();return await new Promise((r,i)=>{let c=s.transaction([D],"readwrite").objectStore(D).put(t);c.onerror=()=>i(c.error),c.onsuccess=()=>r()})}async getByKey(e){let t=await this.ensureReady();return await new Promise((s,r)=>{let a=t.transaction([D],"readonly").objectStore(D).get(e);a.onerror=()=>r(a.error),a.onsuccess=()=>{let c=a.result;if(!c)return s(null);try{s(De.parse(c))}catch(d){r(d)}}})}async getByPhoneDigits(e){let t=F(e);if(!t)return null;let s=await this.ensureReady();return await new Promise((r,i)=>{let d=s.transaction([D],"readonly").objectStore(D).index("phoneDigits").openCursor(IDBKeyRange.only(t),"next");d.onerror=()=>i(d.error),d.onsuccess=()=>{let l=d.result;if(!l)return r(null);try{r(De.parse(l.value))}catch(m){i(m)}}})}async listAll(e=5e3){let t=await this.ensureReady();return await new Promise((s,r)=>{let i=[],c=t.transaction([D],"readonly").objectStore(D).openCursor();c.onerror=()=>r(c.error),c.onsuccess=()=>{let d=c.result;if(!d)return s(i);try{i.push(De.parse(d.value))}catch{}if(i.length>=e)return s(i);d.continue()}})}async reset(){let e=await this.ensureReady();return await new Promise((t,s)=>{let o=e.transaction([D],"readwrite").objectStore(D).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async getByWhatsAppChatId(e){let t=String(e||"").trim();if(!t)return null;let s=await this.ensureReady();return await new Promise((r,i)=>{let a=s.transaction([D],"readonly").objectStore(D);if(!a.indexNames.contains("whatsAppChatId"))return r(null);let d=a.index("whatsAppChatId").openCursor(IDBKeyRange.only(t),"next");d.onerror=()=>i(d.error),d.onsuccess=()=>{let l=d.result;if(!l)return r(null);try{r(De.parse(l.value))}catch(m){i(m)}}})}},Qe=new Ye;function Ct(n){return Math.floor(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())/864e5)}function Mt(n,e){return Ct(n)-Ct(e)}function Xs(n,e,t){return Math.max(e,Math.min(t,n))}function Je(n,e){let t=n.match(e);return t?t.length:0}function Tt(n){return String(n||"").replace(/[_]+/g," ").replace(/\s+/g," ").trim()}function It(n){return n.split(/\s+/).filter(Boolean).some(t=>/\d/.test(t))}function kt(n,e){if(e?.isBusiness===!0||e?.verifiedName&&String(e.verifiedName).trim().length>0)return!0;let t=n.toLowerCase();return!!(/\b(ltda|mei|epp|me)\b/.test(t)||/\b(consultoria|contabilidade|advocacia|imobili(a|)ria|cl(i|)nica|studio|est(|u)dio)\b/.test(t)||/\b(casa\s+de|loja|delivery|restaurante|pizzaria|hamburgueria|farm(a|)cia|padaria|a(|c)ougue|mercado|oficina|barbearia|sal(a|)o)\b/.test(t)||/[&/|]/.test(n))}function Et(n){let e=n.trim();return e?e.toUpperCase()===e&&e.toLowerCase()!==e&&e.length<=4?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():""}function er(n){let e=/^[\p{L}]+(?:['\-][\p{L}]+)*$/u,t=new Set(["da","de","do","das","dos","e"]),r=n.split(/\s+/).map(l=>l.trim()).filter(Boolean).filter(l=>e.test(l)||t.has(l.toLowerCase())),i=r.findIndex(l=>!t.has(l.toLowerCase()));if(i<0)return null;let o=Et(r[i]);if(!o)return null;let a=r.slice(i+1),c=[];for(let l of a){let m=l.toLowerCase();if(t.has(m)){c.length>0&&c.push(m);continue}c.push(Et(l))}let d=c.join(" ").trim();return d?{firstName:o,lastName:d}:{firstName:o}}function tr(n){let e=Tt(n),t={hasLink:/https?:\/\/|www\.|\.com\b|\.net\b|\.br\b/i.test(e),hasAt:/@/.test(e),endsWithDigit:/\d$/.test(e),tooShort:e.length>0&&e.length<2,tooLong:e.length>40,tooFewLetters:!1,tooManyDigits:!1,tooManySymbols:!1},s=Je(e,new RegExp("\\p{L}","gu")),r=Je(e,/\d/g),i=Je(e,/\s/g),o=e.length,a=o-s-r-i;if(t.tooFewLetters=s>0?s<2:!0,t.tooManyDigits=o>0?r/o>=.4:!1,t.tooManySymbols=o>0?a/o>=.35:!1,!e)return{cleaned:"",score:0,flags:t};let c=55;t.hasLink&&(c-=60),t.hasAt&&(c-=45),t.tooShort&&(c-=40),t.tooLong&&(c-=20),t.tooFewLetters&&(c-=50),t.endsWithDigit&&(c-=35),It(e)&&(c-=35),t.tooManyDigits&&(c-=25),t.tooManySymbols&&(c-=25);let d=e.split(" ").filter(Boolean);return d.length>=1&&d.length<=4&&(c+=10),d.length>5&&(c-=20),s>=4&&(c+=10),c=Xs(c,0,100),{cleaned:e,score:c,flags:t}}function Xe(n,e){let t=Tt(n);if(!t)return{kind:"noise",cleaned:"",reason:"empty",personScore:0};let s=tr(t),r=s.score;if(s.flags.hasLink)return{kind:"noise",cleaned:t,reason:"hasLink",personScore:r};if(s.flags.hasAt)return{kind:"noise",cleaned:t,reason:"hasAt",personScore:r};if(s.flags.tooFewLetters)return{kind:"noise",cleaned:t,reason:"tooFewLetters",personScore:r};if(s.flags.tooManySymbols)return{kind:"noise",cleaned:t,reason:"tooManySymbols",personScore:r};if(It(t)&&!kt(t,e))return{kind:"noise",cleaned:t,reason:"digitInsideWord",personScore:r};if(kt(t,e))return{kind:"business",cleaned:t,nickname:t,reason:"business",personScore:r};let i=er(t);return i&&r>=55?{kind:"person",cleaned:t,firstName:i.firstName,lastName:i.lastName,personScore:r}:r<55?{kind:"noise",cleaned:t,reason:"lowConfidence",personScore:r}:{kind:"noise",cleaned:t,reason:"fallbackNoise",personScore:r}}function sr(n){if(!n||typeof n!="object")return!1;let e=n;return e.__mettriBridge===!0&&e.direction==="response"&&typeof e.requestId=="string"&&typeof e.ok=="boolean"}function rr(){return`mettri-${Date.now()}-${Math.random().toString(36).slice(2)}`}var Te=class{constructor(e=2e3){this.timeoutMs=e}request(e,t){let s=rr(),r={__mettriBridge:!0,direction:"request",requestId:s,action:e,payload:t};return new Promise((i,o)=>{let a=d=>{if(d.source===window&&sr(d.data)&&d.data.requestId===s){if(window.removeEventListener("message",a),clearTimeout(c),!d.data.ok){o(new Error(d.data.error||"Bridge error"));return}i(d.data.result)}},c=window.setTimeout(()=>{window.removeEventListener("message",a),o(new Error(`Bridge timeout (${this.timeoutMs}ms) for ${e}`))},this.timeoutMs);window.addEventListener("message",a),window.postMessage(r,"*")})}async ping(){return await this.request("ping")}async storageGet(e){return await this.request("storage.get",{keys:e})}async storageSet(e){await this.request("storage.set",{items:e})}async storageRemove(e){await this.request("storage.remove",{keys:e})}async downloadsDownload(e){return await this.request("downloads.download",e)}async netFetch(e){return await this.request("net.fetch",e)}};var et=class{initialized=!1;async initialize(){if(!this.initialized)return new Promise(e=>{let t=Date.now(),s=()=>{let r=window.Mettri,i=!!r&&(r.__ready===!0||!!r.Chat||!!r.Msg),o=Date.now()-t>6e4;i||o?(this.initialized=!0,e()):setTimeout(s,100)};s()})}isWebpackAvailable(){return window.Mettri?.isWebpackAvailable()??!1}get Msg(){return window.Mettri?.Msg}get Chat(){return window.Mettri?.Chat}get Contact(){return window.Mettri?.Contact}get Label(){return window.Mettri?.Label}get ChatCollection(){return window.Mettri?.ChatCollection}get ConversationMsgs(){return window.Mettri?.ConversationMsgs}get PresenceCollection(){return window.Mettri?.PresenceCollection}get GroupMetadata(){return window.Mettri?.GroupMetadata}get User(){return window.Mettri?.User}get Conn(){return window.Mettri?.Conn}get MsgKey(){return window.Mettri?.MsgKey}get SendDelete(){return window.Mettri?.SendDelete}get addAndSendMsgToChat(){return window.Mettri?.addAndSendMsgToChat}get sendTextMsgToChat(){return window.Mettri?.sendTextMsgToChat}get getEphemeralFields(){return window.Mettri?.getEphemeralFields}get canReplyMsg(){return window.Mettri?.canReplyMsg}get Cmd(){return window.Mettri?.Cmd}get ChatState(){return window.Mettri?.ChatState}get Presence(){return window.Mettri?.Presence}get createGroup(){return window.Mettri?.createGroup}get getParticipants(){return window.Mettri?.getParticipants}get blockContact(){return window.Mettri?.blockContact}get VCard(){return window.Mettri?.VCard}get QueryExist(){return window.Mettri?.QueryExist}get uploadMedia(){return window.Mettri?.uploadMedia}get MediaPrep(){return window.Mettri?.MediaPrep}get MediaObject(){return window.Mettri?.MediaObject}get MediaTypes(){return window.Mettri?.MediaTypes}get MediaCollection(){return window.Mettri?.MediaCollection}get UploadUtils(){return window.Mettri?.UploadUtils}get DownloadManager(){return window.Mettri?.DownloadManager}get OpaqueData(){return window.Mettri?.OpaqueData}get UserConstructor(){return window.Mettri?.UserConstructor}get USyncQuery(){return window.Mettri?.USyncQuery}get USyncUser(){return window.Mettri?.USyncUser}get genMinimalLinkPreview(){return window.Mettri?.genMinimalLinkPreview}get findFirstWebLink(){return window.Mettri?.findFirstWebLink}get getSearchContext(){return window.Mettri?.getSearchContext}get sendReactionToMsg(){return window.Mettri?.sendReactionToMsg}get colorIndexToHex(){return window.Mettri?.colorIndexToHex}get StatusUtils(){return window.Mettri?.StatusUtils}get Composing(){return window.Mettri?.Composing}get ConversationSeen(){return window.Mettri?.ConversationSeen}get Playing(){return window.Mettri?.Playing}get StatusState(){return window.Mettri?.StatusState}get Classes(){return window.Mettri?.Classes}get WidFactory(){return window.Mettri?.WidFactory}async testModule(e){try{return this[e]?"success":"error"}catch{return"error"}}handleResponse(e){}},tt=new et;function nr(n){return n.includes("@c.us")?F(n):F(n)}function ir(n,e){let t=`${n}@c.us`,s=`55${n}@c.us`,r=null;if(e){let i=e.match(/^(\d{2})(\d+)/);if(i){let o=i[1];n.startsWith(o)||(r=`${o}${n}@c.us`)}}return[t,s,r].filter(Boolean)}var st=class{async sendText(e,t){try{if(!e||!t)throw new Error(`Par\xE2metros inv\xE1lidos: chatIdOrPhone=${e}, text=${t}`);await tt.initialize();let s=tt,r=s.Chat,i=s.Cmd,o=s.User,a=s.MsgKey,c=s.WidFactory,d=s.getEphemeralFields,l=s.addAndSendMsgToChat,m=s.sendTextMsgToChat;if(!r)throw new Error("M\xF3dulo Chat n\xE3o encontrado");let w=nr(e);if(!w)throw new Error(`N\xFAmero inv\xE1lido: ${e}`);let k=null,S=null;if(o)try{typeof o=="function"?S=o():typeof o.getMaybeMePnUser=="function"?S=o.getMaybeMePnUser():typeof o.getMaybeMeLidUser=="function"&&(S=o.getMaybeMeLidUser()),S&&(k=S.id?._serialized??S._serialized??(S.user?`${S.user}@${S.server||"c.us"}`:null))}catch{}if(!S)throw new Error("N\xE3o foi poss\xEDvel obter usu\xE1rio atual (User)");let ye=ir(w,k),Lt=k&&ye.some(M=>{let C=M.replace("@c.us",""),I=k.replace("@c.us","").replace("@lid","");return C===I||C.endsWith(I)||I.endsWith(C)}),E=null,B=r;if(i?.openChatAt&&typeof B.get=="function")for(let M of ye)try{let C=B.get(M);if(C){i.openChatAt(C),await new Promise(I=>setTimeout(I,500));break}}catch{}if(Lt&&typeof B.getActive=="function")try{let M=B.getActive();if(M&&M.id){let C=M.id._serialized||(typeof M.id=="string"?M.id:M.id.toString());ye.some(Y=>{let N=Y.replace("@c.us",""),ve=C.replace("@c.us","").replace("@lid","");return N===ve||N.endsWith(ve)||ve.endsWith(N)})&&(E=M)}}catch{}if(!E&&typeof B.get=="function")for(let M of ye)try{let C=B.get(M);if(C){E=C;break}}catch{}if(!E&&typeof B.find=="function")for(let M of ye)try{let C=M;if(c)try{typeof c=="function"?C=c(M):typeof c.createWid=="function"&&(C=c.createWid(M)),(!C||typeof C=="string"&&C===M)&&(C=M)}catch{C=M}let I=await Promise.resolve(B.find(C)).catch(()=>null);if(I){E=I;break}}catch{}if(!E&&c&&i?.openChatAt)for(let M of ye)try{let C=null;if(typeof c=="function"?C=c(M):typeof c.createWid=="function"&&(C=c.createWid(M)),C&&C.user)try{let I={id:C};if(i.openChatAt(I),await new Promise(Y=>setTimeout(Y,2e3)),E=B.get(M),!E&&typeof B.find=="function"&&(E=await Promise.resolve(B.find(C)).catch(()=>null)),E)break}catch{}}catch{}if(!E)throw new Error(`Chat n\xE3o encontrado para ${w}. O chat precisa existir no WhatsApp (ter pelo menos uma mensagem trocada) ou estar na lista de conversas. Tente:
1. Abrir a conversa manualmente no WhatsApp primeiro
2. Enviar uma mensagem manualmente para criar o chat
3. Verificar se o n\xFAmero est\xE1 correto (formato: 11999999999 sem espa\xE7os ou caracteres especiais)`);if(!(E.id&&(typeof E.id.isGroup=="function"||typeof E.id.isLid=="function")&&E.id.user))throw new Error("Chat obtido n\xE3o tem estrutura v\xE1lida. O chat precisa ser um objeto completo do WhatsApp, n\xE3o um objeto m\xEDnimo. Tente abrir a conversa manualmente no WhatsApp primeiro.");if(l&&typeof l=="function"){if(!a?.newId||typeof a.newId!="function")throw new Error("MsgKey.newId() n\xE3o dispon\xEDvel");let M=await Promise.resolve(a.newId()),C=E.id&&typeof E.id.isGroup=="function"?E.id.isGroup():!1,I={from:S,to:E.id,id:M,participant:C?S:void 0,selfDir:"out"},Y=null,N=null;if(typeof a=="function"&&a.prototype)N=a;else if(a?.default&&typeof a.default=="function"&&a.default.prototype)N=a.default;else if(a?.constructor&&typeof a.constructor=="function"&&a.constructor!==Object)N=a.constructor;else if(window.N?.MsgKey){let z=window.N.MsgKey;typeof z=="function"&&z.prototype?N=z:z?.default&&typeof z.default=="function"&&(N=z.default)}if(!N&&s.N?.MsgKey){let z=s.N.MsgKey;typeof z=="function"&&z.prototype&&(N=z)}if(N&&typeof N=="function")try{Y=new N(I)}catch{Y=I}else Y=I;let ve={};if(d&&typeof d=="function")try{ve=await Promise.resolve(d(E))||{}}catch{}let Ne={id:Y,ack:0,body:t,from:S,to:E.id,local:!0,self:"out",t:Math.floor(Date.now()/1e3),isNewMsg:!0,type:"chat",...ve};Ne.type=Ne.type||Ne.__x_type||"chat";let Re=await Promise.resolve(l(E,Ne)),He=null,qe=null;Array.isArray(Re)?(He=Re[0],qe=Re[1]):He=Re,await Promise.resolve(He),qe&&await Promise.resolve(qe);return}if(m&&typeof m=="function")try{await Promise.resolve(m(E,t));return}catch(M){let C=M?.message||"Erro desconhecido",I=M?.stack||"";throw C.includes("isLid")||I.includes("isLid")?new Error("ID do chat n\xE3o \xE9 objeto WID v\xE1lido. O chat.id precisa ser um objeto WID (com m\xE9todos como isLid), n\xE3o uma string. Tente abrir a conversa no WhatsApp primeiro para garantir que o chat est\xE1 carregado."):C.includes("toLogString")||I.includes("toLogString")?new Error("Erro interno do WhatsApp: objeto n\xE3o inicializado. O chat pode n\xE3o estar totalmente carregado. Tente abrir a conversa no WhatsApp primeiro."):new Error(`Falha no fallback sendTextMsgToChat: ${C}`)}throw new Error("Nenhum m\xE9todo de envio dispon\xEDvel (addAndSendMsgToChat ou sendTextMsgToChat).")}catch(s){throw s}}},rt=new st;var Ue=class{hourlyCounts=new Map;dailyCount=0;dailyCountDate=this.getDateKey(new Date);totalSentSinceCreation=0;getDateKey(e){let t=new Date(e);return t.setHours(0,0,0,0),t.getTime()}getHourKey(e){let t=new Date(e);return t.setMinutes(0,0,0),t.getTime()}maybeResetDaily(){let e=new Date,t=this.getDateKey(e);t!==this.dailyCountDate&&(this.dailyCount=0,this.dailyCountDate=t,this.hourlyCounts.clear())}cleanupOldHours(){let e=new Date,t=this.getHourKey(e);for(let s of this.hourlyCounts.keys())s<t&&this.hourlyCounts.delete(s)}canSend(){this.maybeResetDaily(),this.cleanupOldHours();let e=new Date,t=this.getHourKey(e),s=this.hourlyCounts.get(t)??0;if(this.dailyCount>=200){let i=new Date(e);return i.setDate(i.getDate()+1),i.setHours(0,0,0,0),{allowed:!1,reason:"limite di\xE1rio",waitMs:i.getTime()-e.getTime()}}if(s>=50){let i=new Date(t);return i.setHours(i.getHours()+1),{allowed:!1,reason:"limite por hora",waitMs:i.getTime()-e.getTime()}}return{allowed:!0}}recordSent(){this.maybeResetDaily();let e=new Date,t=this.getHourKey(e),s=this.hourlyCounts.get(t)??0;this.hourlyCounts.set(t,s+1),this.dailyCount+=1,this.totalSentSinceCreation+=1}getDelay(){return Math.floor(Math.random()*9001)+2e3}shouldRandomPause(){if(this.totalSentSinceCreation===0||this.totalSentSinceCreation%10!==0)return!1;let e=.1+Math.random()*(.3-.1);return Math.random()<e}resetDailyCounters(){this.dailyCount=0,this.dailyCountDate=this.getDateKey(new Date),this.hourlyCounts.clear()}getStats(){this.maybeResetDaily(),this.cleanupOldHours();let e=new Date,t=this.getHourKey(e),s=this.hourlyCounts.get(t)??0;return{sentToday:this.dailyCount,sentThisHour:s}}};var Fe=class{bridge;lists=[];members={};storageKeyLists;storageKeyMembers;constructor(e){this.bridge=new Te(2500),this.storageKeyLists=`retomarLists_${e}`,this.storageKeyMembers=`retomarListMembers_${e}`}async initialize(){await this.loadLists(),await this.loadMembers();let e=this.lists.some(s=>s.id==="never-send"),t=this.lists.some(s=>s.id==="exclusivos");e||await this.createDefaultList("never-send","Nunca enviar","--tag-color-6"),t||await this.createDefaultList("exclusivos","Exclusivos","--tag-color-2")}async createDefaultList(e,t,s){let r={id:e,name:t,type:"default",color:s,isDefault:!0,memberCount:0,createdAt:Date.now(),updatedAt:Date.now()};this.lists.push(r),this.members[e]=[],await this.saveLists(),await this.saveMembers()}async loadLists(){try{let t=(await this.bridge.storageGet([this.storageKeyLists]))[this.storageKeyLists];Array.isArray(t)&&(this.lists=t)}catch(e){console.error("[RETOMAR LISTS] Erro ao carregar listas:",e),this.lists=[]}}async loadMembers(){try{let t=(await this.bridge.storageGet([this.storageKeyMembers]))[this.storageKeyMembers];t&&typeof t=="object"&&(this.members=t)}catch(e){console.error("[RETOMAR LISTS] Erro ao carregar membros:",e),this.members={}}}async saveLists(){try{await this.bridge.storageSet({[this.storageKeyLists]:this.lists})}catch(e){console.error("[RETOMAR LISTS] Erro ao salvar listas:",e)}}async saveMembers(){try{await this.bridge.storageSet({[this.storageKeyMembers]:this.members})}catch(e){console.error("[RETOMAR LISTS] Erro ao salvar membros:",e)}}getLists(){return[...this.lists]}async createList(e,t){if(!e.trim())throw new Error("Nome da lista n\xE3o pode estar vazio");if(!["--tag-color-1","--tag-color-2","--tag-color-3","--tag-color-4","--tag-color-5","--tag-color-6","--tag-color-7","--tag-color-8"].includes(t))throw new Error("Cor inv\xE1lida");let r=`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:r,name:e.trim(),type:"custom",color:t,isDefault:!1,memberCount:0,createdAt:Date.now(),updatedAt:Date.now()};return this.lists.push(i),this.members[r]=[],await this.saveLists(),await this.saveMembers(),i}async deleteList(e){let t=this.lists.find(s=>s.id===e);if(!t)throw new Error("Lista n\xE3o encontrada");if(t.isDefault)throw new Error("Listas padr\xE3o n\xE3o podem ser exclu\xEDdas");this.lists=this.lists.filter(s=>s.id!==e),delete this.members[e],await this.saveLists(),await this.saveMembers()}async renameList(e,t){if(!t.trim())throw new Error("Nome da lista n\xE3o pode estar vazio");let s=this.lists.find(r=>r.id===e);if(!s)throw new Error("Lista n\xE3o encontrada");if(s.isDefault)throw new Error("Listas padr\xE3o n\xE3o podem ser renomeadas");s.name=t.trim(),s.updatedAt=Date.now(),await this.saveLists()}async addMember(e,t){let s=this.lists.find(r=>r.id===e);if(!s)throw new Error("Lista n\xE3o encontrada");this.members[e]||(this.members[e]=[]),this.members[e].includes(t)||(this.members[e].push(t),s.memberCount=this.members[e].length,s.updatedAt=Date.now(),await this.saveLists(),await this.saveMembers())}async removeMember(e,t){let s=this.lists.find(r=>r.id===e);if(!s)throw new Error("Lista n\xE3o encontrada");this.members[e]&&(this.members[e]=this.members[e].filter(r=>r!==t),s.memberCount=this.members[e].length,s.updatedAt=Date.now(),await this.saveLists(),await this.saveMembers())}isInList(e,t){return t?this.members[t]?.includes(e)??!1:Object.values(this.members).some(s=>s.includes(e))}getListsForClient(e){let t=[];for(let[s,r]of Object.entries(this.members))r.includes(e)&&t.push(s);return t}getMembers(e){return[...this.members[e]||[]]}};var ze=class{container=null;cadenceDays=[21,35,56,84];eligibleClients=[];selectedClients=new Set;selectedInactiveDay=null;logs=[];stats={totalEligible:0,selected:0,sentToday:0,responseRate:0};totalContacts=0;eligibleCount=0;periodFilters=[];isFiltersExpanded=!0;isContactsExpanded=!0;openMenuId=null;messageText="";closeMenusHandler=null;closeDropdownHandler=null;testContact=null;testModeEnabled=!1;bridge=new Te(2500);sendButtonClickHandler=null;_rateLimiter=new Ue;isPaused=!1;isSending=!1;_sendingQueue=[];_backgroundIntervalId=null;_STORAGE_KEY_QUEUE="reactivationSendingQueue";_STORAGE_KEY_PAUSED="reactivationIsPaused";listsManager=null;lists=[];listsExpanded=!1;_creatingList=!1;listMenuOpenId=null;sendingProgress={total:0,sent:0,skipped:0,errors:0,current:null,startTime:null};constructor(){}async render(){console.log("[REACTIVATION] \xE2\u0161\xA1 render() CHAMADO!");let e=document.createElement("div");e.className="flex flex-col gap-4",this.container=e;try{console.log("[REACTIVATION] Iniciando render..."),await this.loadConfig(),console.log("[REACTIVATION] loadConfig conclu\xC3\xADdo, lists:",this.lists?.length||0),await this.loadInactiveClients(),this.selectedInactiveDay||(this.selectedInactiveDay=this.cadenceDays[0]||21),console.log("[REACTIVATION] Chamando renderContent..."),this.renderContent(),this.updateStats(),console.log("[REACTIVATION] Render conclu\xC3\xADdo")}catch(t){console.error("[REACTIVATION] Erro ao renderizar painel:",t),e.innerHTML=`
        <div class="mettri-error">
          <p>Erro ao carregar painel de reativa\xC3\xA7\xC3\xA3o.</p>
          <p>Verifique o console para mais detalhes.</p>
          <pre>${t instanceof Error?t.message:String(t)}</pre>
        </div>
      `}return e}async loadConfig(){try{let e=await this.bridge.storageGet(["reactivationCadence","reactivationTestContact","reactivationTestModeEnabled"]);if(e.reactivationCadence&&Array.isArray(e.reactivationCadence)&&(this.cadenceDays=e.reactivationCadence),e.reactivationTestContact&&typeof e.reactivationTestContact=="object"){let t=e.reactivationTestContact;typeof t.phone=="string"&&typeof t.name=="string"&&(this.testContact={phone:t.phone,name:t.name})}typeof e.reactivationTestModeEnabled=="boolean"&&(this.testModeEnabled=e.reactivationTestModeEnabled);try{let t=await this.getAccountId();this.listsManager=new Fe(t),await this.listsManager.initialize(),this.lists=this.listsManager.getLists(),console.log("[REACTIVATION] Listas carregadas:",this.lists.length,this.lists)}catch(t){console.error("[REACTIVATION] Erro ao inicializar listas:",t),this.lists=[]}}catch(e){console.error("[REACTIVATION] Erro ao carregar configura\xC3\xA7\xC3\xA3o:",e)}}async getAccountId(){try{let t=(await this.bridge.storageGet(["mettri_current_user_wid"])).mettri_current_user_wid;if(t&&typeof t=="string")return t.replace(/[^a-zA-Z0-9]/g,"_")}catch(e){console.error("[REACTIVATION] Erro ao obter accountId:",e)}return"default"}async saveConfig(){try{await this.bridge.storageSet({reactivationCadence:this.cadenceDays,reactivationTestContact:this.testContact,reactivationTestModeEnabled:this.testModeEnabled}),this.container&&this.addLog("success","Configura\xC3\xA7\xC3\xA3o salva com sucesso")}catch(e){console.error("[REACTIVATION] Erro ao salvar configura\xC3\xA7\xC3\xA3o:",e),this.container&&this.addLog("error","Erro ao salvar configura\xC3\xA7\xC3\xA3o")}}async loadInactiveClients(){let e=new Date,t=await xt.getLastIncomingByContact();this.totalContacts=t.size;let s=[];for(let r of t.values()){let i=Mt(e,r.lastIncomingAt);if(!this.cadenceDays.includes(i))continue;let a=(r.chatId.split("@")[0]||"").replace(/\D+/g,""),c="";try{let d=_t(a),l=Array.from(new Set([d.phoneDigits,...d.aliasesDigits].filter(Boolean))),m=null;for(let k of l)if(m=await Qe.getByPhoneDigits(k)||await Qe.getByKey(k),m)break;let w=(m?.firstName||m?.fullName||m?.nickname||"").trim();if(w){let k=Xe(w);c=k.kind==="person"?this.extractFirstName(k.firstName):""}}catch{}if(!c){let d=Xe(r.chatName);d.kind==="person"?c=this.extractFirstName(d.firstName):c=""}s.push({chatId:r.chatId,chatName:r.chatName,phone:a,lastMessageTime:r.lastIncomingAt,daysInactive:i,cadenceDay:i,status:"pending",firstName:c})}s=this.filterClientsInLists(s),s.sort((r,i)=>i.daysInactive-r.daysInactive),this.eligibleClients=s,this.selectedInactiveDay||(this.selectedInactiveDay=this.cadenceDays[0]||21),this.eligibleCount=this.eligibleClients.filter(r=>r.status==="pending"&&!r.isSpecialList).length,this.calculatePeriodFilters(),this.updateStats()}filterClientsInLists(e){if(!this.listsManager)return e;let t=new Set;for(let r of this.lists)this.listsManager.getMembers(r.id).forEach(o=>t.add(o));let s=e.filter(r=>!t.has(r.chatId));return s.forEach(r=>{r.listIds=this.listsManager.getListsForClient(r.chatId)}),s}phoneToChatId(e){let t=F(e);if(!t)return"";let s=t;return(t.length===10||t.length===11)&&!t.startsWith("55")&&(s="55"+t),`${s}@c.us`}_phoneToChatId2(e){let t=F(e);if(!t)return"";let s=t;return(t.length===10||t.length===11)&&!t.startsWith("55")&&(s="55"+t),`${s}@c.us`}updateStats(){this.stats.totalEligible=this.eligibleClients.length,this.stats.selected=this.selectedClients.size,new Date().setHours(0,0,0,0),this.stats.sentToday=this.eligibleClients.filter(r=>r.status==="sent").length;let t=this.eligibleClients.filter(r=>r.status==="responded").length,s=this.eligibleClients.filter(r=>r.status==="sent"||r.status==="responded").length;this.stats.responseRate=s>0?Math.round(t/s*100):0,this.updateUnifiedFlow()}updateUnifiedInactive(){this.updateUnifiedFlow()}updateUnifiedFlow(){if(!this.container)return;let e=this.container.querySelector(".mettri-reactivation-unified-flow")||this.container.querySelector(".flex.flex-col.gap-4");e&&(e.innerHTML=this.renderUnifiedFlow(),this.setupUnifiedFlowListeners())}setupUnifiedFlowListeners(){this.setupPeriodFiltersListeners(),this.setupContactsListeners(),this.setupMessageInputListeners(),this.setupHeaderActionsListeners(),this.setupTestSectionListeners(),this.setupSendButtonListener(),this.setupListsListeners()}setupSendButtonListener(){let e=this.container?.querySelector("#reactivation-send-selected");e?.addEventListener("click",async()=>{if(!e.hasAttribute("disabled")){e&&(e.disabled=!0);try{await this.sendSelectedClients()}catch(t){this.addLog("error",`Erro ao enviar: ${t instanceof Error?t.message:"Erro desconhecido"}`)}finally{e&&(e.disabled=!1)}}})}setupTestSectionListeners(){let e=this.container?.querySelector("#reactivation-test-mode");e?.addEventListener("change",()=>{this.testModeEnabled=!!e.checked,this.saveConfig(),this.updateUnifiedFlow()});let t=this.container?.querySelector("#reactivation-test-phone");t?.addEventListener("blur",()=>{let r=t?.value?.trim()??"",o=this.container?.querySelector("#reactivation-test-name")?.value?.trim()??"";F(r).length>=10&&(this.testContact={phone:r,name:o},this.saveConfig(),this.updateUnifiedFlow())});let s=this.container?.querySelector("#reactivation-test-name");s?.addEventListener("blur",()=>{let i=this.container?.querySelector("#reactivation-test-phone")?.value?.trim()??"",o=s?.value?.trim()??"";F(i).length>=10&&(this.testContact={phone:i,name:o},this.saveConfig(),this.updateUnifiedFlow())})}setupPeriodFiltersListeners(){this.container?.querySelectorAll("[data-period-range]")?.forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation();let r=s.currentTarget.dataset.periodRange;r&&this.togglePeriodFilter(r)})})}togglePeriodFilter(e){let t=parseInt(e,10);if(!Number.isFinite(t))return;this.selectedInactiveDay=t;let s=this.eligibleClients.filter(i=>i.daysInactive===t&&i.status==="pending"&&!i.isSpecialList),r=s.every(i=>this.selectedClients.has(i.chatId));s.forEach(i=>{r?this.selectedClients.delete(i.chatId):this.selectedClients.add(i.chatId)}),this.calculatePeriodFilters(),this.updateUnifiedFlow(),this.addLog("info",`${r?"Deselecionados":"Selecionados"} ${s.length} cliente(s) do dia ${t}`)}setupContactsListeners(){this.container?.querySelectorAll('#reactivation-contacts-list input[type="checkbox"]')?.forEach(c=>{c.addEventListener("change",d=>{let l=d.target.dataset.chatId,m=d.target.checked;l&&(m?this.selectedClients.add(l):this.selectedClients.delete(l),this.calculatePeriodFilters(),this.updateUnifiedFlow())})}),this.container?.querySelectorAll("#reactivation-contacts-list [data-chat-id]")?.forEach(c=>{c.addEventListener("click",d=>{if(d.target.closest("[data-kebab-menu]")||d.target.closest("[data-kebab-dropdown]"))return;if(c.dataset.chatId){let m=c.querySelector('input[type="checkbox"]');m&&(m.checked=!m.checked,m.dispatchEvent(new Event("change")))}})}),this.container?.querySelectorAll("[data-kebab-menu]")?.forEach(c=>{c.addEventListener("click",d=>{d.stopPropagation();let l=c.dataset.kebabMenu;l&&(this.openMenuId===l?this.openMenuId=null:this.openMenuId=l,this.updateUnifiedFlow())})}),this.container?.querySelector('[data-action="exclude-from-send"]')?.addEventListener("click",c=>{c.stopPropagation();let d=c.currentTarget.dataset.chatId;d&&(this.selectedClients.delete(d),this.openMenuId=null,this.calculatePeriodFilters(),this.updateUnifiedFlow(),this.addLog("info","Cliente exclu\xC3\xADdo deste envio"))}),this.container?.querySelector('[data-action="block-forever"]')?.addEventListener("click",c=>{c.stopPropagation();let d=c.currentTarget.dataset.chatId;if(d){let l=this.eligibleClients.find(m=>m.chatId===d);l&&(l.status="excluded",this.selectedClients.delete(d),this.openMenuId=null,this.calculatePeriodFilters(),this.updateUnifiedFlow(),this.addLog("warning",`${l.firstName||l.phone||"Sem nome"} bloqueado permanentemente`))}}),this.container?.querySelector("#reactivation-expand-contacts")?.addEventListener("click",()=>{this.isContactsExpanded=!this.isContactsExpanded,this.updateUnifiedFlow()}),this.closeMenusHandler&&(document.removeEventListener("click",this.closeMenusHandler),this.closeMenusHandler=null);let a=c=>{this.openMenuId&&!c.target.closest("[data-kebab-menu]")&&!c.target.closest("[data-kebab-dropdown]")&&(this.openMenuId=null,this.updateUnifiedFlow())};this.closeMenusHandler=a,document.addEventListener("click",a)}setupMessageInputListeners(){this.container?.querySelector("#reactivation-message-input")?.addEventListener("input",t=>{this.messageText=t.target.value})}setupHeaderActionsListeners(){this.container?.querySelector("#reactivation-filters-toggle")?.addEventListener("click",()=>{this.isFiltersExpanded=!this.isFiltersExpanded,this.updateUnifiedFlow()}),this.container?.querySelector("#reactivation-contacts-toggle")?.addEventListener("click",()=>{this.isContactsExpanded=!this.isContactsExpanded,this.updateUnifiedFlow()})}setupUnifiedInactiveListeners(){let e=this.container?.querySelector("#reactivation-day-selector"),t=this.container?.querySelector("#reactivation-cadence-dropdown");e?.addEventListener("click",a=>{a.stopPropagation();let c=t&&t.style.display!=="none";t&&(t.style.display=c?"none":"block",t.className=c?"hidden":"glass rounded-xl border-border/30 min-w-[90px] p-1 absolute z-50 mt-1")}),this.closeDropdownHandler&&(document.removeEventListener("click",this.closeDropdownHandler),this.closeDropdownHandler=null);let s=a=>{t&&e&&!t.contains(a.target)&&!e.contains(a.target)&&(t.style.display="none")};this.closeDropdownHandler=s,document.addEventListener("click",s),this.container?.querySelectorAll("#reactivation-cadence-dropdown button[data-day]")?.forEach(a=>{a.addEventListener("click",c=>{c.stopPropagation();let d=parseInt(c.target.getAttribute("data-day")||"0");d>0&&(this.selectedInactiveDay=d,t&&(t.classList.add("hidden"),t.style.display="none"),this.updateUnifiedFlow())})}),this.container?.querySelectorAll("button[data-day]:not(#reactivation-day-selector)")?.forEach(a=>{a.addEventListener("click",c=>{let d=parseInt(c.target.getAttribute("data-day")||"0");d>0&&c.target.id.startsWith("reactivation-select-day-")||d>0&&!c.target.id.startsWith("reactivation-")&&(this.selectedInactiveDay=d,this.updateUnifiedFlow())})}),this.container?.querySelector("#reactivation-edit-cadence")?.addEventListener("click",async()=>{await this.showEditCadenceDialog()})}setupUnifiedFlowActions(){this.container?.querySelector("#reactivation-select-all-days")?.addEventListener("click",()=>{let s=this.selectedInactiveDay||this.cadenceDays[0]||21;this.eligibleClients.filter(r=>r.daysInactive>=s&&r.status==="pending"&&!r.isSpecialList).forEach(r=>{this.selectedClients.add(r.chatId)}),this.updateUnifiedFlow(),this.addLog("info",`Selecionados todos os clientes eleg\xC3\xADveis (${this.selectedClients.size})`)}),this.cadenceDays.forEach(s=>{this.container?.querySelector(`#reactivation-select-day-${s}`)?.addEventListener("click",()=>{let i=this.eligibleClients.filter(o=>o.daysInactive>=s&&o.daysInactive<(this.cadenceDays[this.cadenceDays.indexOf(s)+1]||1/0)&&o.status==="pending"&&!o.isSpecialList);i.forEach(o=>{this.selectedClients.add(o.chatId)}),this.updateUnifiedFlow(),this.addLog("info",`Selecionados ${i.length} cliente(s) do ${s}\xC2\xBA dia`)})}),this.container?.querySelector("#reactivation-clear-selection")?.addEventListener("click",()=>{this.selectedClients.clear(),this.updateUnifiedFlow(),this.addLog("info","Sele\xC3\xA7\xC3\xA3o limpa")})}setupUnifiedRecipients(){this.container?.querySelectorAll('input[type="checkbox"][data-chat-id]')?.forEach(s=>{s.addEventListener("change",r=>{let i=r.target.dataset.chatId,o=r.target.checked;i&&(o?this.selectedClients.add(i):this.selectedClients.delete(i),this.updateUnifiedFlow())})}),this.container?.querySelectorAll("button[data-action][data-chat-id]")?.forEach(s=>{s.addEventListener("click",r=>{let i=r.target.dataset.action,o=r.target.dataset.chatId;o&&i&&(this.handleClientAction(i,o),this.updateUnifiedFlow())})})}addLog(e,t){e==="error"&&console.error("[REACTIVATION]",t),this.logs.push({timestamp:new Date,type:e,message:t}),this.logs.length>100&&this.logs.shift(),this.container&&this.renderLogs()}renderContent(){this.container&&(this.container.innerHTML=`
      <!-- INTERFACE UNIFICADA: INATIVOS + R\xC3\u2030GUA + ENVIOS -->
      <div class="mettri-reactivation-unified-flow flex flex-col gap-4">
        ${this.renderUnifiedFlow()}
      </div>

      <!-- MONITORAMENTO -->
      <div class="space-y-2">
        <div class="flex items-center justify-between px-1">
          <span class="text-[11px] font-medium text-foreground">Monitoramento</span>
          <button class="h-7 px-2 text-[10px] text-primary hover:bg-primary/10 rounded-lg" id="reactivation-clear-logs">Limpar</button>
        </div>
        <div class="glass-subtle rounded-xl p-3 max-h-48 overflow-y-auto text-xs text-muted-foreground" id="reactivation-logs">
          ${this.logs.length===0?'<div class="text-center py-4 text-[11px] text-muted-foreground/60">Nenhum log ainda. Os eventos aparecer\xC3\xA3o aqui.</div>':""}
        </div>
      </div>
    `,this.setupEventListeners())}extractFirstName(e){let t=e.trim().split(/\s+/)[0]||e;return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}renderOverview(){let e=this.eligibleClients.length,t=this.getCadenceCounts(),s=this.cadenceDays.map(r=>`<span class="mettri-overview-day-compact">${t[r]||0} a ${r} dias</span>`).join("");return`
      <div class="mettri-overview-compact">
        <span class="mettri-overview-total-compact">${e} inativos</span>
        <div class="mettri-overview-breakdown-compact">
          ${s}
        </div>
      </div>
    `}renderPrepareSection(){let e=this.selectedClients.size,t=this.eligibleClients.filter(s=>this.selectedClients.has(s.chatId));return`
      <div class="mettri-prepare-actions">
        <button class="mettri-btn-link" id="reactivation-select-all-days">Todos</button>
        ${this.cadenceDays.map(s=>`
          <button class="mettri-btn-link" data-day="${s}" id="reactivation-select-day-${s}">
            ${s} dias
          </button>
        `).join("")}
        <button class="mettri-btn-link" id="reactivation-clear-selection">Limpar</button>
      </div>
      
      <div class="mettri-prepare-selected">
        <div class="mettri-prepare-selected-header">
          <span class="mettri-section-title-small">Clientes Selecionados (${e})</span>
        </div>
        <div class="mettri-prepare-clients-list">
          ${this.renderSelectedClientsList(t)}
        </div>
        <div class="mettri-prepare-send-footer">
          <button class="mettri-btn-primary mettri-btn-send" id="reactivation-send-selected" ${e===0?"disabled":""}>
            Enviar ${e>0?`(${e})`:""}
          </button>
        </div>
      </div>
    `}renderSelectedClientsList(e){return e.length===0?`
        <div class="mettri-prepare-empty">
          <p>Nenhum cliente selecionado.</p>
          <p>Use os bot\xC3\xB5es acima para selecionar clientes por dia da r\xC3\xA9gua.</p>
        </div>
      `:e.map(t=>{let r=t.firstName||""||t.phone||"Sem nome",i=this.messageText||"Ol\xC3\xA1! Sentimos sua falta por aqui.";return`
        <div class="mettri-prepare-client-card" data-chat-id="${t.chatId}">
          <div class="mettri-prepare-client-main">
            <input type="checkbox" class="mettri-prepare-client-checkbox" 
                   checked data-chat-id="${t.chatId}">
            <div class="mettri-prepare-client-info">
              <div class="mettri-prepare-client-name">${this.escapeHtml(r)}</div>
              <div class="mettri-prepare-client-preview" title="${this.escapeHtml(i)}">
                ${this.escapeHtml(i.substring(0,50))}${i.length>50?"...":""}
              </div>
            </div>
          </div>
          <div class="mettri-prepare-client-actions">
            <button class="mettri-btn-link mettri-btn-small" 
                    data-action="skip-today" 
                    data-chat-id="${t.chatId}"
                    title="Pular para hoje">
              Hoje
            </button>
            <button class="mettri-btn-link mettri-btn-small" 
                    data-action="exclude" 
                    data-chat-id="${t.chatId}"
                    title="Remover da lista">
              Remover
            </button>
            <button class="mettri-btn-link mettri-btn-small mettri-btn-special-list" 
                    data-action="special-list" 
                    data-chat-id="${t.chatId}"
                    title="Mover para lista especial (CNPJ, etc)">
              Especial
            </button>
          </div>
        </div>
      `}).join("")}renderUnifiedFlow(){console.log("[REACTIVATION] renderUnifiedFlow chamado, lists:",this.lists?.length||0);let e=this.selectedClients.size,t=this.eligibleClients.filter(r=>this.selectedClients.has(r.chatId)&&r.status==="pending"&&!r.isSpecialList),s=this.eligibleClients.filter(r=>r.status==="pending"&&!r.isSpecialList);return`
      <!-- HEADER: M\xC3\xA9tricas simples -->
      <div class="space-y-1 mb-2">
        <p class="text-2xl font-bold text-foreground">${this.eligibleCount} inativos eleg\xC3\xADveis</p>
        <p class="text-xs text-muted-foreground">de ${this.totalContacts.toLocaleString("pt-BR")} contatos</p>
      </div>


      <!-- SE\xC3\u2021\xC3\u0192O DE FILTROS (Colaps\xC3\xA1vel) -->
      <div class="space-y-2 mb-2">
        <div class="flex items-center justify-between px-1">
          <button 
            class="flex items-center gap-1 text-xs font-medium text-foreground hover:text-primary transition-colors"
            id="reactivation-filters-toggle"
            type="button"
          >
            Selecionados (${e})
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="transition-transform ${this.isFiltersExpanded?"rotate-180":""}" id="reactivation-filters-chevron">
              <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button 
            class="w-6 h-6 rounded flex items-center justify-center hover:bg-accent/50 transition-colors"
            id="reactivation-filters-kebab"
            type="button"
          >
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <circle cx="7" cy="3.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="7" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="10.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
            </svg>
          </button>
        </div>
        
        ${this.isFiltersExpanded?`
          <div id="reactivation-period-filters">
            ${this.renderPeriodFilters()}
          </div>
        `:""}
      </div>

      <!-- SE\xC3\u2021\xC3\u0192O DE CONTATOS (Colaps\xC3\xA1vel) -->
      <div class="space-y-1 mb-2">
        <div class="flex items-center justify-between px-1">
          <button 
            class="flex items-center gap-1 text-xs font-medium text-foreground hover:text-primary transition-colors"
            id="reactivation-contacts-toggle"
            type="button"
          >
            Selecionados (${e})
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="transition-transform ${this.isContactsExpanded?"rotate-180":""}" id="reactivation-contacts-chevron">
              <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button 
            class="w-6 h-6 rounded flex items-center justify-center hover:bg-accent/50 transition-colors"
            id="reactivation-contacts-kebab"
            type="button"
          >
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <circle cx="7" cy="3.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="7" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="10.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
            </svg>
          </button>
        </div>
        
        ${this.isContactsExpanded?`
          <div class="space-y-0.5" id="reactivation-contacts-list">
            ${e>0?this.renderContactsList(t):this.renderEmptyRecipients(s)}
          </div>
          
          ${t.length>6?`
            <button 
              class="w-full h-8 rounded-lg text-xs text-primary hover:bg-primary/10 transition-colors flex items-center justify-center gap-1"
              id="reactivation-expand-contacts"
              type="button"
            >
              ${this.isContactsExpanded?"Ver menos":"Ver todos >"}
            </button>
          `:""}
        `:""}
      </div>

      <!-- SE\xC3\u2021\xC3\u0192O DE LISTAS (Colaps\xC3\xA1vel) -->
      ${(()=>{try{return this.renderLists()}catch(r){return console.error("[REACTIVATION] Erro ao chamar renderLists:",r),""}})()}

      <!-- UI DE PROGRESSO -->
      ${(()=>{try{return this.renderProgressUI()}catch(r){return console.error("[REACTIVATION] Erro ao chamar renderProgressUI:",r),""}})()}

      <!-- INPUT DE MENSAGEM -->
      <div class="flex items-start gap-2 p-2 rounded-xl border-2 border-border bg-background">
        <span class="text-lg mt-1">\xF0\u0178\u02DC\u0160</span>
        <textarea 
          rows="3"
          class="flex-1 bg-transparent text-sm placeholder:text-muted-foreground outline-none resize-none"
          placeholder="Escreva uma mensagem..."
          id="reactivation-message-input"
        >${this.escapeHtml(this.messageText)}</textarea>
      </div>

      <!-- MODO TESTE -->
      <div class="mt-0.5">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="reactivation-test-mode" ${this.testModeEnabled?"checked":""} />
          <span class="text-[10px] text-muted-foreground">Modo teste</span>
        </label>
      </div>

      <!-- BOT\xC3\u0192O DE ENVIAR -->
      <div class="mt-1.5">
        <button 
          class="w-full h-10 rounded-lg bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          id="reactivation-send-selected"
          type="button"
          ${e===0&&!this.testModeEnabled?"disabled":""}
        >
          ${this.testModeEnabled?"Enviar Teste":e>0?`Enviar (${e})`:"Enviar"}
        </button>
      </div>

      <!-- CAMPOS DE TESTE (quando modo teste ativo) -->
      ${this.testModeEnabled?`
        <div class="mt-2 p-2 rounded-lg border border-border/50 bg-accent/30">
          <div class="grid grid-cols-2 gap-2">
            <div class="relative">
              <input 
                type="text"
                class="w-full px-2 pr-7 py-1.5 rounded-lg border border-border bg-background text-sm outline-none"
                id="reactivation-test-phone" 
                placeholder="N\xC3\xBAmero (ex: 5511999999999)" 
                value="${this.testContact?this.escapeHtml(this.testContact.phone):""}"
              />
              ${this.testContact?.phone?`
                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-green-500/70 pointer-events-none">
                  <svg width="10" height="10" viewBox="0 0 12 12" fill="none">
                    <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              `:""}
            </div>
            <div class="relative">
              <input 
                type="text"
                class="w-full px-2 pr-7 py-1.5 rounded-lg border border-border bg-background text-sm outline-none"
                id="reactivation-test-name" 
                placeholder="Nome" 
                value="${this.testContact?this.escapeHtml(this.testContact.name):""}"
              />
              ${this.testContact?.name?`
                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-green-500/70 pointer-events-none">
                  <svg width="10" height="10" viewBox="0 0 12 12" fill="none">
                    <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              `:""}
            </div>
          </div>
        </div>
      `:""}

    `}renderPeriodFilters(){return`
      <div class="grid grid-cols-2 gap-2">
        ${this.periodFilters.map(e=>{let t=e.selected;return`
            <button 
              class="flex items-center gap-2 px-3 py-2 rounded-xl transition-colors cursor-pointer ${e.variant==="filled"?"bg-primary text-primary-foreground":"border border-border bg-background hover:bg-accent/50"}"
              data-period-range="${e.range}"
              type="button"
            >
              <div class="w-5 h-5 rounded border-2 flex items-center justify-center ${t?"border-primary bg-primary":"border-border bg-background"}">
                ${t?`
                  <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                    <path d="M10 3L4.5 8.5L2 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                `:""}
              </div>
              <span class="text-xs font-medium">${e.range}d</span>
              <span class="text-[10px] opacity-70">(${e.count})</span>
            </button>
          `}).join("")}
      </div>
    `}renderContactsList(e){return(this.isContactsExpanded?e:e.slice(0,6)).map(s=>{let i=s.firstName||""||s.phone||"Sem nome",o=this.selectedClients.has(s.chatId),a=this.openMenuId===s.chatId;return`
        <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-accent/30 transition-colors relative" data-chat-id="${s.chatId}">
          <label class="cursor-pointer flex items-center">
            <input 
              type="checkbox" 
              class="sr-only" 
              ${o?"checked":""} 
              data-chat-id="${s.chatId}"
            >
            <div class="w-5 h-5 rounded border-2 flex items-center justify-center ${o?"border-primary bg-primary":"border-border bg-background"}">
              ${o?`
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M10 3L4.5 8.5L2 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              `:""}
            </div>
          </label>
          <span class="text-xs font-medium text-foreground flex-1">${this.escapeHtml(i)}</span>
          <span class="text-[10px] text-muted-foreground">${s.daysInactive}d</span>
          <button 
            class="w-6 h-6 rounded flex items-center justify-center hover:bg-accent/50 transition-colors relative" 
            data-kebab-menu="${s.chatId}"
            type="button"
          >
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <circle cx="7" cy="3.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="7" r="1.5" fill="currentColor" class="text-muted-foreground"/>
              <circle cx="7" cy="10.5" r="1.5" fill="currentColor" class="text-muted-foreground"/>
            </svg>
            ${a?this.renderKebabMenu(s.chatId):""}
          </button>
        </div>
      `}).join("")}renderKebabMenu(e){return`
      <div class="absolute right-0 top-full mt-1 w-48 rounded-xl glass border border-border shadow-xl z-50" data-kebab-dropdown="${e}">
        <button 
          class="w-full rounded-lg cursor-pointer gap-2.5 text-xs flex items-center px-2 py-1.5 focus:bg-accent transition-colors"
          data-action="exclude-from-send"
          data-chat-id="${e}"
        >
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" class="w-3.5 h-3.5 text-muted-foreground">
            <path d="M11 3L3 11M3 3l8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>Excluir deste envio</span>
        </button>
        <div class="bg-border/30 my-1 h-px"></div>
        <button 
          class="w-full rounded-lg cursor-pointer gap-2.5 text-xs flex items-center px-2 py-1.5 text-destructive focus:bg-destructive/10 focus:text-destructive transition-colors"
          data-action="block-forever"
          data-chat-id="${e}"
        >
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" class="w-3.5 h-3.5 text-destructive">
            <path d="M7 1L1 3v4c0 3.5 2.5 6.5 6 7.5 3.5-1 6-4 6-7.5V3L7 1z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Bloquear para sempre</span>
        </button>
      </div>
    `}renderUnifiedRecipientsList(e){return this.renderContactsList(e)}renderEmptyRecipients(e){return e.length===0?`
        <div class="glass-subtle rounded-xl p-3 text-center space-y-1">
          <p class="text-[11px] text-muted-foreground">Nenhum cliente inativo encontrado para este per\xC3\xADodo.</p>
        </div>
      `:`
              <div class="glass-subtle rounded-xl p-3 text-center space-y-1">
                <p class="text-[11px] text-muted-foreground">Selecione clientes usando os bot\xC3\xB5es acima.</p>
                <p class="text-[11px] text-primary font-medium">${e.length} dispon\xC3\xADvel${e.length!==1?"eis":""} para ${this.selectedInactiveDay||this.cadenceDays[0]}d</p>
              </div>
    `}getInactiveCountForDay(e){return this.eligibleClients.filter(t=>t.daysInactive===e).length}calculatePeriodFilters(){this.periodFilters=this.cadenceDays.map(e=>{let t=this.eligibleClients.filter(r=>r.daysInactive===e&&r.status==="pending"&&!r.isSpecialList).length,s=this.eligibleClients.some(r=>r.daysInactive===e&&this.selectedClients.has(r.chatId));return{range:String(e),count:t,selected:s,variant:s?"filled":"outline"}})}getCadenceCounts(){let e={};return this.cadenceDays.forEach(t=>{e[t]=this.eligibleClients.filter(s=>s.cadenceDay===t).length}),e}renderStats(){if(!this.container)return;let e=this.container.querySelector("#reactivation-stats");e&&(e.innerHTML=`
      <div class="mettri-stat-card">
        <div class="stat-value">${this.stats.totalEligible}</div>
        <div class="stat-label">Eleg\xC3\xADveis</div>
      </div>
      <div class="mettri-stat-card">
        <div class="stat-value">${this.stats.selected}</div>
        <div class="stat-label">Selecionados</div>
      </div>
      <div class="mettri-stat-card">
        <div class="stat-value">${this.stats.sentToday}</div>
        <div class="stat-label">Enviadas Hoje</div>
      </div>
      <div class="mettri-stat-card">
        <div class="stat-value">${this.stats.responseRate}%</div>
        <div class="stat-label">Taxa de Resposta</div>
      </div>
    `)}renderLogs(){if(!this.container)return;let e=this.container.querySelector("#reactivation-logs");if(e){if(this.logs.length===0){e.innerHTML='<div class="mettri-logs-empty">Nenhum log ainda. Os eventos aparecer\xC3\xA3o aqui.</div>';return}e.innerHTML=this.logs.map(t=>{let s=t.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),r={success:"\xE2\u0153\u201C",error:"\xE2\u0153\u2014",info:"\xE2\u2020\u2019",warning:"\xE2\u0161\xA0"}[t.type]||"\xE2\u20AC\xA2";return`
        <div class="mettri-log-entry mettri-log-${t.type}">
          <span class="mettri-log-time">[${s}]</span>
          <span class="mettri-log-icon">${r}</span>
          <span class="mettri-log-message">${this.escapeHtml(t.message)}</span>
        </div>
      `}).join(""),e.scrollTop=e.scrollHeight}}setupEventListeners(){this.setupUnifiedFlowListeners(),this.container?.querySelector("#reactivation-clear-logs")?.addEventListener("click",()=>{this.logs=[],this.renderLogs()})}async showEditCadenceDialog(){let e=prompt("Digite os dias da r\xC3\xA9gua separados por v\xC3\xADrgula (ex: 21,35,56,84):",this.cadenceDays.join(","));if(e){let t=e.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s)&&s>0);t.length>0&&(this.cadenceDays=t.sort((s,r)=>s-r),await this.saveConfig(),await this.loadInactiveClients(),this.selectedInactiveDay=this.cadenceDays[0]||21,this.renderContent(),this.addLog("success",`R\xC3\xA9gua atualizada: ${this.cadenceDays.join(", ")} dias`),this.updateUnifiedFlow())}}handleClientAction(e,t){let s=this.eligibleClients.find(r=>r.chatId===t);if(s){switch(e){case"skip-today":s.status="skipped-today",this.selectedClients.delete(t),this.addLog("info",`${s.firstName||s.phone||"Sem nome"} - Pulado para hoje`);break;case"exclude":s.status="excluded",this.selectedClients.delete(t),this.addLog("info",`${s.firstName||s.phone||"Sem nome"} - Removido da lista`);break;case"special-list":s.isSpecialList=!0,this.selectedClients.delete(t),this.addLog("info",`${s.firstName||s.phone||"Sem nome"} - Movido para lista especial`);break}this.updateUnifiedFlow()}}deselectAllClients(){this.selectedClients.clear(),this.updateUnifiedFlow()}async sendSelectedClients(){if(this.testModeEnabled&&this.testContact?.phone){if(!this.messageText.trim()){this.addLog("warning","Digite uma mensagem para o teste");return}let t=this.phoneToChatId(this.testContact.phone);if(!t){this.addLog("warning","N\xC3\xBAmero de teste inv\xC3\xA1lido");return}try{let s=this.messageText.trim();if(!s){this.addLog("warning","Digite uma mensagem para o teste");return}await this.sendRawToChatId(t,s);let r=this.testContact.name||this.testContact.phone;this.addLog("success",`Teste enviado para ${r}`)}catch(s){let r=s instanceof Error?s.message:String(s);this.addLog("error",`Teste: ${r}`)}return}if(this.selectedClients.size===0){this.addLog("warning","Nenhum cliente selecionado");return}let e=Array.from(this.selectedClients);this.addLog("info",`Iniciando envio para ${e.length} cliente(s)...`);for(let t of e)await this.sendToClient(t),e.indexOf(t)<e.length-1&&await new Promise(s=>setTimeout(s,5e3));this.selectedClients.clear(),this.updateUnifiedFlow(),this.addLog("success",`Envio conclu\xC3\xADdo para ${e.length} cliente(s)`)}async sendRawToChatId(e,t){await rt.sendText(e,t)}async sendToClient(e){let t=this.eligibleClients.find(s=>s.chatId===e);if(!t){this.addLog("error",`Cliente n\xC3\xA3o encontrado: ${e}`);return}try{let s=this.messageText.trim()||"Ol\xC3\xA1! Sentimos sua falta por aqui.";await this.sendRawToChatId(e,s),t.status="sent",t.generatedMessage=s,this.addLog("success",`${t.firstName||t.phone||"Sem nome"} - Enviado`),this.updateUnifiedFlow()}catch(s){this.addLog("error",`${t.firstName||t.phone||"Sem nome"} - Erro: ${s instanceof Error?s.message:"Erro desconhecido"}`)}}renderLists(){try{let e=this.lists||[];return console.log("[REACTIVATION] renderLists chamado, lists.length:",e.length,"listsExpanded:",this.listsExpanded),`
        <div class="border border-border rounded-xl bg-background mb-2">
          <button 
            class="w-full flex items-center justify-between px-3 py-2.5 hover:bg-accent/30 transition-colors"
            data-lists-toggle
            type="button"
          >
            <span class="text-xs font-medium text-foreground">Listas</span>
            <span class="text-[10px] text-muted-foreground">${e.length}</span>
          </button>
          ${this.listsExpanded?`
            <div class="px-3 pb-3 space-y-2">
              ${e.length>0?e.map(t=>this.renderListTag(t)).join(""):""}
              <button 
                class="w-full h-7 rounded-lg border border-dashed border-border text-[11px] text-muted-foreground hover:bg-accent/30 hover:text-foreground transition-colors flex items-center justify-center gap-1"
                data-create-list
                type="button"
              >
                <span>+</span>
                <span>Nova lista</span>
              </button>
            </div>
          `:""}
        </div>
      `}catch(e){return console.error("[REACTIVATION] Erro em renderLists:",e),'<div class="text-xs text-red-500">Erro ao renderizar listas</div>'}}renderListTag(e){let t=e.color,s=e.isDefault,r=this.listMenuOpenId===e.id;return`
      <div 
        class="flex items-center gap-2 px-2.5 py-1.5 rounded-lg transition-colors hover:bg-accent/20 group relative"
        style="background-color: var(${t} / 0.15); border-left: 3px solid var(${t})"
        data-list-id="${e.id}"
      >
        <span class="text-[11px] font-medium flex-1 truncate" style="color: var(${t})">
          ${this.escapeHtml(e.name)}
        </span>
        <span class="text-[10px] text-muted-foreground">${e.memberCount}</span>
        ${s?"":`
          <button class="w-5 h-5 rounded opacity-0 group-hover:opacity-100 hover:bg-accent transition-opacity flex items-center justify-center" data-list-menu="${e.id}" title="Menu" type="button">
            <span class="text-[10px]">\xE2\u2039\xAF</span>
          </button>
          ${r?this.renderListMenu(e.id):""}
        `}
      </div>
    `}renderListMenu(e){return`
      <div class="absolute right-0 top-full mt-1 w-48 rounded-xl glass border border-border shadow-xl z-50" data-list-menu-dropdown="${e}">
        <button class="w-full rounded-lg cursor-pointer gap-2.5 text-xs flex items-center px-2 py-1.5 focus:bg-accent transition-colors" data-list-action="view-members" data-list-id="${e}">
          <span>Ver membros</span>
        </button>
        <button class="w-full rounded-lg cursor-pointer gap-2.5 text-xs flex items-center px-2 py-1.5 focus:bg-accent transition-colors" data-list-action="rename" data-list-id="${e}">
          <span>Renomear</span>
        </button>
        <div class="bg-border/30 my-1 h-px"></div>
        <button class="w-full rounded-lg cursor-pointer gap-2.5 text-xs flex items-center px-2 py-1.5 text-destructive focus:bg-destructive/10 focus:text-destructive transition-colors" data-list-action="delete" data-list-id="${e}">
          <span>Excluir</span>
        </button>
      </div>
    `}renderProgressUI(){if(!this.isSending)return"";let e=this.sendingProgress.total>0?this.sendingProgress.sent/this.sendingProgress.total*100:0,t=this.sendingProgress.startTime?Math.floor((Date.now()-this.sendingProgress.startTime)/1e3):0,s=t>0?Math.floor(this.sendingProgress.sent/t*60):0;return`
      <div class="border border-border rounded-xl bg-background p-3 space-y-2 mb-2">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-foreground">Enviando mensagens</span>
          ${this.isPaused?'<span class="text-[10px] text-muted-foreground">Pausado</span>':`<span class="text-[10px] text-muted-foreground">${s} msg/min</span>`}
        </div>
        <div class="relative h-2 rounded-full overflow-hidden" style="background-color: var(--progress-bg)">
          <div class="h-full rounded-full transition-all duration-300 ease-out" style="background-color: var(--progress-fill); width: ${e}%" data-progress-bar></div>
        </div>
        <div class="flex items-center justify-between text-[10px]">
          <div class="flex items-center gap-3">
            <span style="color: var(--progress-text)" data-sent-count>${this.sendingProgress.sent} de ${this.sendingProgress.total} enviadas</span>
            ${this.sendingProgress.skipped>0?`<span class="text-muted-foreground">${this.sendingProgress.skipped} puladas</span>`:""}
            ${this.sendingProgress.errors>0?`<span class="text-destructive">${this.sendingProgress.errors} erros</span>`:""}
          </div>
          <span class="text-muted-foreground">${Math.round(e)}%</span>
        </div>
        ${this.sendingProgress.current?`<div class="text-[10px] text-muted-foreground truncate" data-current-client>Enviando para: ${this.escapeHtml(this.sendingProgress.current)}</div>`:""}
      </div>
    `}_updateProgressUI(){if(!this.container)return;let e=this.container.querySelector("[data-progress-bar]"),t=this.container.querySelector("[data-sent-count]"),s=this.container.querySelector("[data-current-client]");if(e){let r=this.sendingProgress.total>0?this.sendingProgress.sent/this.sendingProgress.total*100:0;e.style.width=`${r}%`}t&&(t.textContent=`${this.sendingProgress.sent} de ${this.sendingProgress.total} enviadas`),s&&this.sendingProgress.current&&(s.textContent=`Enviando para: ${this.escapeHtml(this.sendingProgress.current)}`)}setupListsListeners(){this.container?.querySelector("[data-lists-toggle]")?.addEventListener("click",()=>{this.listsExpanded=!this.listsExpanded,this.updateUnifiedFlow()}),this.container?.querySelector("[data-create-list]")?.addEventListener("click",()=>{this.showCreateListDialog()}),this.container?.querySelectorAll("[data-list-menu]")?.forEach(a=>{a.addEventListener("click",c=>{c.stopPropagation();let d=a.dataset.listMenu;d&&(this.listMenuOpenId===d?this.listMenuOpenId=null:this.listMenuOpenId=d,this.updateUnifiedFlow())})}),this.container?.querySelector('[data-list-action="view-members"]')?.addEventListener("click",async a=>{a.stopPropagation();let c=a.currentTarget.dataset.listId;if(c&&this.listsManager){let d=this.listsManager.getMembers(c),l=this.lists.find(m=>m.id===c);alert(`${l?.name||"Lista"}: ${d.length} membro(s)`),this.listMenuOpenId=null,this.updateUnifiedFlow()}}),this.container?.querySelector('[data-list-action="rename"]')?.addEventListener("click",async a=>{a.stopPropagation();let c=a.currentTarget.dataset.listId;if(c){let d=this.lists.find(m=>m.id===c),l=prompt("Novo nome da lista:",d?.name||"");if(l&&l.trim()&&this.listsManager)try{await this.listsManager.renameList(c,l.trim()),this.lists=this.listsManager.getLists(),this.addLog("success",`Lista renomeada: ${l.trim()}`),this.updateUnifiedFlow()}catch(m){this.addLog("error",m instanceof Error?m.message:"Erro ao renomear lista")}this.listMenuOpenId=null,this.updateUnifiedFlow()}}),this.container?.querySelector('[data-list-action="delete"]')?.addEventListener("click",async a=>{a.stopPropagation();let c=a.currentTarget.dataset.listId;if(c&&this.listsManager){let d=this.lists.find(l=>l.id===c);if(confirm(`Tem certeza que deseja excluir a lista "${d?.name||"Sem nome"}"?`))try{await this.listsManager.deleteList(c),this.lists=this.listsManager.getLists(),this.addLog("success","Lista exclu\xC3\xADda"),this.updateUnifiedFlow()}catch(l){this.addLog("error",l instanceof Error?l.message:"Erro ao excluir lista")}this.listMenuOpenId=null,this.updateUnifiedFlow()}}),document.addEventListener("click",a=>{this.listMenuOpenId&&!a.target.closest("[data-list-menu]")&&!a.target.closest("[data-list-menu-dropdown]")&&(this.listMenuOpenId=null,this.updateUnifiedFlow())})}async showCreateListDialog(){let e=prompt("Nome da lista:");if(!e||!e.trim())return;let t=[{var:"--tag-color-1",name:"Verde"},{var:"--tag-color-2",name:"Azul"},{var:"--tag-color-3",name:"Roxo"},{var:"--tag-color-4",name:"Amarelo"},{var:"--tag-color-5",name:"Laranja"},{var:"--tag-color-6",name:"Vermelho"},{var:"--tag-color-7",name:"\xC3\x8Dndigo"},{var:"--tag-color-8",name:"Verde-\xC3\xA1gua"}],s=prompt(`Escolha uma cor (1-8):
${t.map((o,a)=>`${a+1}. ${o.name}`).join(`
`)}`),r=parseInt(s||"1",10)-1,i=t[r>=0&&r<t.length?r:0];if(this.listsManager)try{await this.listsManager.createList(e.trim(),i.var),this.lists=this.listsManager.getLists(),this.addLog("success",`Lista criada: ${e.trim()}`),this.updateUnifiedFlow()}catch(o){this.addLog("error",o instanceof Error?o.message:"Erro ao criar lista")}}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.closeMenusHandler&&(document.removeEventListener("click",this.closeMenusHandler),this.closeMenusHandler=null),this.closeDropdownHandler&&(document.removeEventListener("click",this.closeDropdownHandler),this.closeDropdownHandler=null),this.sendButtonClickHandler&&this.container&&(this.container.removeEventListener("click",this.sendButtonClickHandler),this.sendButtonClickHandler=null),this.container&&(this.container.innerHTML=""),this.container=null}};var ar=async(n,e)=>{let t=new ze;return{async render(){try{let s=await t.render();n.appendChild(s)}catch(s){console.error("[REACTIVATION MODULE] Erro ao renderizar:",s),n.innerHTML=`
          <div class="mettri-error">
            <p>Erro ao carregar painel de reativa\xE7\xE3o.</p>
            <p>Verifique o console para mais detalhes.</p>
          </div>
        `}},destroy(){t.destroy(),n&&(n.innerHTML="")}}},St={id:"marketing.reactivation",name:"Reativa\xE7\xE3o",parent:"marketing",icon:"\u{1F504}",dependencies:[],panelFactory:ar,lazy:!0};function or(n){n.register(St)}return Pt(cr);})();

// Auto-register module if register function is available in global scope
(function() {
  try {
    // Try to find register function from parent scope (passed as parameter)
    if (typeof register === 'function') {
      // Find module definition (could be named differently per module)
      var moduleDef = null;
      var moduleNames = ['ReactivationModule', 'RetomarModule', 'EnviarModule', 'HistoryModule', 'DirectoryModule', 'DashboardModule', 'TestsModule', 'MarketingModule', 'AtendimentoModule', 'ClientesModule', 'InfrastructureModule', 'EnviarRetomarModule', 'EnviarResponderModule', 'EnviarDivulgarModule'];
      for (var i = 0; i < moduleNames.length; i++) {
        if (typeof window[moduleNames[i]] !== 'undefined') {
          moduleDef = window[moduleNames[i]];
          break;
        }
      }
      // Also check global variable
      if (!moduleDef && typeof MettriModule_marketing_reactivation !== 'undefined') {
        if (MettriModule_marketing_reactivation.module) {
          moduleDef = MettriModule_marketing_reactivation.module;
        } else if (MettriModule_marketing_reactivation.id) {
          moduleDef = MettriModule_marketing_reactivation;
        }
      }
      if (moduleDef && moduleDef.id) {
        register(moduleDef);
      }
    }
    // Export to global for fallback access
    if (typeof window !== 'undefined') {
      window.MettriModule_marketing_reactivation = typeof MettriModule_marketing_reactivation !== 'undefined' ? MettriModule_marketing_reactivation : null;
    }
  } catch (e) {
    console.warn('[ModuleLoader] Error auto-registering module:', e);
  }
})();

